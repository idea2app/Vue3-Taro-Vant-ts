"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[997],{"4997":function(e,t,s){function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}s.d(t,{"default":function(){return Hls}});var i,r,n,a,o,l={"exports":{}};i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,l.exports=o={"buildAbsoluteURL":function(e,t,s){if(s=s||{},e=e.trim(),!(t=t.trim())){if(!s.alwaysNormalize)return e;var i=o.parseURL(e);if(!i)throw new Error("Error trying to parse base URL.");return i.path=o.normalizePath(i.path),o.buildURLFromParts(i)}var n=o.parseURL(t);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return s.alwaysNormalize?(n.path=o.normalizePath(n.path),o.buildURLFromParts(n)):t;var a=o.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var l=r.exec(a.path);a.netLoc=l[1],a.path=l[2]}a.netLoc&&!a.path&&(a.path="/");var d={"scheme":a.scheme,"netLoc":n.netLoc,"path":null,"params":n.params,"query":n.query,"fragment":n.fragment};if(!n.netLoc&&(d.netLoc=a.netLoc,"/"!==n.path[0]))if(n.path){var h=a.path,c=h.substring(0,h.lastIndexOf("/")+1)+n.path;d.path=o.normalizePath(c)}else d.path=a.path,n.params||(d.params=a.params,n.query||(d.query=a.query));return null===d.path&&(d.path=s.alwaysNormalize?o.normalizePath(n.path):n.path),o.buildURLFromParts(d)},"parseURL":function(e){var t=i.exec(e);return t?{"scheme":t[1]||"","netLoc":t[2]||"","path":t[3]||"","params":t[4]||"","query":t[5]||"","fragment":t[6]||""}:null},"normalizePath":function(e){for(e=e.split("").reverse().join("").replace(n,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},"buildURLFromParts":function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};var d=l.exports;function ownKeys(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(s),!0).forEach((function(t){_defineProperty(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function _defineProperty(e,t,s){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{"value":s,"enumerable":!0,"configurable":!0,"writable":!0}):e[t]=s,e}function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},_extends.apply(this,arguments)}const h=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},c=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=u},u=Number.MAX_SAFE_INTEGER||9007199254740991;let f=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e}({}),g=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),m=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown",e}({});const p=function noop(){},y={"trace":p,"debug":p,"log":p,"warn":p,"info":p,"error":p};let T=y;function exportLoggerFunctions(e,...t){t.forEach((function(t){T[t]=e[t]?e[t].bind(e):function consolePrintFn(e){const t=self.console[e];return t?t.bind(self.console,`[${e}] >`):p}(t)}))}const v=T,E=/^(\d+)x(\d+)$/,S=/(.+?)=(".*?"|.*?)(?:,|$)/g;class AttrList{"constructor"(e){"string"==typeof e&&(e=AttrList.parseAttrList(e)),_extends(this,e)}get"clientAttrs"(){return Object.keys(this).filter((e=>"X-"===e.substring(0,2)))}"decimalInteger"(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}"hexadecimalInteger"(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const s=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)s[e]=parseInt(t.slice(2*e,2*e+2),16);return s}return null}"hexadecimalIntegerAsNumber"(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}"decimalFloatingPoint"(e){return parseFloat(this[e])}"optionalFloat"(e,t){const s=this[e];return s?parseFloat(s):t}"enumeratedString"(e){return this[e]}"bool"(e){return"YES"===this[e]}"decimalResolution"(e){const t=E.exec(this[e]);if(null!==t)return{"width":parseInt(t[1],10),"height":parseInt(t[2],10)}}static"parseAttrList"(e){let t;const s={};for(S.lastIndex=0;null!==(t=S.exec(e));){let e=t[2];0===e.indexOf('"')&&e.lastIndexOf('"')===e.length-1&&(e=e.slice(1,-1));s[t[1].trim()]=e}return s}}function isSCTE35Attribute(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}class DateRange{"constructor"(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const s=t.attr;for(const t in s)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==s[t]){v.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=_extends(new AttrList({}),s,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=new Date(this.attr["END-DATE"]);h(e.getTime())&&(this._endDate=e)}}get"id"(){return this.attr.ID}get"class"(){return this.attr.CLASS}get"startDate"(){return this._startDate}get"endDate"(){if(this._endDate)return this._endDate;const e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}get"duration"(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(h(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get"plannedDuration"(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get"endOnNext"(){return this.attr.bool("END-ON-NEXT")}get"isValid"(){return!!this.id&&!this._badValueForSameId&&h(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class LoadStats{"constructor"(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={"start":0,"first":0,"end":0},this.parsing={"start":0,"end":0},this.buffering={"start":0,"first":0,"end":0}}}var L="audio",A="video",R="audiovideo";class BaseSegment{"constructor"(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[L]:null,[A]:null,[R]:null},this.baseurl=e}"setByteRange"(e,t){const s=e.split("@",2);let i;i=1===s.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(s[1]),this._byteRange=[i,parseInt(s[0])+i]}get"byteRange"(){return this._byteRange?this._byteRange:[]}get"byteRangeStartOffset"(){return this.byteRange[0]}get"byteRangeEndOffset"(){return this.byteRange[1]}get"url"(){return!this._url&&this.baseurl&&this.relurl&&(this._url=d.buildAbsoluteURL(this.baseurl,this.relurl,{"alwaysNormalize":!0})),this._url||""}set"url"(e){this._url=e}}class Fragment extends BaseSegment{"constructor"(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new LoadStats,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get"decryptdata"(){const{"levelkeys":e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}get"end"(){return this.start+this.duration}get"endProgramDateTime"(){if(null===this.programDateTime)return null;if(!h(this.programDateTime))return null;const e=h(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get"encrypted"(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),t=e.length;if(t>1||1===t&&this.levelkeys[e[0]].encrypted)return!0}return!1}"setKeyFormat"(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}"abortRequests"(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}"setElementaryStreamInfo"(e,t,s,i,r,n=!1){const{"elementaryStreams":a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,s),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,r)):a[e]={"startPTS":t,"endPTS":s,"startDTS":i,"endDTS":r,"partial":n}}"clearElementaryStreamInfo"(){const{"elementaryStreams":e}=this;e[L]=null,e[A]=null,e[R]=null}}class Part extends BaseSegment{"constructor"(e,t,s,i,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new LoadStats,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const n=e.enumeratedString("BYTERANGE");n&&this.setByteRange(n,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get"start"(){return this.fragment.start+this.fragOffset}get"end"(){return this.start+this.duration}get"loaded"(){const{"elementaryStreams":e}=this;return!!(e.audio||e.video||e.audiovideo)}}class LevelDetails{"constructor"(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}"reloaded"(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&s>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get"hasProgramDateTime"(){return!!this.fragments.length&&h(this.fragments[this.fragments.length-1].programDateTime)}get"levelTargetDuration"(){return this.averagetargetduration||this.targetduration||10}get"drift"(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get"edge"(){return this.partEnd||this.fragmentEnd}get"partEnd"(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get"fragmentEnd"(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}get"age"(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get"lastPartIndex"(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get"lastPartSn"(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function base64Decode(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))}function convertDataUriToArrayBytes(e){const t=e.split(":");let s=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),i=e[e.length-1].split(",");if(2===i.length){const t="base64"===i[0],r=i[1];t?(e.splice(-1,1),s=base64Decode(r)):s=function getKeyIdBytes(e){const t=strToUtf8array(e).subarray(0,16),s=new Uint8Array(16);return s.set(t,16-t.length),s}(r)}}return s}function strToUtf8array(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(e=>e.charCodeAt(0)))}const b="undefined"!=typeof self?self:void 0;var k={"CLEARKEY":"org.w3.clearkey","FAIRPLAY":"com.apple.fps","PLAYREADY":"com.microsoft.playready","WIDEVINE":"com.widevine.alpha"},D="org.w3.clearkey",C="com.apple.streamingkeydelivery",I="com.microsoft.playready",P="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function keySystemFormatToKeySystemDomain(e){switch(e){case C:return k.FAIRPLAY;case I:return k.PLAYREADY;case P:return k.WIDEVINE;case D:return k.CLEARKEY}}var w="1077efecc0b24d02ace33c1e52e2fb4b",x="e2719d58a985b3c9781ab030af78d30e",_="9a04f07998404286ab92e65be0885f95",M="edef8ba979d64acea3c827dcd51d21ed";function keySystemIdToKeySystemDomain(e){return e===M?k.WIDEVINE:e===_?k.PLAYREADY:e===w||e===x?k.CLEARKEY:void 0}function keySystemDomainToKeySystemFormat(e){switch(e){case k.FAIRPLAY:return C;case k.PLAYREADY:return I;case k.WIDEVINE:return P;case k.CLEARKEY:return D}}function getKeySystemsForConfig(e){const{"drmSystems":t,"widevineLicenseUrl":s}=e,i=t?[k.FAIRPLAY,k.WIDEVINE,k.PLAYREADY,k.CLEARKEY].filter((e=>!!t[e])):[];return!i[k.WIDEVINE]&&s&&i.push(k.WIDEVINE),i}const F=null!=b&&null!=(O=b.navigator)&&O.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var O;function parsePlayReadyWRM(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),s=String.fromCharCode.apply(null,Array.from(t)),i=s.substring(s.indexOf("<"),s.length),r=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(r){const e=r.childNodes[0]?r.childNodes[0].nodeValue:r.getAttribute("VALUE");if(e){const t=base64Decode(e).subarray(0,16);return function changeEndianness(e){const t=function swap(e,t,s){const i=e[t];e[t]=e[s],e[s]=i};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(t),t}}return null}function sliceUint8(e,t,s){return Uint8Array.prototype.slice?e.slice(t,s):new Uint8Array(Array.prototype.slice.call(e,t,s))}const isHeader$2=(e,t)=>t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,isFooter=(e,t)=>t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,getID3Data=(e,t)=>{const s=t;let i=0;for(;isHeader$2(e,t);){i+=10;i+=readSize(e,t+6),isFooter(e,t+10)&&(i+=10),t+=i}if(i>0)return e.subarray(s,s+i)},readSize=(e,t)=>{let s=0;return s=(127&e[t])<<21,s|=(127&e[t+1])<<14,s|=(127&e[t+2])<<7,s|=127&e[t+3],s},canParse$2=(e,t)=>isHeader$2(e,t)&&readSize(e,t+6)+10<=e.length-t,getTimeStamp=e=>{const t=getID3Frames(e);for(let e=0;e<t.length;e++){const s=t[e];if(isTimeStampFrame(s))return readTimeStamp(s)}},isTimeStampFrame=e=>e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info,getFrameData=e=>{const t=String.fromCharCode(e[0],e[1],e[2],e[3]),s=readSize(e,4);return{"type":t,"size":s,"data":e.subarray(10,10+s)}},getID3Frames=e=>{let t=0;const s=[];for(;isHeader$2(e,t);){const i=readSize(e,t+6);t+=10;const r=t+i;for(;t+8<r;){const i=getFrameData(e.subarray(t)),r=decodeFrame(i);r&&s.push(r),t+=i.size+10}isFooter(e,t)&&(t+=10)}return s},decodeFrame=e=>"PRIV"===e.type?decodePrivFrame(e):"W"===e.type[0]?decodeURLFrame(e):decodeTextFrame(e),decodePrivFrame=e=>{if(e.size<2)return;const t=utf8ArrayToStr(e.data,!0),s=new Uint8Array(e.data.subarray(t.length+1));return{"key":e.type,"info":t,"data":s.buffer}},decodeTextFrame=e=>{if(e.size<2)return;if("TXXX"===e.type){let t=1;const s=utf8ArrayToStr(e.data.subarray(t),!0);t+=s.length+1;const i=utf8ArrayToStr(e.data.subarray(t));return{"key":e.type,"info":s,"data":i}}const t=utf8ArrayToStr(e.data.subarray(1));return{"key":e.type,"data":t}},decodeURLFrame=e=>{if("WXXX"===e.type){if(e.size<2)return;let t=1;const s=utf8ArrayToStr(e.data.subarray(t),!0);t+=s.length+1;const i=utf8ArrayToStr(e.data.subarray(t));return{"key":e.type,"info":s,"data":i}}const t=utf8ArrayToStr(e.data);return{"key":e.type,"data":t}},readTimeStamp=e=>{if(8===e.data.byteLength){const t=new Uint8Array(e.data),s=1&t[3];let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,s&&(i+=47721858.84),Math.round(i)}},utf8ArrayToStr=(e,t=!1)=>{const s=getTextDecoder();if(s){const i=s.decode(e);if(t){const e=i.indexOf("\0");return-1!==e?i.substring(0,e):i}return i.replace(/\0/g,"")}const i=e.length;let r,n,a,o="",l=0;for(;l<i;){if(r=e[l++],0===r&&t)return o;if(0!==r&&3!==r)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:n=e[l++],o+=String.fromCharCode((31&r)<<6|63&n);break;case 14:n=e[l++],a=e[l++],o+=String.fromCharCode((15&r)<<12|(63&n)<<6|63&a)}}return o};let U;function getTextDecoder(){if(!navigator.userAgent.includes("PlayStation 4"))return U||void 0===self.TextDecoder||(U=new self.TextDecoder("utf-8")),U}const Hex_hexDump=function(e){let t="";for(let s=0;s<e.length;s++){let i=e[s].toString(16);i.length<2&&(i="0"+i),t+=i}return t},N=Math.pow(2,32)-1,B=[].push,$={"video":1,"audio":2,"id3":3,"text":4};function bin2str(e){return String.fromCharCode.apply(null,e)}function readUint16(e,t){const s=e[t]<<8|e[t+1];return s<0?65536+s:s}function readUint32(e,t){const s=readSint32(e,t);return s<0?4294967296+s:s}function readUint64(e,t){let s=readUint32(e,t);return s*=Math.pow(2,32),s+=readUint32(e,t+4),s}function readSint32(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function writeUint32(e,t,s){e[t]=s>>24,e[t+1]=s>>16&255,e[t+2]=s>>8&255,e[t+3]=255&s}function findBox(e,t){const s=[];if(!t.length)return s;const i=e.byteLength;for(let r=0;r<i;){const n=readUint32(e,r),a=n>1?r+n:i;if(bin2str(e.subarray(r+4,r+8))===t[0])if(1===t.length)s.push(e.subarray(r+8,a));else{const i=findBox(e.subarray(r+8,a),t.slice(1));i.length&&B.apply(s,i)}r=a}return s}function parseSegmentIndex(e){const t=[],s=e[0];let i=8;const r=readUint32(e,i);i+=4;let n=0,a=0;0===s?(n=readUint32(e,i),a=readUint32(e,i+4),i+=8):(n=readUint64(e,i),a=readUint64(e,i+8),i+=16),i+=2;let o=e.length+a;const l=readUint16(e,i);i+=2;for(let s=0;s<l;s++){let s=i;const n=readUint32(e,s);s+=4;const a=2147483647&n;if(1===(2147483648&n)>>>31)return v.warn("SIDX has hierarchical references (not supported)"),null;const l=readUint32(e,s);s+=4,t.push({"referenceSize":a,"subsegmentDuration":l,"info":{"duration":l/r,"start":o,"end":o+a-1}}),o+=a,s+=4,i=s}return{"earliestPresentationTime":n,"timescale":r,"version":s,"referencesCount":l,"references":t}}function parseInitSegment(e){const t=[],s=findBox(e,["moov","trak"]);for(let e=0;e<s.length;e++){const i=s[e],r=findBox(i,["tkhd"])[0];if(r){let e=r[0];const s=readUint32(r,0===e?12:20),n=findBox(i,["mdia","mdhd"])[0];if(n){e=n[0];const r=readUint32(n,0===e?12:20),a=findBox(i,["mdia","hdlr"])[0];if(a){const e=bin2str(a.subarray(8,12)),n={"soun":L,"vide":A}[e];if(n){const e=parseStsd(findBox(i,["mdia","minf","stbl","stsd"])[0]);t[s]={"timescale":r,"type":n},t[n]=_objectSpread2({"timescale":r,"id":s},e)}}}}}return findBox(e,["moov","mvex","trex"]).forEach((e=>{const s=readUint32(e,4),i=t[s];i&&(i.default={"duration":readUint32(e,12),"flags":readUint32(e,20)})})),t}function parseStsd(e){const t=e.subarray(8),s=t.subarray(86),i=bin2str(t.subarray(4,8));let r=i;const n="enca"===i||"encv"===i;if(n){const e=findBox(t,[i])[0];findBox(e.subarray("enca"===i?28:78),["sinf"]).forEach((e=>{const t=findBox(e,["schm"])[0];if(t){const s=bin2str(t.subarray(4,8));if("cbcs"===s||"cenc"===s){const t=findBox(e,["frma"])[0];t&&(r=bin2str(t))}}}))}switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const e=findBox(s,["avcC"])[0];r+="."+toHex(e[1])+toHex(e[2])+toHex(e[3]);break}case"mp4a":{const e=findBox(t,[i])[0],s=findBox(e.subarray(28),["esds"])[0];if(s&&s.length>12){let e=4;if(3!==s[e++])break;e=skipBERInteger(s,e),e+=2;const t=s[e++];if(128&t&&(e+=2),64&t&&(e+=s[e++]),4!==s[e++])break;e=skipBERInteger(s,e);const i=s[e++];if(64!==i)break;if(r+="."+toHex(i),e+=12,5!==s[e++])break;e=skipBERInteger(s,e);const n=s[e++];let a=(248&n)>>3;31===a&&(a+=1+((7&n)<<3)+((224&s[e])>>5)),r+="."+a}break}case"hvc1":case"hev1":{const e=findBox(s,["hvcC"])[0],t=e[1],i=["","A","B","C"][t>>6],n=31&t,a=readUint32(e,2),o=(32&t)>>5?"H":"L",l=e[12],d=e.subarray(6,12);r+="."+i+n,r+="."+a.toString(16).toUpperCase(),r+="."+o+l;let h="";for(let e=d.length;e--;){const t=d[e];if(t||h){h="."+t.toString(16).toUpperCase()+h}}r+=h;break}case"dvh1":case"dvhe":{const e=findBox(s,["dvcC"])[0],t=e[2]>>1&127,i=e[2]<<5&32|e[3]>>3&31;r+="."+addLeadingZero(t)+"."+addLeadingZero(i);break}case"vp09":{const e=findBox(s,["vpcC"])[0],t=e[4],i=e[5],n=e[6]>>4&15;r+="."+addLeadingZero(t)+"."+addLeadingZero(i)+"."+addLeadingZero(n);break}case"av01":{const e=findBox(s,["av1C"])[0],t=e[1]>>>5,i=31&e[1],n=e[2]>>>7?"H":"M",a=(64&e[2])>>6,o=(32&e[2])>>5,l=2===t&&a?o?12:10:a?10:8,d=(16&e[2])>>4,h=(8&e[2])>>3,c=(4&e[2])>>2,u=3&e[2],f=1,g=1,m=1,p=0;r+="."+t+"."+addLeadingZero(i)+n+"."+addLeadingZero(l)+"."+d+"."+h+c+u+"."+addLeadingZero(f)+"."+addLeadingZero(g)+"."+addLeadingZero(m)+"."+p;break}}return{"codec":r,"encrypted":n}}function skipBERInteger(e,t){const s=t+5;for(;128&e[t++]&&t<s;);return t}function toHex(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function addLeadingZero(e){return(e<10?"0":"")+e}function parseSinf(e){const t=findBox(e,["schm"])[0];if(t){const s=bin2str(t.subarray(4,8));if("cbcs"===s||"cenc"===s)return findBox(e,["schi","tenc"])[0]}return null}function computeRawDurationFromSamples(e){const t=readUint32(e,0);let s=8;1&t&&(s+=4),4&t&&(s+=4);let i=0;const r=readUint32(e,4);for(let n=0;n<r;n++){if(256&t){i+=readUint32(e,s),s+=4}512&t&&(s+=4),1024&t&&(s+=4),2048&t&&(s+=4)}return i}function appendUint8Array(e,t){const s=new Uint8Array(e.length+t.length);return s.set(e),s.set(t,e.length),s}function parseSamples(e,t){const s=[],i=t.samples,r=t.timescale,n=t.id;let a=!1;return findBox(i,["moof"]).map((o=>{const l=o.byteOffset-8;findBox(o,["traf"]).map((o=>{const d=findBox(o,["tfdt"]).map((e=>{const t=e[0];let s=readUint32(e,4);return 1===t&&(s*=Math.pow(2,32),s+=readUint32(e,8)),s/r}))[0];return void 0!==d&&(e=d),findBox(o,["tfhd"]).map((d=>{const h=readUint32(d,4),c=16777215&readUint32(d,0);let u=0;const f=!!(16&c);let g=0;const m=!!(32&c);let p=8;h===n&&(!!(1&c)&&(p+=8),!!(2&c)&&(p+=4),!!(8&c)&&(u=readUint32(d,p),p+=4),f&&(g=readUint32(d,p),p+=4),m&&(p+=4),"video"===t.type&&(a=function isHEVC(e){if(!e)return!1;const t=e.indexOf("."),s=t<0?e:e.substring(0,t);return"hvc1"===s||"hev1"===s||"dvh1"===s||"dvhe"===s}(t.codec)),findBox(o,["trun"]).map((n=>{const o=n[0],d=16777215&readUint32(n,0),h=!!(1&d);let c=0;const f=!!(4&d),m=!!(256&d);let p=0;const y=!!(512&d);let T=0;const v=!!(1024&d),E=!!(2048&d);let S=0;const L=readUint32(n,4);let R=8;h&&(c=readUint32(n,R),R+=4),f&&(R+=4);let b=c+l;for(let l=0;l<L;l++){if(m?(p=readUint32(n,R),R+=4):p=u,y?(T=readUint32(n,R),R+=4):T=g,v&&(R+=4),E&&(S=0===o?readUint32(n,R):readSint32(n,R),R+=4),t.type===A){let t=0;for(;t<T;){const n=readUint32(i,b);if(b+=4,isSEIMessage(a,i[b])){parseSEIMessageFromNALu(i.subarray(b,b+n),a?2:1,e+S/r,s)}b+=n,t+=n+4}}e+=p/r}})))}))}))})),s}function isSEIMessage(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function parseSEIMessageFromNALu(e,t,s,i){const r=discardEPB(e);let n=0;n+=t;let a=0,o=0,l=0;for(;n<r.length;){a=0;do{if(n>=r.length)break;l=r[n++],a+=l}while(255===l);o=0;do{if(n>=r.length)break;l=r[n++],o+=l}while(255===l);const e=r.length-n;let t=n;if(o<e)n+=o;else if(o>e){v.error(`Malformed SEI payload. ${o} is too small, only ${e} bytes left to parse.`);break}if(4===a){if(181===r[t++]){const e=readUint16(r,t);if(t+=2,49===e){const e=readUint32(r,t);if(t+=4,1195456820===e){const e=r[t++];if(3===e){const n=r[t++],o=64&n,l=o?2+3*(31&n):0,d=new Uint8Array(l);if(o){d[0]=n;for(let e=1;e<l;e++)d[e]=r[t++]}i.push({"type":e,"payloadType":a,"pts":s,"bytes":d})}}}}}else if(5===a&&o>16){const e=[];for(let s=0;s<16;s++){const i=r[t++].toString(16);e.push(1==i.length?"0"+i:i),3!==s&&5!==s&&7!==s&&9!==s||e.push("-")}const n=o-16,l=new Uint8Array(n);for(let e=0;e<n;e++)l[e]=r[t++];i.push({"payloadType":a,"pts":s,"uuid":e.join(""),"userData":utf8ArrayToStr(l),"userDataBytes":l})}}}function discardEPB(e){const t=e.byteLength,s=[];let i=1;for(;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(s.push(i+2),i+=2):i++;if(0===s.length)return e;const r=t-s.length,n=new Uint8Array(r);let a=0;for(i=0;i<r;a++,i++)a===s[0]&&(a++,s.shift()),n[i]=e[a];return n}function mp4pssh(e,t,s){if(16!==e.byteLength)throw new RangeError("Invalid system id");let i,r,n;if(t){i=1,r=new Uint8Array(16*t.length);for(let e=0;e<t.length;e++){const s=t[e];if(16!==s.byteLength)throw new RangeError("Invalid key");r.set(s,16*e)}}else i=0,r=new Uint8Array;i>0?(n=new Uint8Array(4),t.length>0&&new DataView(n.buffer).setUint32(0,t.length,!1)):n=new Uint8Array;const a=new Uint8Array(4);return s&&s.byteLength>0&&new DataView(a.buffer).setUint32(0,s.byteLength,!1),function mp4Box(e,...t){const s=t.length;let i=8,r=s;for(;r--;)i+=t[r].byteLength;const n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=255&i,n.set(e,4),r=0,i=8;r<s;r++)n.set(t[r],i),i+=t[r].byteLength;return n}([112,115,115,104],new Uint8Array([i,0,0,0]),e,n,r,a,s||new Uint8Array)}function parsePssh(e){const t=e.getUint32(0),s=e.byteOffset,i=e.byteLength;if(i<t)return{"offset":s,"size":i};if(1886614376!==e.getUint32(4))return{"offset":s,"size":t};const r=e.getUint32(8)>>>24;if(0!==r&&1!==r)return{"offset":s,"size":t};const n=e.buffer,a=Hex_hexDump(new Uint8Array(n,s+12,16)),o=e.getUint32(28);let l=null,d=null;if(0===r){if(t-32<o||o<22)return{"offset":s,"size":t};d=new Uint8Array(n,s+32,o)}else if(1===r){if(!o||i<s+32+16*o+16)return{"offset":s,"size":t};l=[];for(let e=0;e<o;e++)l.push(new Uint8Array(n,s+32+16*e,16))}return{"version":r,"systemId":a,"kids":l,"data":d,"offset":s,"size":t}}let G={};class LevelKey{static"clearKeyUriToKeyIdMap"(){G={}}"constructor"(e,t,s,i=[1],r=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=i,this.iv=r,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}"isSupported"(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case C:case P:case I:case D:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}"getDecryptData"(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"!==this.method||this.iv||v.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const t=function createInitializationVector(e){const t=new Uint8Array(16);for(let s=12;s<16;s++)t[s]=e>>8*(15-s)&255;return t}(e);return new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,t)}const t=convertDataUriToArrayBytes(this.uri);if(t)switch(this.keyFormat){case P:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case I:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(e,null,t),this.keyId=parsePlayReadyWRM(t);break}default:{let e=t.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e=G[this.uri];if(!e){const t=Object.keys(G).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);new DataView(e.buffer,12,4).setUint32(0,t),G[this.uri]=e}this.keyId=e}return this}}const K=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(e){return K.test(e)}function substituteVariablesInAttributes(e,t,s){if(null!==e.variableList||e.hasVariableRefs)for(let i=s.length;i--;){const r=s[i],n=t[r];n&&(t[r]=substituteVariables(e,n))}}function substituteVariables(e,t){if(null!==e.variableList||e.hasVariableRefs){const s=e.variableList;return t.replace(K,(t=>{const i=t.substring(2,t.length-1),r=null==s?void 0:s[i];return void 0===r?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),t):r}))}return t}function addVariableDefinition(e,t,s){let i,r,n=e.variableList;if(n||(e.variableList=n={}),"QUERYPARAM"in t){i=t.QUERYPARAM;try{const e=new self.URL(s).searchParams;if(!e.has(i))throw new Error(`"${i}" does not match any query parameter in URI: "${s}"`);r=e.get(i)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${t.message}`))}}else i=t.NAME,r=t.VALUE;i in n?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):n[i]=r||""}function importVariableDefinition(e,t,s){const i=t.IMPORT;if(s&&i in s){let t=e.variableList;t||(e.variableList=t={}),t[i]=s[i]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}function getMediaSource(e=!0){if("undefined"==typeof self)return;return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}const H={"audio":{"a3ds":1,"ac-3":.95,"ac-4":1,"alac":.9,"alaw":1,"dra1":1,"dts+":1,"dts-":1,"dtsc":1,"dtse":1,"dtsh":1,"ec-3":.9,"enca":1,"fLaC":.9,"flac":.9,"FLAC":.9,"g719":1,"g726":1,"m4ae":1,"mha1":1,"mha2":1,"mhm1":1,"mhm2":1,"mlpa":1,"mp4a":1,"raw ":1,"Opus":1,"opus":1,"samr":1,"sawb":1,"sawp":1,"sevc":1,"sqcp":1,"ssmv":1,"twos":1,"ulaw":1},"video":{"avc1":1,"avc2":1,"avc3":1,"avc4":1,"avcp":1,"av01":.8,"drac":1,"dva1":1,"dvav":1,"dvh1":.7,"dvhe":.7,"encv":1,"hev1":.75,"hvc1":.75,"mjp2":1,"mp4v":1,"mvc1":1,"mvc2":1,"mvc3":1,"mvc4":1,"resv":1,"rv60":1,"s263":1,"svc1":1,"svc2":1,"vc-1":1,"vp08":1,"vp09":.9},"text":{"stpp":1,"wvtt":1}};function areCodecsMediaSourceSupported(e,t,s=!0){return!e.split(",").some((e=>!isCodecMediaSourceSupported(e,t,s)))}function isCodecMediaSourceSupported(e,t,s=!0){var i;const r=getMediaSource(s);return null!=(i=null==r?void 0:r.isTypeSupported(mimeTypeForCodec(e,t)))&&i}function mimeTypeForCodec(e,t){return`${t}/mp4;codecs="${e}"`}function videoCodecPreferenceValue(e){if(e){const t=e.substring(0,4);return H.video[t]}return 2}function codecsSetSelectionPreferenceValue(e){return e.split(",").reduce(((e,t)=>{const s=H.video[t];return s?(2*s+e)/(e?3:2):(H.audio[t]+e)/(e?2:1)}),0)}const V={};const W=/flac|opus/i;function getCodecCompatibleName(e,t=!0){return e.replace(W,(e=>function getCodecCompatibleNameLower(e,t=!0){if(V[e])return V[e];const s={"flac":["flac","fLaC","FLAC"],"opus":["opus","Opus"]}[e];for(let i=0;i<s.length;i++)if(isCodecMediaSourceSupported(s[i],"audio",t))return V[e]=s[i],s[i];return e}(e.toLowerCase(),t)))}function pickMostCompleteCodecName(e,t){return e&&"mp4a"!==e?e:t?t.split(",")[0]:t}const Y=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,j=/#EXT-X-MEDIA:(.*)/g,q=/^#EXT(?:INF|-X-TARGETDURATION):/m,z=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),X=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class M3U8Parser{static"findGroup"(e,t){for(let s=0;s<e.length;s++){const i=e[s];if(i.id===t)return i}}static"resolve"(e,t){return d.buildAbsoluteURL(t,e,{"alwaysNormalize":!0})}static"isMediaPlaylist"(e){return q.test(e)}static"parseMasterPlaylist"(e,t){const s={"contentSteering":null,"levels":[],"playlistParsingError":null,"sessionData":null,"sessionKeys":null,"startTimeOffset":null,"variableList":null,"hasVariableRefs":hasVariableReferences(e)},i=[];let r;for(Y.lastIndex=0;null!=(r=Y.exec(e));)if(r[1]){var n;const e=new AttrList(r[1]);substituteVariablesInAttributes(s,e,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const a=substituteVariables(s,r[2]),o={"attrs":e,"bitrate":e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),"name":e.NAME,"url":M3U8Parser.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),setCodecs(e.CODECS,o),null!=(n=o.unknownCodecs)&&n.length||i.push(o),s.levels.push(o)}else if(r[3]){const e=r[3],i=r[4];switch(e){case"SESSION-DATA":{const e=new AttrList(i);substituteVariablesInAttributes(s,e,["DATA-ID","LANGUAGE","VALUE","URI"]);const t=e["DATA-ID"];t&&(null===s.sessionData&&(s.sessionData={}),s.sessionData[t]=e);break}case"SESSION-KEY":{const e=parseKey(i,t,s);e.encrypted&&e.isSupported()?(null===s.sessionKeys&&(s.sessionKeys=[]),s.sessionKeys.push(e)):v.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${i}"`);break}case"DEFINE":{const e=new AttrList(i);substituteVariablesInAttributes(s,e,["NAME","VALUE","QUERYPARAM"]),addVariableDefinition(s,e,t)}break;case"CONTENT-STEERING":{const e=new AttrList(i);substituteVariablesInAttributes(s,e,["SERVER-URI","PATHWAY-ID"]),s.contentSteering={"uri":M3U8Parser.resolve(e["SERVER-URI"],t),"pathwayId":e["PATHWAY-ID"]||"."};break}case"START":s.startTimeOffset=parseStartTimeOffset(i)}}const a=i.length>0&&i.length<s.levels.length;return s.levels=a?i:s.levels,0===s.levels.length&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static"parseMasterPlaylistMedia"(e,t,s){let i;const r={},n=s.levels,a={"AUDIO":n.map((e=>({"id":e.attrs.AUDIO,"audioCodec":e.audioCodec}))),"SUBTITLES":n.map((e=>({"id":e.attrs.SUBTITLES,"textCodec":e.textCodec}))),"CLOSED-CAPTIONS":[]};let o=0;for(j.lastIndex=0;null!==(i=j.exec(e));){const e=new AttrList(i[1]),n=e.TYPE;if(n){const i=a[n],l=r[n]||[];r[n]=l,substituteVariablesInAttributes(s,e,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const d=e.LANGUAGE,h=e["ASSOC-LANGUAGE"],c=e.CHANNELS,u=e.CHARACTERISTICS,f=e["INSTREAM-ID"],g={"attrs":e,"bitrate":0,"id":o++,"groupId":e["GROUP-ID"]||"","name":e.NAME||d||"","type":n,"default":e.bool("DEFAULT"),"autoselect":e.bool("AUTOSELECT"),"forced":e.bool("FORCED"),"lang":d,"url":e.URI?M3U8Parser.resolve(e.URI,t):""};if(h&&(g.assocLang=h),c&&(g.channels=c),u&&(g.characteristics=u),f&&(g.instreamId=f),null!=i&&i.length){const e=M3U8Parser.findGroup(i,g.groupId)||i[0];assignCodec(g,e,"audioCodec"),assignCodec(g,e,"textCodec")}l.push(g)}}return r}static"parseLevelPlaylist"(e,t,s,i,r,n){const a=new LevelDetails(t),o=a.fragments;let l,d,c,u=null,f=0,g=0,m=0,p=0,y=null,T=new Fragment(i,t),E=-1,S=!1,L=null;for(z.lastIndex=0,a.m3u8=e,a.hasVariableRefs=hasVariableReferences(e);null!==(l=z.exec(e));){S&&(S=!1,T=new Fragment(i,t),T.start=m,T.sn=f,T.cc=p,T.level=s,u&&(T.initSegment=u,T.rawProgramDateTime=u.rawProgramDateTime,u.rawProgramDateTime=null,L&&(T.setByteRange(L),L=null)));const e=l[1];if(e){T.duration=parseFloat(e);const t=(" "+l[2]).slice(1);T.title=t||null,T.tagList.push(t?["INF",e,t]:["INF",e])}else if(l[3]){if(h(T.duration)){T.start=m,c&&setFragLevelKeys(T,c,a),T.sn=f,T.level=s,T.cc=p,o.push(T);const e=(" "+l[3]).slice(1);T.relurl=substituteVariables(a,e),assignProgramDateTime(T,y),y=T,m+=T.duration,f++,g=0,S=!0}}else if(l[4]){const e=(" "+l[4]).slice(1);y?T.setByteRange(e,y):T.setByteRange(e)}else if(l[5])T.rawProgramDateTime=(" "+l[5]).slice(1),T.tagList.push(["PROGRAM-DATE-TIME",T.rawProgramDateTime]),-1===E&&(E=o.length);else{if(l=l[0].match(X),!l){v.warn("No matches on slow regex match for level playlist!");continue}for(d=1;d<l.length&&void 0===l[d];d++);const e=(" "+l[d]).slice(1),r=(" "+l[d+1]).slice(1),m=l[d+2]?(" "+l[d+2]).slice(1):"";switch(e){case"PLAYLIST-TYPE":a.type=r.toUpperCase();break;case"MEDIA-SEQUENCE":f=a.startSN=parseInt(r);break;case"SKIP":{const e=new AttrList(r);substituteVariablesInAttributes(a,e,["RECENTLY-REMOVED-DATERANGES"]);const t=e.decimalInteger("SKIPPED-SEGMENTS");if(h(t)){a.skippedSegments=t;for(let e=t;e--;)o.unshift(null);f+=t}const s=e.enumeratedString("RECENTLY-REMOVED-DATERANGES");s&&(a.recentlyRemovedDateranges=s.split("\t"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(r),1);break;case"VERSION":a.version=parseInt(r);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(r||m)&&T.tagList.push(m?[r,m]:[r]);break;case"DISCONTINUITY":p++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([e]);break;case"BITRATE":T.tagList.push([e,r]);break;case"DATERANGE":{const e=new AttrList(r);substituteVariablesInAttributes(a,e,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),substituteVariablesInAttributes(a,e,e.clientAttrs);const t=new DateRange(e,a.dateRanges[e.ID]);t.isValid||a.skippedSegments?a.dateRanges[t.id]=t:v.warn(`Ignoring invalid DATERANGE tag: "${r}"`),T.tagList.push(["EXT-X-DATERANGE",r]);break}case"DEFINE":{const e=new AttrList(r);substituteVariablesInAttributes(a,e,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in e?importVariableDefinition(a,e,n):addVariableDefinition(a,e,t)}break;case"DISCONTINUITY-SEQUENCE":p=parseInt(r);break;case"KEY":{const e=parseKey(r,t,a);if(e.isSupported()){if("NONE"===e.method){c=void 0;break}c||(c={}),c[e.keyFormat]&&(c=_extends({},c)),c[e.keyFormat]=e}else v.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${r}"`);break}case"START":a.startTimeOffset=parseStartTimeOffset(r);break;case"MAP":{const e=new AttrList(r);if(substituteVariablesInAttributes(a,e,["BYTERANGE","URI"]),T.duration){const r=new Fragment(i,t);setInitSegment(r,e,s,c),u=r,T.initSegment=u,u.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=u.rawProgramDateTime)}else{const t=T.byteRangeEndOffset;if(t){const e=T.byteRangeStartOffset;L=`${t-e}@${e}`}else L=null;setInitSegment(T,e,s,c),u=T,S=!0}break}case"SERVER-CONTROL":{const e=new AttrList(r);a.canBlockReload=e.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=e.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&e.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=e.optionalFloat("PART-HOLD-BACK",0),a.holdBack=e.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const e=new AttrList(r);a.partTarget=e.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=a.partList;e||(e=a.partList=[]);const s=g>0?e[e.length-1]:void 0,i=g++,n=new AttrList(r);substituteVariablesInAttributes(a,n,["BYTERANGE","URI"]);const o=new Part(n,T,t,i,s);e.push(o),T.duration+=o.duration;break}case"PRELOAD-HINT":{const e=new AttrList(r);substituteVariablesInAttributes(a,e,["URI"]),a.preloadHint=e;break}case"RENDITION-REPORT":{const e=new AttrList(r);substituteVariablesInAttributes(a,e,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push(e);break}default:v.warn(`line parsed but not handled: ${l}`)}}}y&&!y.relurl?(o.pop(),m-=y.duration,a.partList&&(a.fragmentHint=y)):a.partList&&(assignProgramDateTime(T,y),T.cc=p,a.fragmentHint=T,c&&setFragLevelKeys(T,c,a));const A=o.length,R=o[0],b=o[A-1];if(m+=a.skippedSegments*a.targetduration,m>0&&A&&b){a.averagetargetduration=m/A;const e=b.sn;a.endSN="initSegment"!==e?e:0,a.live||(b.endList=!0),R&&(a.startCC=R.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(m+=a.fragmentHint.duration),a.totalduration=m,a.endCC=p,E>0&&function backfillProgramDateTimes(e,t){let s=e[t];for(let i=t;i--;){const t=e[i];if(!t)return;t.programDateTime=s.programDateTime-1e3*t.duration,s=t}}(o,E),a}}function parseKey(e,t,s){var i,r;const n=new AttrList(e);substituteVariablesInAttributes(s,n,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const a=null!=(i=n.METHOD)?i:"",o=n.URI,l=n.hexadecimalInteger("IV"),d=n.KEYFORMATVERSIONS,h=null!=(r=n.KEYFORMAT)?r:"identity";o&&n.IV&&!l&&v.error(`Invalid IV: ${n.IV}`);const c=o?M3U8Parser.resolve(o,t):"",u=(d||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(a,c,h,u,l)}function parseStartTimeOffset(e){const t=new AttrList(e).decimalFloatingPoint("TIME-OFFSET");return h(t)?t:null}function setCodecs(e,t){let s=(e||"").split(/[ ,]+/).filter((e=>e));["video","audio","text"].forEach((e=>{const i=s.filter((t=>function isCodecType(e,t){const s=H[t];return!!s&&!!s[e.slice(0,4)]}(t,e)));i.length&&(t[`${e}Codec`]=i.join(","),s=s.filter((e=>-1===i.indexOf(e))))})),t.unknownCodecs=s}function assignCodec(e,t,s){const i=t[s];i&&(e[s]=i)}function assignProgramDateTime(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),h(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function setInitSegment(e,t,s,i){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=s,e.sn="initSegment",i&&(e.levelkeys=i),e.initSegment=null}function setFragLevelKeys(e,t,s){e.levelkeys=t;const{"encryptedFragments":i}=s;i.length&&i[i.length-1].levelkeys===t||!Object.keys(t).some((e=>t[e].isCommonEncryption))||i.push(e)}var Q="manifest",J="level",Z="audioTrack",ee="subtitleTrack",te="main",se="audio",ie="subtitle";function mapContextToLevelType(e){const{"type":t}=e;switch(t){case Z:return se;case ee:return ie;default:return te}}function getResponseUrl(e,t){let s=e.url;return void 0!==s&&0!==s.indexOf("data:")||(s=t.url),s}class PlaylistLoader{"constructor"(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}"startLoad"(e){}"stopLoad"(){this.destroyInternalLoaders()}"registerListeners"(){const{"hls":e}=this;e.on(f.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.LEVEL_LOADING,this.onLevelLoading,this),e.on(f.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(f.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}"unregisterListeners"(){const{"hls":e}=this;e.off(f.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.LEVEL_LOADING,this.onLevelLoading,this),e.off(f.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(f.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}"createInternalLoader"(e){const t=this.hls.config,s=t.pLoader,i=t.loader,r=new(s||i)(t);return this.loaders[e.type]=r,r}"getInternalLoader"(e){return this.loaders[e.type]}"resetInternalLoader"(e){this.loaders[e]&&delete this.loaders[e]}"destroyInternalLoaders"(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}"destroy"(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}"onManifestLoading"(e,t){const{"url":s}=t;this.variableList=null,this.load({"id":null,"level":0,"responseType":"text","type":Q,"url":s,"deliveryDirectives":null})}"onLevelLoading"(e,t){const{"id":s,"level":i,"pathwayId":r,"url":n,"deliveryDirectives":a}=t;this.load({"id":s,"level":i,"pathwayId":r,"responseType":"text","type":J,"url":n,"deliveryDirectives":a})}"onAudioTrackLoading"(e,t){const{"id":s,"groupId":i,"url":r,"deliveryDirectives":n}=t;this.load({"id":s,"groupId":i,"level":null,"responseType":"text","type":Z,"url":r,"deliveryDirectives":n})}"onSubtitleTrackLoading"(e,t){const{"id":s,"groupId":i,"url":r,"deliveryDirectives":n}=t;this.load({"id":s,"groupId":i,"level":null,"responseType":"text","type":ee,"url":r,"deliveryDirectives":n})}"load"(e){var t;const s=this.hls.config;let i,r=this.getInternalLoader(e);if(r){const t=r.context;if(t&&t.url===e.url&&t.level===e.level)return void v.trace("[playlist-loader]: playlist request ongoing");v.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}if(i=e.type===Q?s.manifestLoadPolicy.default:_extends({},s.playlistLoadPolicy.default,{"timeoutRetry":null,"errorRetry":null}),r=this.createInternalLoader(e),h(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===J&&null!==e.level?t=this.hls.levels[e.level].details:e.type===Z&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===ee&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,s=t.targetduration;if(e&&s){const t=1e3*Math.max(3*e,.8*s);i=_extends({},i,{"maxTimeToFirstByteMs":Math.min(t,i.maxTimeToFirstByteMs),"maxLoadTimeMs":Math.min(t,i.maxTimeToFirstByteMs)})}}}const n=i.errorRetry||i.timeoutRetry||{},a={"loadPolicy":i,"timeout":i.maxLoadTimeMs,"maxRetry":n.maxNumRetry||0,"retryDelay":n.retryDelayMs||0,"maxRetryDelay":n.maxRetryDelayMs||0},o={"onSuccess":(e,t,s,i)=>{const r=this.getInternalLoader(s);this.resetInternalLoader(s.type);const n=e.data;0===n.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(n)?this.handleTrackOrLevelPlaylist(e,t,s,i||null,r):this.handleMasterPlaylist(e,t,s,i)):this.handleManifestParsingError(e,s,new Error("no EXTM3U delimiter"),i||null,t)},"onError":(e,t,s,i)=>{this.handleNetworkError(t,s,!1,e,i)},"onTimeout":(e,t,s)=>{this.handleNetworkError(t,s,!0,void 0,e)}};r.load(e,a,o)}"handleMasterPlaylist"(e,t,s,i){const r=this.hls,n=e.data,a=getResponseUrl(e,s),o=M3U8Parser.parseMasterPlaylist(n,a);if(o.playlistParsingError)return void this.handleManifestParsingError(e,s,o.playlistParsingError,i,t);const{"contentSteering":l,"levels":d,"sessionData":h,"sessionKeys":c,"startTimeOffset":u,"variableList":g}=o;this.variableList=g;const{"AUDIO":m=[],"SUBTITLES":p,"CLOSED-CAPTIONS":y}=M3U8Parser.parseMasterPlaylistMedia(n,a,o);if(m.length){m.some((e=>!e.url))||!d[0].audioCodec||d[0].attrs.AUDIO||(v.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({"type":"main","name":"main","groupId":"main","default":!1,"autoselect":!1,"forced":!1,"id":-1,"attrs":new AttrList({}),"bitrate":0,"url":""}))}r.trigger(f.MANIFEST_LOADED,{"levels":d,"audioTracks":m,"subtitles":p,"captions":y,"contentSteering":l,"url":a,"stats":t,"networkDetails":i,"sessionData":h,"sessionKeys":c,"startTimeOffset":u,"variableList":g})}"handleTrackOrLevelPlaylist"(e,t,s,i,r){const n=this.hls,{"id":a,"level":o,"type":l}=s,d=getResponseUrl(e,s),c=h(o)?o:h(a)?a:0,u=mapContextToLevelType(s),g=M3U8Parser.parseLevelPlaylist(e.data,d,c,u,0,this.variableList);if(l===Q){const e={"attrs":new AttrList({}),"bitrate":0,"details":g,"name":"","url":d};n.trigger(f.MANIFEST_LOADED,{"levels":[e],"audioTracks":[],"url":d,"stats":t,"networkDetails":i,"sessionData":null,"sessionKeys":null,"contentSteering":null,"startTimeOffset":null,"variableList":null})}t.parsing.end=performance.now(),s.levelDetails=g,this.handlePlaylistLoaded(g,e,t,s,i,r)}"handleManifestParsingError"(e,t,s,i,r){this.hls.trigger(f.ERROR,{"type":g.NETWORK_ERROR,"details":m.MANIFEST_PARSING_ERROR,"fatal":t.type===Q,"url":e.url,"err":s,"error":s,"reason":s.message,"response":e,"context":t,"networkDetails":i,"stats":r})}"handleNetworkError"(e,t,s=!1,i,r){let n=`A network ${s?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===J?n+=`: ${e.level} id: ${e.id}`:e.type!==Z&&e.type!==ee||(n+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(n);v.warn(`[playlist-loader]: ${n}`);let o=m.UNKNOWN,l=!1;const d=this.getInternalLoader(e);switch(e.type){case Q:o=s?m.MANIFEST_LOAD_TIMEOUT:m.MANIFEST_LOAD_ERROR,l=!0;break;case J:o=s?m.LEVEL_LOAD_TIMEOUT:m.LEVEL_LOAD_ERROR,l=!1;break;case Z:o=s?m.AUDIO_TRACK_LOAD_TIMEOUT:m.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case ee:o=s?m.SUBTITLE_TRACK_LOAD_TIMEOUT:m.SUBTITLE_LOAD_ERROR,l=!1}d&&this.resetInternalLoader(e.type);const h={"type":g.NETWORK_ERROR,"details":o,"fatal":l,"url":e.url,"loader":d,"context":e,"error":a,"networkDetails":t,"stats":r};if(i){const s=(null==t?void 0:t.url)||e.url;h.response=_objectSpread2({"url":s,"data":void 0},i)}this.hls.trigger(f.ERROR,h)}"handlePlaylistLoaded"(e,t,s,i,r,n){const a=this.hls,{"type":o,"level":l,"id":d,"groupId":h,"deliveryDirectives":c}=i,u=getResponseUrl(t,i),p=mapContextToLevelType(i),y="number"==typeof i.level&&p===te?l:void 0;if(!e.fragments.length){const e=new Error("No Segments found in Playlist");return void a.trigger(f.ERROR,{"type":g.NETWORK_ERROR,"details":m.LEVEL_EMPTY_ERROR,"fatal":!1,"url":u,"error":e,"reason":e.message,"response":t,"context":i,"level":y,"parent":p,"networkDetails":r,"stats":s})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const T=e.playlistParsingError;if(T)a.trigger(f.ERROR,{"type":g.NETWORK_ERROR,"details":m.LEVEL_PARSING_ERROR,"fatal":!1,"url":u,"error":T,"reason":T.message,"response":t,"context":i,"level":y,"parent":p,"networkDetails":r,"stats":s});else switch(e.live&&n&&(n.getCacheAge&&(e.ageHeader=n.getCacheAge()||0),n.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case Q:case J:a.trigger(f.LEVEL_LOADED,{"details":e,"level":y||0,"id":d||0,"stats":s,"networkDetails":r,"deliveryDirectives":c});break;case Z:a.trigger(f.AUDIO_TRACK_LOADED,{"details":e,"id":d||0,"groupId":h||"","stats":s,"networkDetails":r,"deliveryDirectives":c});break;case ee:a.trigger(f.SUBTITLE_TRACK_LOADED,{"details":e,"id":d||0,"groupId":h||"","stats":s,"networkDetails":r,"deliveryDirectives":c})}}}function sendAddTrackEvent(e,t){let s;try{s=new Event("addtrack")}catch(e){s=document.createEvent("Event"),s.initEvent("addtrack",!1,!1)}s.track=e,t.dispatchEvent(s)}function addCueToTrack(e,t){const s=e.mode;if("disabled"===s&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(s){v.debug(`[texttrack-utils]: ${s}`);try{const s=new self.TextTrackCue(t.startTime,t.endTime,t.text);s.id=t.id,e.addCue(s)}catch(e){v.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${e}`)}}"disabled"===s&&(e.mode=s)}function clearCurrentCues(e){const t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(let t=e.cues.length;t--;)e.removeCue(e.cues[t]);"disabled"===t&&(e.mode=t)}function removeCuesInRange(e,t,s,i){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0){const r=function getCuesInRange(e,t,s){const i=[],r=function getFirstCueIndexAfterTime(e,t){if(t<e[0].startTime)return 0;const s=e.length-1;if(t>e[s].endTime)return-1;let i=0,r=s;for(;i<=r;){const n=Math.floor((r+i)/2);if(t<e[n].startTime)r=n-1;else{if(!(t>e[n].startTime&&i<s))return n;i=n+1}}return e[i].startTime-t<t-e[r].startTime?i:r}(e,t);if(r>-1)for(let n=r,a=e.length;n<a;n++){const r=e[n];if(r.startTime>=t&&r.endTime<=s)i.push(r);else if(r.startTime>s)return i}return i}(e.cues,t,s);for(let t=0;t<r.length;t++)i&&!i(r[t])||e.removeCue(r[t])}"disabled"===r&&(e.mode=r)}function filterSubtitleTracks(e){const t=[];for(let s=0;s<e.length;s++){const i=e[s];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||t.push(e[s])}return t}var re="org.id3",ne="com.apple.quicktime.HLS",ae="https://aomedia.org/emsg/ID3";function getCueClass(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function createCueWithDataFields(e,t,s,i,r){let n=new e(t,s,"");try{n.value=i,r&&(n.type=r)}catch(a){n=new e(t,s,JSON.stringify(r?_objectSpread2({"type":r},i):i))}return n}const oe=(()=>{const e=getCueClass();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function dateRangeDateToTimelineSeconds(e,t){return e.getTime()/1e3-t}class ID3TrackController{"constructor"(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}"destroy"(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}"_registerListeners"(){const{"hls":e}=this;e.on(f.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(f.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(f.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(f.LEVEL_UPDATED,this.onLevelUpdated,this)}"_unregisterListeners"(){const{"hls":e}=this;e.off(f.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(f.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(f.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(f.LEVEL_UPDATED,this.onLevelUpdated,this)}"onMediaAttached"(e,t){this.media=t.media}"onMediaDetaching"(){this.id3Track&&(clearCurrentCues(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}"onManifestLoading"(){this.dateRangeCuesAppended={}}"createTrack"(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}"getID3Track"(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if("metadata"===s.kind&&"id3"===s.label)return sendAddTrackEvent(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}"onFragParsingMetadata"(e,t){if(!this.media)return;const{"hls":{"config":{"enableEmsgMetadataCues":s,"enableID3MetadataCues":i}}}=this;if(!s&&!i)return;const{"samples":r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const n=getCueClass();if(n)for(let e=0;e<r.length;e++){const t=r[e].type;if(t===ae&&!s||!i)continue;const a=getID3Frames(r[e].data);if(a){const s=r[e].pts;let i=s+r[e].duration;i>oe&&(i=oe);i-s<=0&&(i=s+.25);for(let e=0;e<a.length;e++){const r=a[e];if(!isTimeStampFrame(r)){this.updateId3CueEnds(s,t);const e=createCueWithDataFields(n,s,i,r,t);e&&this.id3Track.addCue(e)}}}}}"updateId3CueEnds"(e,t){var s;const i=null==(s=this.id3Track)?void 0:s.cues;if(i)for(let s=i.length;s--;){const r=i[s];r.type===t&&r.startTime<e&&r.endTime===oe&&(r.endTime=e)}}"onBufferFlushing"(e,{"startOffset":t,"endOffset":s,"type":i}){const{"id3Track":r,"hls":n}=this;if(!n)return;const{"config":{"enableEmsgMetadataCues":a,"enableID3MetadataCues":o}}=n;if(r&&(a||o)){let e;e="audio"===i?e=>e.type===re&&o:"video"===i?e=>e.type===ae&&a:e=>e.type===re&&o||e.type===ae&&a,removeCuesInRange(r,t,s,e)}}"onLevelUpdated"(e,{"details":t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{"dateRangeCuesAppended":s,"id3Track":i}=this,{"dateRanges":r}=t,n=Object.keys(r);if(i){const e=Object.keys(s).filter((e=>!n.includes(e)));for(let t=e.length;t--;){const r=e[t];Object.keys(s[r].cues).forEach((e=>{i.removeCue(s[r].cues[e])})),delete s[r]}}const a=t.fragments[t.fragments.length-1];if(0===n.length||!h(null==a?void 0:a.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=a.programDateTime/1e3-a.start,l=getCueClass();for(let e=0;e<n.length;e++){const t=n[e],i=r[t],a=dateRangeDateToTimelineSeconds(i.startDate,o),h=s[t],u=(null==h?void 0:h.cues)||{};let f=(null==h?void 0:h.durationKnown)||!1,g=oe;const m=i.endDate;if(m)g=dateRangeDateToTimelineSeconds(m,o),f=!0;else if(i.endOnNext&&!f){const e=n.reduce(((e,t)=>{if(t!==i.id){const s=r[t];if(s.class===i.class&&s.startDate>i.startDate&&(!e||i.startDate<e.startDate))return s}return e}),null);e&&(g=dateRangeDateToTimelineSeconds(e.startDate,o),f=!0)}const p=Object.keys(i.attr);for(let e=0;e<p.length;e++){const s=p[e];if("ID"===(c=s)||"CLASS"===c||"START-DATE"===c||"DURATION"===c||"END-DATE"===c||"END-ON-NEXT"===c)continue;const r=u[s];if(r)f&&!h.durationKnown&&(r.endTime=g);else if(l){let e=i.attr[s];isSCTE35Attribute(s)&&(d=e,e=Uint8Array.from(d.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);const r=createCueWithDataFields(l,a,g,{"key":s,"data":e},ne);r&&(r.id=t,this.id3Track.addCue(r),u[s]=r)}}s[t]={"cues":u,"dateRange":i,"durationKnown":f}}var d,c}}class LatencyController{"constructor"(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get"latency"(){return this._latency||0}get"maxLatency"(){const{"config":e,"levelDetails":t}=this;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get"targetLatency"(){const{"levelDetails":e}=this;if(null===e)return null;const{"holdBack":t,"partHoldBack":s,"targetduration":i}=e,{"liveSyncDuration":r,"liveSyncDurationCount":n,"lowLatencyMode":a}=this.config,o=this.hls.userConfig;let l=a&&s||t;(o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==r?r:n*i);const d=i;return l+Math.min(1*this.stallCount,d)}get"liveSyncPosition"(){const e=this.estimateLiveEdge(),t=this.targetLatency,s=this.levelDetails;if(null===e||null===t||null===s)return null;const i=s.edge,r=e-t-this.edgeStalled,n=i-s.totalduration,a=i-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(n,r),a)}get"drift"(){const{"levelDetails":e}=this;return null===e?1:e.drift}get"edgeStalled"(){const{"levelDetails":e}=this;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get"forwardBufferLength"(){const{"media":e,"levelDetails":t}=this;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}"destroy"(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}"registerListeners"(){this.hls.on(f.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(f.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(f.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(f.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(f.ERROR,this.onError,this)}"unregisterListeners"(){this.hls.off(f.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(f.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(f.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(f.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(f.ERROR,this.onError,this)}"onMediaAttached"(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}"onMediaDetaching"(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}"onManifestLoading"(){this.levelDetails=null,this._latency=null,this.stallCount=0}"onLevelUpdated"(e,{"details":t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}"onError"(e,t){var s;t.details===m.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(s=this.levelDetails)&&s.live&&v.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}"timeupdate"(){const{"media":e,"levelDetails":t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const s=this.computeLatency();if(null===s)return;this._latency=s;const{"lowLatencyMode":i,"maxLiveSyncPlaybackRate":r}=this.config;if(!i||1===r||!t.live)return;const n=this.targetLatency;if(null===n)return;const a=s-n;if(a<Math.min(this.maxLatency,n+t.targetduration)&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,r)),s=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;e.playbackRate=Math.min(t,Math.max(1,s))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}"estimateLiveEdge"(){const{"levelDetails":e}=this;return null===e?null:e.edge+e.age}"computeLatency"(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}const le=["NONE","TYPE-0","TYPE-1",null];const de=["SDR","PQ","HLG"];var he="",ce="YES",ue="v2";function getSkipValue(e){const{"canSkipUntil":t,"canSkipDateRanges":s,"age":i}=e;return t&&i<t/2?s?ue:ce:he}class HlsUrlParameters{"constructor"(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}"addDirectives"(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Level{"constructor"(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter((e=>!!e)).map((e=>e.substring(0,4))).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get"maxBitrate"(){return Math.max(this.realBitrate,this.bitrate)}get"averageBitrate"(){return this._avgBitrate||this.realBitrate||this.bitrate}get"attrs"(){return this._attrs[0]}get"codecs"(){return this.attrs.CODECS||""}get"pathwayId"(){return this.attrs["PATHWAY-ID"]||"."}get"videoRange"(){return this.attrs["VIDEO-RANGE"]||"SDR"}get"score"(){return this.attrs.optionalFloat("SCORE",0)}get"uri"(){return this.url[0]||""}"hasAudioGroup"(e){return hasGroup(this._audioGroups,e)}"hasSubtitleGroup"(e){return hasGroup(this._subtitleGroups,e)}get"audioGroups"(){return this._audioGroups}get"subtitleGroups"(){return this._subtitleGroups}"addGroupId"(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get"urlId"(){return 0}set"urlId"(e){}get"audioGroupIds"(){return this.audioGroups?[this.audioGroupId]:void 0}get"textGroupIds"(){return this.subtitleGroups?[this.textGroupId]:void 0}get"audioGroupId"(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get"textGroupId"(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}"addFallback"(){}}function hasGroup(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function updateFromToPTS(e,t){const s=t.startPTS;if(h(s)){let i,r=0;t.sn>e.sn?(r=s-e.start,i=e):(r=e.start-s,i=t),i.duration!==r&&(i.duration=r)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function updateFragPTSDTS(e,t,s,i,r,n){i-s<=0&&(v.warn("Fragment should have a positive duration",t),i=s+t.duration,n=r+t.duration);let a=s,o=i;const l=t.startPTS,d=t.endPTS;if(h(l)){const e=Math.abs(l-s);h(t.deltaPTS)?t.deltaPTS=Math.max(e,t.deltaPTS):t.deltaPTS=e,a=Math.max(s,l),s=Math.min(s,l),r=Math.min(r,t.startDTS),o=Math.min(i,d),i=Math.max(i,d),n=Math.max(n,t.endDTS)}const c=s-t.start;0!==t.start&&(t.start=s),t.duration=i-t.start,t.startPTS=s,t.maxStartPTS=a,t.startDTS=r,t.endPTS=i,t.minEndPTS=o,t.endDTS=n;const u=t.sn;if(!e||u<e.startSN||u>e.endSN)return 0;let f;const g=u-e.startSN,m=e.fragments;for(m[g]=t,f=g;f>0;f--)updateFromToPTS(m[f],m[f-1]);for(f=g;f<m.length-1;f++)updateFromToPTS(m[f],m[f+1]);return e.fragmentHint&&updateFromToPTS(m[m.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,c}function mergeDetails(e,t){let s=null;const i=e.fragments;for(let e=i.length-1;e>=0;e--){const t=i[e].initSegment;if(t){s=t;break}}let r;e.fragmentHint&&delete e.fragmentHint.endPTS,function mapFragmentIntersection(e,t,s){const i=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,n=(e.fragmentHint?1:0)+(i?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let e=r;e<=n;e++){const r=l[a+e];let n=o[e];i&&!n&&e<i&&(n=t.fragments[e]=r),r&&n&&s(r,n,e,o)}}(e,t,((e,i,n,a)=>{if(t.skippedSegments&&i.cc!==e.cc){const t=e.cc-i.cc;for(let e=n;e<a.length;e++)a[e].cc+=t}h(e.startPTS)&&h(e.endPTS)&&(i.start=i.startPTS=e.startPTS,i.startDTS=e.startDTS,i.maxStartPTS=e.maxStartPTS,i.endPTS=e.endPTS,i.endDTS=e.endDTS,i.minEndPTS=e.minEndPTS,i.duration=e.endPTS-e.startPTS,i.duration&&(r=i),t.PTSKnown=t.alignedSliding=!0),i.elementaryStreams=e.elementaryStreams,i.loader=e.loader,i.stats=e.stats,e.initSegment&&(i.initSegment=e.initSegment,s=e.initSegment)}));const n=t.fragments;if(s){(t.fragmentHint?n.concat(t.fragmentHint):n).forEach((e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=s)?void 0:t.relurl)||(e.initSegment=s)}))}if(t.skippedSegments){if(t.deltaUpdateFailed=n.some((e=>!e)),t.deltaUpdateFailed){v.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)n.shift();t.startSN=n[0].sn}else t.canSkipDateRanges&&(t.dateRanges=function mergeDateRanges(e,t,s){const i=_extends({},e);s&&s.forEach((e=>{delete i[e]}));return Object.keys(t).forEach((e=>{const s=new DateRange(t[e].attr,i[e]);s.isValid?i[e]=s:v.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[e].attr)}"`)})),i}(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));t.startCC=t.fragments[0].cc,t.endCC=n[n.length-1].cc}!function mapPartIntersection(e,t,s){if(e&&t){let i=0;for(let r=0,n=e.length;r<=n;r++){const n=e[r],a=t[r+i];n&&a&&n.index===a.index&&n.fragment.sn===a.fragment.sn?s(n,a):i--}}}(e.partList,t.partList,((e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),r?updateFragPTSDTS(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):adjustSliding(e,t),n.length&&(t.totalduration=t.edge-n[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const a=t.advancedDateTime;if(t.advanced&&a){const e=t.edge;t.driftStart||(t.driftStartTime=a,t.driftStart=e),t.driftEndTime=a,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function adjustSliding(e,t){const s=t.startSN+t.skippedSegments-e.startSN,i=e.fragments;s<0||s>=i.length||addSliding(t,i[s].start)}function addSliding(e,t){if(t){const s=e.fragments;for(let i=e.skippedSegments;i<s.length;i++)s[i].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function getPartWith(e,t,s){var i;return null!=e&&e.details?findPart(null==(i=e.details)?void 0:i.partList,t,s):null}function findPart(e,t,s){if(e)for(let i=e.length;i--;){const r=e[i];if(r.index===s&&r.fragment.sn===t)return r}return null}function reassignFragmentLevelIndexes(e){e.forEach(((e,t)=>{const{"details":s}=e;null!=s&&s.fragments&&s.fragments.forEach((e=>{e.level=t}))}))}function isTimeoutError(e){switch(e.details){case m.FRAG_LOAD_TIMEOUT:case m.KEY_LOAD_TIMEOUT:case m.LEVEL_LOAD_TIMEOUT:case m.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function getRetryConfig(e,t){const s=isTimeoutError(t);return e.default[(s?"timeout":"error")+"Retry"]}function getRetryDelay(e,t){const s="linear"===e.backoff?1:Math.pow(2,t);return Math.min(s*e.retryDelayMs,e.maxRetryDelayMs)}function getLoaderConfigWithoutReties(e){return _objectSpread2(_objectSpread2({},e),{"errorRetry":null,"timeoutRetry":null})}function shouldRetry(e,t,s,i){if(!e)return!1;const r=null==i?void 0:i.code,n=t<e.maxNumRetry&&(function retryForHttpStatus(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(r)||!!s);return e.shouldRetry?e.shouldRetry(e,t,s,i,n):n}const BinarySearch_search=function(e,t){let s=0,i=e.length-1,r=null,n=null;for(;s<=i;){r=(s+i)/2|0,n=e[r];const a=t(n);if(a>0)s=r+1;else{if(!(a<0))return n;i=r-1}}return null};function findFragmentByPTS(e,t,s=0,i=0,r=.005){let n=null;if(e){n=t[e.sn-t[0].sn+1]||null;const i=e.endDTS-s;i>0&&i<15e-7&&(s+=15e-7)}else 0===s&&0===t[0].start&&(n=t[0]);if(n&&((!e||e.level===n.level)&&0===fragmentWithinToleranceTest(s,i,n)||function fragmentWithinFastStartSwitch(e,t,s){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const i=t.tagList.reduce(((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e)),s);return e.start<=i}return!1}(n,e,Math.min(r,i))))return n;const a=BinarySearch_search(t,fragmentWithinToleranceTest.bind(null,s,i));return!a||a===e&&n?n:a}function fragmentWithinToleranceTest(e=0,t=0,s){if(s.start<=e&&s.start+s.duration>e)return 0;const i=Math.min(t,s.duration+(s.deltaPTS?s.deltaPTS:0));return s.start+s.duration-i<=e?1:s.start-i>e&&s.start?-1:0}function pdtWithinToleranceTest(e,t,s){const i=1e3*Math.min(t,s.duration+(s.deltaPTS?s.deltaPTS:0));return(s.endProgramDateTime||0)-i>e}var fe=0,ge=2,me=3,pe=5,ye=0,Te=1,ve=2;class BasePlaylistController{"constructor"(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=v.log.bind(v,`${t}:`),this.warn=v.warn.bind(v,`${t}:`),this.hls=e}"destroy"(){this.clearTimer(),this.hls=this.log=this.warn=null}"clearTimer"(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}"startLoad"(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}"stopLoad"(){this.canLoad=!1,this.clearTimer()}"switchParams"(e,t,s){const i=null==t?void 0:t.renditionReports;if(i){let r=-1;for(let s=0;s<i.length;s++){const n=i[s];let a;try{a=new self.URL(n.URI,t.url).href}catch(e){v.warn(`Could not construct new URL for Rendition Report: ${e}`),a=n.URI||""}if(a===e){r=s;break}a===e.substring(0,a.length)&&(r=s)}if(-1!==r){const e=i[r],n=parseInt(e["LAST-MSN"])||(null==t?void 0:t.lastPartSn);let a=parseInt(e["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&e>t.partTarget&&(a+=1)}const o=s&&getSkipValue(s);return new HlsUrlParameters(n,a>=0?a:void 0,o)}}}"loadPlaylist"(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}"shouldLoadPlaylist"(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}"shouldReloadPlaylist"(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}"playlistLoaded"(e,t,s){const{"details":i,"stats":r}=t,n=self.performance.now(),a=r.loading.first?Math.max(0,n-r.loading.first):0;if(i.advancedDateTime=Date.now()-a,i.live||null!=s&&s.live){if(i.reloaded(s),s&&this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),s&&i.fragments.length>0&&mergeDetails(s,i),!this.canLoad||!i.live)return;let a,o,l;if(i.canBlockReload&&i.endSN&&i.advanced){const e=this.hls.config.lowLatencyMode,r=i.lastPartSn,n=i.endSN,d=i.lastPartIndex,h=r===n;-1!==d?(o=h?n+1:r,l=h?e?0:d:d+1):o=n+1;const c=i.age,u=c+i.ageHeader;let f=Math.min(u-i.partTarget,1.5*i.targetduration);if(f>0){if(s&&f>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${f} with playlist age: ${i.age}`),f=0;else{const e=Math.floor(f/i.targetduration);if(o+=e,void 0!==l){l+=Math.round(f%i.targetduration/i.partTarget)}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${c.toFixed(2)}s goal: ${f} skip sn ${e} to part ${l}`)}i.tuneInGoal=f}if(a=this.getDeliveryDirectives(i,t.deliveryDirectives,o,l),e||!h)return void this.loadPlaylist(a)}else(i.canBlockReload||i.canSkipUntil)&&(a=this.getDeliveryDirectives(i,t.deliveryDirectives,o,l));const d=this.hls.mainForwardBufferInfo,h=d?d.end-d.len:0,c=function computeReloadInterval(e,t=1/0){let s=1e3*e.targetduration;if(e.updated){const i=e.fragments,r=4;if(i.length&&s*r>t){const e=1e3*i[i.length-1].duration;e<s&&(s=e)}}else s/=2;return Math.round(s)}(i,1e3*(i.edge-h));i.updated&&n>this.requestScheduled+c&&(this.requestScheduled=r.loading.start),void 0!==o&&i.canBlockReload?this.requestScheduled=r.loading.first+c-(1e3*i.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+c<n?this.requestScheduled=n:this.requestScheduled-n<=0&&(this.requestScheduled+=c);let u=this.requestScheduled-n;u=Math.max(0,u),this.log(`reload live playlist ${e} in ${Math.round(u)} ms`),this.timer=self.setTimeout((()=>this.loadPlaylist(a)),u)}else this.clearTimer()}"getDeliveryDirectives"(e,t,s,i){let r=getSkipValue(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,i=t.part,r=he),new HlsUrlParameters(s,i,r)}"checkRetry"(e){const t=e.details,s=isTimeoutError(e),i=e.errorAction,{"action":r,"retryCount":n=0,"retryConfig":a}=i||{},o=!!i&&!!a&&(r===pe||!i.resolved&&r===ge);if(o){var l;if(this.requestScheduled=-1,n>=a.maxNumRetry)return!1;if(s&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=getRetryDelay(a,n);this.timer=self.setTimeout((()=>this.loadPlaylist()),e),this.warn(`Retrying playlist loading ${n+1}/${a.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,i.resolved=!0}return o}}class EWMA{"constructor"(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}"sample"(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}"getTotalWeight"(){return this.totalWeight_}"getEstimate"(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class EwmaBandWidthEstimator{"constructor"(e,t,s,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(e),this.fast_=new EWMA(t),this.defaultTTFB_=i,this.ttfb_=new EWMA(e)}"update"(e,t){const{"slow_":s,"fast_":i,"ttfb_":r}=this;s.halfLife!==e&&(this.slow_=new EWMA(e,s.getEstimate(),s.getTotalWeight())),i.halfLife!==t&&(this.fast_=new EWMA(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new EWMA(e,r.getEstimate(),r.getTotalWeight()))}"sample"(e,t){const s=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}"sampleTTFB"(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}"canEstimate"(){return this.fast_.getTotalWeight()>=this.minWeight_}"getEstimate"(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}"getEstimateTTFB"(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}"destroy"(){}}const Ee={"supported":!0,"configurations":[],"decodingInfoResults":[{"supported":!0,"powerEfficient":!0,"smooth":!0}]},Se={};function requiresMediaCapabilitiesDecodingInfo(e,t,s,i,r,n){const a=e.audioCodec?e.audioGroups:null,o=null==n?void 0:n.audioCodec,l=null==n?void 0:n.channels,d=l?parseInt(l):o?1/0:2;let c=null;if(null!=a&&a.length)try{c=1===a.length&&a[0]?t.groups[a[0]].channels:a.reduce(((e,s)=>{if(s){const i=t.groups[s];if(!i)throw new Error(`Audio track group ${s} not found`);Object.keys(i.channels).forEach((t=>{e[t]=(e[t]||0)+i.channels[t]}))}return e}),{"2":0})}catch(e){return!0}return void 0!==e.videoCodec&&(e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(i,30)||"SDR"!==e.videoRange&&e.videoRange!==s||e.bitrate>Math.max(r,8e6))||!!c&&h(d)&&Object.keys(c).some((e=>parseInt(e)>d))}function getMediaDecodingInfoPromise(e,t,s){const i=e.videoCodec,r=e.audioCodec;if(!i||!r||!s)return Promise.resolve(Ee);const n={"width":e.width,"height":e.height,"bitrate":Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)),"framerate":e.frameRate||30},a=e.videoRange;"SDR"!==a&&(n.transferFunction=a.toLowerCase());const o=i.split(",").map((e=>({"type":"media-source","video":_objectSpread2(_objectSpread2({},n),{},{"contentType":mimeTypeForCodec(e,"video")})})));return r&&e.audioGroups&&e.audioGroups.forEach((e=>{var s;e&&(null==(s=t.groups[e])||s.tracks.forEach((t=>{if(t.groupId===e){const e=t.channels||"",s=parseFloat(e);h(s)&&s>2&&o.push.apply(o,r.split(",").map((e=>({"type":"media-source","audio":{"contentType":mimeTypeForCodec(e,"audio"),"channels":""+s}}))))}})))})),Promise.all(o.map((e=>{const t=function getMediaDecodingInfoKey(e){const{"audio":t,"video":s}=e,i=s||t;if(i){const e=i.contentType.split('"')[1];if(s)return`r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${e}_${Math.ceil(s.bitrate/1e5)}`;if(t)return`c${t.channels}${t.spatialRendering?"s":"n"}_${e}`}return""}(e);return Se[t]||(Se[t]=s.decodingInfo(e))}))).then((e=>({"supported":!e.some((e=>!e.supported)),"configurations":o,"decodingInfoResults":e}))).catch((e=>({"supported":!1,"configurations":o,"decodingInfoResults":[],"error":e})))}function getVideoSelectionOptions(e,t){let s=!1,i=[];return e&&(s="SDR"!==e,i=[e]),t&&(i=t.allowedVideoRanges||de.slice(0),s=void 0!==t.preferHDR?t.preferHDR:function isHdrSupported(){if("function"==typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),i=s?i.filter((e=>"SDR"!==e)):["SDR"]),{"preferHDR":s,"allowedVideoRanges":i}}function logStartCodecCandidateIgnored(e,t){v.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function findMatchingOption(e,t,s){if("attrs"in e){const s=t.indexOf(e);if(-1!==s)return s}for(let i=0;i<t.length;i++){if(matchesOption(e,t[i],s))return i}return-1}function matchesOption(e,t,s){const{"groupId":i,"name":r,"lang":n,"assocLang":a,"default":o}=e,l=e.forced;return(void 0===i||t.groupId===i)&&(void 0===r||t.name===r)&&(void 0===n||t.lang===n)&&(void 0===n||t.assocLang===a)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function characteristicsMatch(e,t=""){const s=e.split(","),i=t.split(",");return s.length===i.length&&!s.some((e=>-1===i.indexOf(e)))}(e.characteristics||"",t.characteristics))&&(void 0===s||s(e,t))}function audioMatchPredicate(e,t){const{"audioCodec":s,"channels":i}=e;return!(void 0!==s&&(t.audioCodec||"").substring(0,4)!==s.substring(0,4)||void 0!==i&&i!==(t.channels||"2"))}function searchDownAndUpList(e,t,s){for(let i=t;i>-1;i--)if(s(e[i]))return i;for(let i=t+1;i<e.length;i++)if(s(e[i]))return i;return-1}class TaskLoop{"constructor"(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}"destroy"(){this.onHandlerDestroying(),this.onHandlerDestroyed()}"onHandlerDestroying"(){this.clearNextTick(),this.clearInterval()}"onHandlerDestroyed"(){}"hasInterval"(){return!!this._tickInterval}"hasNextTick"(){return!!this._tickTimer}"setInterval"(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}"clearInterval"(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}"clearNextTick"(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}"tick"(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}"tickImmediate"(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}"doTick"(){}}var Le="NOT_LOADED",Ae="APPENDING",Re="PARTIAL",be="OK";class FragmentTracker{"constructor"(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}"_registerListeners"(){const{"hls":e}=this;e.on(f.BUFFER_APPENDED,this.onBufferAppended,this),e.on(f.FRAG_BUFFERED,this.onFragBuffered,this),e.on(f.FRAG_LOADED,this.onFragLoaded,this)}"_unregisterListeners"(){const{"hls":e}=this;e.off(f.BUFFER_APPENDED,this.onBufferAppended,this),e.off(f.FRAG_BUFFERED,this.onFragBuffered,this),e.off(f.FRAG_LOADED,this.onFragLoaded,this)}"destroy"(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}"getAppendedFrag"(e,t){const s=this.activePartLists[t];if(s)for(let t=s.length;t--;){const i=s[t];if(!i)break;const r=i.end;if(i.start<=e&&null!==r&&e<=r)return i}return this.getBufferedFrag(e,t)}"getBufferedFrag"(e,t){const{"fragments":s}=this,i=Object.keys(s);for(let r=i.length;r--;){const n=s[i[r]];if((null==n?void 0:n.body.type)===t&&n.buffered){const t=n.body;if(t.start<=e&&e<=t.end)return t}}return null}"detectEvictedFragments"(e,t,s,i){this.timeRanges&&(this.timeRanges[e]=t);const r=(null==i?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach((i=>{const n=this.fragments[i];if(!n)return;if(r>=n.body.sn)return;if(!n.buffered&&!n.loaded)return void(n.body.type===s&&this.removeFragment(n.body));const a=n.range[e];a&&a.time.some((e=>{const s=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return s&&this.removeFragment(n.body),s}))}))}"detectPartialFragments"(e){const t=this.timeRanges,{"frag":s,"part":i}=e;if(!t||"initSegment"===s.sn)return;const r=getFragmentKey(s),n=this.fragments[r];if(!n||n.buffered&&s.gap)return;const a=!s.relurl;if(Object.keys(t).forEach((e=>{const r=s.elementaryStreams[e];if(!r)return;const o=t[e],l=a||!0===r.partial;n.range[e]=this.getBufferedTimes(s,i,l,o)})),n.loaded=null,Object.keys(n.range).length){n.buffered=!0;(n.body.endList=s.endList||n.body.endList)&&(this.endListFragments[n.body.type]=n),isPartial(n)||this.removeParts(s.sn-1,s.type)}else this.removeFragment(n.body)}"removeParts"(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=s.filter((t=>t.fragment.sn>=e)))}"fragBuffered"(e,t){const s=getFragmentKey(e);let i=this.fragments[s];!i&&t&&(i=this.fragments[s]={"body":e,"appendedPTS":null,"loaded":null,"buffered":!1,"range":Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}"getBufferedTimes"(e,t,s,i){const r={"time":[],"partial":s},n=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||n;for(let e=0;e<i.length;e++){const t=i.start(e)-this.bufferPadding,s=i.end(e)+this.bufferPadding;if(l>=t&&o<=s){r.time.push({"startPTS":Math.max(n,i.start(e)),"endPTS":Math.min(a,i.end(e))});break}if(n<s&&a>t){const t=Math.max(n,i.start(e)),s=Math.min(a,i.end(e));s>t&&(r.partial=!0,r.time.push({"startPTS":t,"endPTS":s}))}else if(a<=t)break}return r}"getPartialFragment"(e){let t,s,i,r=null,n=0;const{"bufferPadding":a,"fragments":o}=this;return Object.keys(o).forEach((l=>{const d=o[l];d&&isPartial(d)&&(s=d.body.start-a,i=d.body.end+a,e>=s&&e<=i&&(t=Math.min(e-s,i-e),n<=t&&(r=d.body,n=t)))})),r}"isEndListAppended"(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||isPartial(t))}"getState"(e){const t=getFragmentKey(e),s=this.fragments[t];return s?s.buffered?isPartial(s)?Re:be:Ae:Le}"isTimeBuffered"(e,t,s){let i,r;for(let n=0;n<s.length;n++){if(i=s.start(n)-this.bufferPadding,r=s.end(n)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)return!1}return!1}"onFragLoaded"(e,t){const{"frag":s,"part":i}=t;if("initSegment"===s.sn||s.bitrateTest)return;const r=i?null:t,n=getFragmentKey(s);this.fragments[n]={"body":s,"appendedPTS":null,"loaded":r,"buffered":!1,"range":Object.create(null)}}"onBufferAppended"(e,t){const{"frag":s,"part":i,"timeRanges":r}=t;if("initSegment"===s.sn)return;const n=s.type;if(i){let e=this.activePartLists[n];e||(this.activePartLists[n]=e=[]),e.push(i)}this.timeRanges=r,Object.keys(r).forEach((e=>{const t=r[e];this.detectEvictedFragments(e,t,n,i)}))}"onFragBuffered"(e,t){this.detectPartialFragments(t)}"hasFragment"(e){const t=getFragmentKey(e);return!!this.fragments[t]}"hasParts"(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}"removeFragmentsInRange"(e,t,s,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach((n=>{const a=this.fragments[n];if(!a)return;const o=a.body;o.type!==s||i&&!o.gap||o.start<t&&o.end>e&&(a.buffered||r)&&this.removeFragment(o)}))}"removeFragment"(e){const t=getFragmentKey(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const t=e.sn;this.activePartLists[e.type]=s.filter((e=>e.fragment.sn!==t))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}"removeAllFragments"(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function isPartial(e){var t,s,i;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(s=e.range.audio)?void 0:s.partial)||(null==(i=e.range.audiovideo)?void 0:i.partial))}function getFragmentKey(e){return`${e.type}_${e.level}_${e.sn}`}const ke={"length":0,"start":()=>0,"end":()=>0};class BufferHelper{static"isBuffered"(e,t){try{if(e){const s=BufferHelper.getBuffered(e);for(let e=0;e<s.length;e++)if(t>=s.start(e)&&t<=s.end(e))return!0}}catch(e){}return!1}static"bufferInfo"(e,t,s){try{if(e){const i=BufferHelper.getBuffered(e),r=[];let n;for(n=0;n<i.length;n++)r.push({"start":i.start(n),"end":i.end(n)});return this.bufferedInfo(r,t,s)}}catch(e){}return{"len":0,"start":t,"end":t,"nextStart":void 0}}static"bufferedInfo"(e,t,s){t=Math.max(0,t),e.sort((function(e,t){const s=e.start-t.start;return s||t.end-e.end}));let i=[];if(s)for(let t=0;t<e.length;t++){const r=i.length;if(r){const n=i[r-1].end;e[t].start-n<s?e[t].end>n&&(i[r-1].end=e[t].end):i.push(e[t])}else i.push(e[t])}else i=e;let r,n=0,a=t,o=t;for(let e=0;e<i.length;e++){const l=i[e].start,d=i[e].end;if(t+s>=l&&t<d)a=l,o=d,n=o-t;else if(t+s<l){r=l;break}}return{"len":n,"start":a||0,"end":o||0,"nextStart":r}}static"getBuffered"(e){try{return e.buffered}catch(e){return v.log("failed to get media.buffered",e),ke}}}class ChunkMetadata{"constructor"(e,t,s,i=0,r=-1,n=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={"start":0,"executeStart":0,"executeEnd":0,"end":0},this.buffering={"audio":{"start":0,"executeStart":0,"executeEnd":0,"end":0},"video":{"start":0,"executeStart":0,"executeEnd":0,"end":0},"audiovideo":{"start":0,"executeStart":0,"executeEnd":0,"end":0}},this.level=e,this.sn=t,this.id=s,this.size=i,this.part=r,this.partial=n}}function findFirstFragWithCC(e,t){for(let i=0,r=e.length;i<r;i++){var s;if((null==(s=e[i])?void 0:s.cc)===t)return e[i]}return null}function adjustFragmentStart(e,t){if(e){const s=e.start+t;e.start=e.startPTS=s,e.endPTS=s+e.duration}}function adjustSlidingStart(e,t){const s=t.fragments;for(let t=0,i=s.length;t<i;t++)adjustFragmentStart(s[t],e);t.fragmentHint&&adjustFragmentStart(t.fragmentHint,e),t.alignedSliding=!0}function alignStream(e,t,s){t&&(!function alignDiscontinuities(e,t,s){if(function shouldAlignOnDiscontinuities(e,t,s){return!(!t||!(s.endCC>s.startCC||e&&e.cc<s.startCC))}(e,s,t)){const e=function findDiscontinuousReferenceFrag(e,t){const s=e.fragments,i=t.fragments;if(!i.length||!s.length)return void v.log("No fragments to align");const r=findFirstFragWithCC(s,i[0].cc);if(r&&(!r||r.startPTS))return r;v.log("No frag in previous level to align on")}(s,t);e&&h(e.start)&&(v.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),adjustSlidingStart(e.start,t))}}(e,s,t),!s.alignedSliding&&t&&alignMediaPlaylistByPDT(s,t),s.alignedSliding||!t||s.skippedSegments||adjustSliding(t,s))}function alignMediaPlaylistByPDT(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const s=e.fragments,i=t.fragments;if(!s.length||!i.length)return;let r,n;const a=Math.min(t.endCC,e.endCC);t.startCC<a&&e.startCC<a&&(r=findFirstFragWithCC(i,a),n=findFirstFragWithCC(s,a)),r&&n||(r=i[Math.floor(i.length/2)],n=findFirstFragWithCC(s,r.cc)||s[Math.floor(s.length/2)]);const o=r.programDateTime,l=n.programDateTime;if(!o||!l)return;adjustSlidingStart((l-o)/1e3-(n.start-r.start),e)}const De=Math.pow(2,17);class FragmentLoader{"constructor"(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}"destroy"(){this.loader&&(this.loader.destroy(),this.loader=null)}"abort"(){this.loader&&this.loader.abort()}"load"(e,t){const s=e.url;if(!s)return Promise.reject(new LoadError({"type":g.NETWORK_ERROR,"details":m.FRAG_LOAD_ERROR,"fatal":!1,"frag":e,"error":new Error("Fragment does not have a "+(s?"part list":"url")),"networkDetails":null}));this.abort();const i=this.config,r=i.fLoader,n=i.loader;return new Promise(((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some((e=>"GAP"===e[0])))return void o(createGapLoadError(e));e.gap=!1}const l=this.loader=e.loader=r?new r(i):new n(i),d=createLoaderContext(e),h=getLoaderConfigWithoutReties(i.fragLoadPolicy.default),c={"loadPolicy":h,"timeout":h.maxLoadTimeMs,"maxRetry":0,"retryDelay":0,"maxRetryDelay":0,"highWaterMark":"initSegment"===e.sn?1/0:De};e.stats=l.stats,l.load(d,c,{"onSuccess":(t,s,i,r)=>{this.resetLoader(e,l);let n=t.data;i.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(n.slice(0,16)),n=n.slice(16)),a({"frag":e,"part":null,"payload":n,"networkDetails":r})},"onError":(t,i,r,n)=>{this.resetLoader(e,l),o(new LoadError({"type":g.NETWORK_ERROR,"details":m.FRAG_LOAD_ERROR,"fatal":!1,"frag":e,"response":_objectSpread2({"url":s,"data":void 0},t),"error":new Error(`HTTP Error ${t.code} ${t.text}`),"networkDetails":r,"stats":n}))},"onAbort":(t,s,i)=>{this.resetLoader(e,l),o(new LoadError({"type":g.NETWORK_ERROR,"details":m.INTERNAL_ABORTED,"fatal":!1,"frag":e,"error":new Error("Aborted"),"networkDetails":i,"stats":t}))},"onTimeout":(t,s,i)=>{this.resetLoader(e,l),o(new LoadError({"type":g.NETWORK_ERROR,"details":m.FRAG_LOAD_TIMEOUT,"fatal":!1,"frag":e,"error":new Error(`Timeout after ${c.timeout}ms`),"networkDetails":i,"stats":t}))},"onProgress":(s,i,r,n)=>{t&&t({"frag":e,"part":null,"payload":r,"networkDetails":n})}})}))}"loadPart"(e,t,s){this.abort();const i=this.config,r=i.fLoader,n=i.loader;return new Promise(((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(createGapLoadError(e,t));const l=this.loader=e.loader=r?new r(i):new n(i),d=createLoaderContext(e,t),h=getLoaderConfigWithoutReties(i.fragLoadPolicy.default),c={"loadPolicy":h,"timeout":h.maxLoadTimeMs,"maxRetry":0,"retryDelay":0,"maxRetryDelay":0,"highWaterMark":De};t.stats=l.stats,l.load(d,c,{"onSuccess":(i,r,n,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const d={"frag":e,"part":t,"payload":i.data,"networkDetails":o};s(d),a(d)},"onError":(s,i,r,n)=>{this.resetLoader(e,l),o(new LoadError({"type":g.NETWORK_ERROR,"details":m.FRAG_LOAD_ERROR,"fatal":!1,"frag":e,"part":t,"response":_objectSpread2({"url":d.url,"data":void 0},s),"error":new Error(`HTTP Error ${s.code} ${s.text}`),"networkDetails":r,"stats":n}))},"onAbort":(s,i,r)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new LoadError({"type":g.NETWORK_ERROR,"details":m.INTERNAL_ABORTED,"fatal":!1,"frag":e,"part":t,"error":new Error("Aborted"),"networkDetails":r,"stats":s}))},"onTimeout":(s,i,r)=>{this.resetLoader(e,l),o(new LoadError({"type":g.NETWORK_ERROR,"details":m.FRAG_LOAD_TIMEOUT,"fatal":!1,"frag":e,"part":t,"error":new Error(`Timeout after ${c.timeout}ms`),"networkDetails":r,"stats":s}))}})}))}"updateStatsFromPart"(e,t){const s=e.stats,i=t.stats,r=i.total;if(s.loaded+=i.loaded,r){const i=Math.round(e.duration/t.duration),n=Math.min(Math.round(s.loaded/r),i),a=(i-n)*Math.round(s.loaded/n);s.total=s.loaded+a}else s.total=Math.max(s.loaded,s.total);const n=s.loading,a=i.loading;n.start?n.first+=a.first-a.start:(n.start=a.start,n.first=a.first),n.end=a.end}"resetLoader"(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function createLoaderContext(e,t=null){const s=t||e,i={"frag":e,"part":t,"responseType":"arraybuffer","url":s.url,"headers":{},"rangeStart":0,"rangeEnd":0},r=s.byteRangeStartOffset,n=s.byteRangeEndOffset;if(h(r)&&h(n)){var a;let t=r,s=n;if("initSegment"===e.sn&&"AES-128"===(null==(a=e.decryptdata)?void 0:a.method)){const e=n-r;e%16&&(s=n+(16-e%16)),0!==r&&(i.resetIV=!0,t=r-16)}i.rangeStart=t,i.rangeEnd=s}return i}function createGapLoadError(e,t){const s=new Error(`GAP ${e.gap?"tag":"attribute"} found`),i={"type":g.MEDIA_ERROR,"details":m.FRAG_GAP,"fatal":!1,"frag":e,"error":s,"networkDetails":null};return t&&(i.part=t),(t||e).stats.aborted=!0,new LoadError(i)}class LoadError extends Error{"constructor"(e){super(e.error.message),this.data=void 0,this.data=e}}class AESCrypto{"constructor"(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}"decrypt"(e,t){return this.subtle.decrypt({"name":"AES-CBC","iv":this.aesIV},t,e)}}class FastAESKey{"constructor"(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}"expandKey"(){return this.subtle.importKey("raw",this.key,{"name":"AES-CBC"},!1,["encrypt","decrypt"])}}class AESDecryptor{"constructor"(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}"uint8ArrayToUint32Array_"(e){const t=new DataView(e),s=new Uint32Array(4);for(let e=0;e<4;e++)s[e]=t.getUint32(4*e);return s}"initTable"(){const e=this.sBox,t=this.invSBox,s=this.subMix,i=s[0],r=s[1],n=s[2],a=s[3],o=this.invSubMix,l=o[0],d=o[1],h=o[2],c=o[3],u=new Uint32Array(256);let f=0,g=0,m=0;for(m=0;m<256;m++)u[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){let s=g^g<<1^g<<2^g<<3^g<<4;s=s>>>8^255&s^99,e[f]=s,t[s]=f;const o=u[f],m=u[o],p=u[m];let y=257*u[s]^16843008*s;i[f]=y<<24|y>>>8,r[f]=y<<16|y>>>16,n[f]=y<<8|y>>>24,a[f]=y,y=16843009*p^65537*m^257*o^16843008*f,l[s]=y<<24|y>>>8,d[s]=y<<16|y>>>16,h[s]=y<<8|y>>>24,c[s]=y,f?(f=o^u[u[u[p^o]]],g^=u[u[g]]):f=g=1}}"expandKey"(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,i=0;for(;i<t.length&&s;)s=t[i]===this.key[i],i++;if(s)return;this.key=t;const r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);const n=this.ksRows=4*(r+6+1);let a,o;const l=this.keySchedule=new Uint32Array(n),d=this.invKeySchedule=new Uint32Array(n),h=this.sBox,c=this.rcon,u=this.invSubMix,f=u[0],g=u[1],m=u[2],p=u[3];let y,T;for(a=0;a<n;a++)a<r?y=l[a]=t[a]:(T=y,a%r==0?(T=T<<8|T>>>24,T=h[T>>>24]<<24|h[T>>>16&255]<<16|h[T>>>8&255]<<8|h[255&T],T^=c[a/r|0]<<24):r>6&&a%r==4&&(T=h[T>>>24]<<24|h[T>>>16&255]<<16|h[T>>>8&255]<<8|h[255&T]),l[a]=y=(l[a-r]^T)>>>0);for(o=0;o<n;o++)a=n-o,T=3&o?l[a]:l[a-4],d[o]=o<4||a<=4?T:f[h[T>>>24]]^g[h[T>>>16&255]]^m[h[T>>>8&255]]^p[h[255&T]],d[o]=d[o]>>>0}"networkToHostOrderSwap"(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}"decrypt"(e,t,s){const i=this.keySize+6,r=this.invKeySchedule,n=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],d=a[2],h=a[3],c=this.uint8ArrayToUint32Array_(s);let u=c[0],f=c[1],g=c[2],m=c[3];const p=new Int32Array(e),y=new Int32Array(p.length);let T,v,E,S,L,A,R,b,k,D,C,I,P,w;const x=this.networkToHostOrderSwap;for(;t<p.length;){for(k=x(p[t]),D=x(p[t+1]),C=x(p[t+2]),I=x(p[t+3]),L=k^r[0],A=I^r[1],R=C^r[2],b=D^r[3],P=4,w=1;w<i;w++)T=o[L>>>24]^l[A>>16&255]^d[R>>8&255]^h[255&b]^r[P],v=o[A>>>24]^l[R>>16&255]^d[b>>8&255]^h[255&L]^r[P+1],E=o[R>>>24]^l[b>>16&255]^d[L>>8&255]^h[255&A]^r[P+2],S=o[b>>>24]^l[L>>16&255]^d[A>>8&255]^h[255&R]^r[P+3],L=T,A=v,R=E,b=S,P+=4;T=n[L>>>24]<<24^n[A>>16&255]<<16^n[R>>8&255]<<8^n[255&b]^r[P],v=n[A>>>24]<<24^n[R>>16&255]<<16^n[b>>8&255]<<8^n[255&L]^r[P+1],E=n[R>>>24]<<24^n[b>>16&255]<<16^n[L>>8&255]<<8^n[255&A]^r[P+2],S=n[b>>>24]<<24^n[L>>16&255]<<16^n[A>>8&255]<<8^n[255&R]^r[P+3],y[t]=x(T^u),y[t+1]=x(S^f),y[t+2]=x(E^g),y[t+3]=x(v^m),u=k,f=D,g=C,m=I,t+=4}return y.buffer}}class Decrypter{"constructor"(e,{"removePKCS7Padding":t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}this.useSoftware=!this.subtle}"destroy"(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}"isSync"(){return this.useSoftware}"flush"(){const{"currentResult":e,"remainderData":t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function removePadding(e){const t=e.byteLength,s=t&&new DataView(e.buffer).getUint8(t-1);return s?sliceUint8(e,0,t-s):e}(s):s}"reset"(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}"decrypt"(e,t,s){return this.useSoftware?new Promise(((i,r)=>{this.softwareDecrypt(new Uint8Array(e),t,s);const n=this.flush();n?i(n.buffer):r(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,s)}"softwareDecrypt"(e,t,s){const{"currentIV":i,"currentResult":r,"remainderData":n}=this;this.logOnce("JS AES decrypt"),n&&(e=appendUint8Array(n,e),this.remainderData=null);const a=this.getValidChunk(e);if(!a.length)return null;i&&(s=i);let o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new AESDecryptor),o.expandKey(t);const l=r;return this.currentResult=o.decrypt(a.buffer,0,s),this.currentIV=sliceUint8(a,-16).buffer,l||null}"webCryptoDecrypt"(e,t,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s));this.key=t,this.fastAesKey=new FastAESKey(this.subtle,t)}return this.fastAesKey.expandKey().then((t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new AESCrypto(this.subtle,new Uint8Array(s)).decrypt(e.buffer,t)})).catch((i=>(v.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,s))))}"onWebCryptoError"(e,t,s){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s);const i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}"getValidChunk"(e){let t=e;const s=e.length-e.length%16;return s!==e.length&&(t=sliceUint8(e,0,s),this.remainderData=sliceUint8(e,s)),t}"logOnce"(e){this.logEnabled&&(v.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const TimeRanges_toString=function(e){let t="";const s=e.length;for(let i=0;i<s;i++)t+=`[${e.start(i).toFixed(3)}-${e.end(i).toFixed(3)}]`;return t},Ce="STOPPED",Ie="IDLE",Pe="KEY_LOADING",we="FRAG_LOADING",xe="FRAG_LOADING_WAITING_RETRY",_e="WAITING_TRACK",Me="PARSING",Fe="PARSED",Oe="ENDED",Ue="ERROR",Ne="WAITING_INIT_PTS",Be="WAITING_LEVEL";class BaseStreamController extends TaskLoop{"constructor"(e,t,s,i,r){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Ce,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=r,this.logPrefix=i,this.log=v.log.bind(v,`${i}:`),this.warn=v.warn.bind(v,`${i}:`),this.hls=e,this.fragmentLoader=new FragmentLoader(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Decrypter(e.config),e.on(f.MANIFEST_LOADED,this.onManifestLoaded,this)}"doTick"(){this.onTickEnd()}"onTickEnd"(){}"startLoad"(e){}"stopLoad"(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Ce}"pauseBuffering"(){this.buffering=!1}"resumeBuffering"(){this.buffering=!0}"_streamEnded"(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const s=t.partList;if(null!=s&&s.length){const e=s[s.length-1];return BufferHelper.isBuffered(this.media,e.start+e.duration/2)}const i=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(i)}"getLevelDetails"(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levelLastLoaded)?void 0:e.details}"onMediaAttached"(e,t){const s=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),s.addEventListener("seeking",this.onvseeking),s.addEventListener("ended",this.onvended);const i=this.config;this.levels&&i.autoStartLoad&&this.state===Ce&&this.startLoad(i.startPosition)}"onMediaDetaching"(){const e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}"onMediaSeeking"(){const{"config":e,"fragCurrent":t,"media":s,"mediaBuffer":i,"state":r}=this,n=s?s.currentTime:0,a=BufferHelper.bufferInfo(i||s,n,e.maxBufferHole);if(this.log(`media seeking to ${h(n)?n.toFixed(3):n}, state: ${r}`),this.state===Oe)this.resetLoadingState();else if(t){const s=e.maxFragLookUpTolerance,i=t.start-s,r=t.start+t.duration+s;if(!a.len||r<a.start||i>a.end){const e=n>r;(n<i||e)&&(e&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}s&&(this.fragmentTracker.removeFragmentsInRange(n,1/0,this.playlistType,!0),this.lastCurrentTime=n),this.loadedmetadata||a.len||(this.nextLoadPosition=this.startPosition=n),this.tickImmediate()}"onMediaEnded"(){this.startPosition=this.lastCurrentTime=0}"onManifestLoaded"(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}"onHandlerDestroying"(){this.hls.off(f.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}"onHandlerDestroyed"(){this.state=Ce,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}"loadFragment"(e,t,s){this._loadFragForPlayback(e,t,s)}"_loadFragForPlayback"(e,t,s){this._doFragLoad(e,t,s,(t=>{if(this.fragContextChanged(e))return this.warn(`Fragment ${e.sn}${t.part?" p: "+t.part.index:""} of level ${e.level} was dropped during download.`),void this.fragmentTracker.removeFragment(e);e.stats.chunkCount++,this._handleFragmentLoadProgress(t)})).then((t=>{if(!t)return;const s=this.state;this.fragContextChanged(e)?(s===we||!this.fragCurrent&&s===Me)&&(this.fragmentTracker.removeFragment(e),this.state=Ie):("payload"in t&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(f.FRAG_LOADED,t)),this._handleFragmentLoadComplete(t))})).catch((t=>{this.state!==Ce&&this.state!==Ue&&(this.warn(`Frag error: ${(null==t?void 0:t.message)||t}`),this.resetFragmentLoading(e))}))}"clearTrackerIfNeeded"(e){var t;const{"fragmentTracker":s}=this;if(s.getState(e)===Ae){const t=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,t),r=Math.max(e.duration,i?i.len:this.config.maxBufferLength),n=this.backtrackFragment;(1===(n?e.sn-n.sn:0)||this.reduceMaxBufferLength(r,e.duration))&&s.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({"frag":e,"part":null,"stats":e.stats,"id":e.type}),s.getState(e)===Re&&s.removeFragment(e))}"checkLiveUpdate"(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({"frag":t,"part":null,"stats":t.stats,"id":t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}"flushMainBuffer"(e,t,s=null){if(!(e-t))return;const i={"startOffset":e,"endOffset":t,"type":s};this.hls.trigger(f.BUFFER_FLUSHING,i)}"_loadInitSegment"(e,t){this._doFragLoad(e,t).then((t=>{if(!t||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return t})).then((t=>{const{"hls":s}=this,{"payload":i}=t,r=e.decryptdata;if(i&&i.byteLength>0&&null!=r&&r.key&&r.iv&&"AES-128"===r.method){const n=self.performance.now();return this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer).catch((t=>{throw s.trigger(f.ERROR,{"type":g.MEDIA_ERROR,"details":m.FRAG_DECRYPT_ERROR,"fatal":!1,"error":t,"reason":t.message,"frag":e}),t})).then((i=>{const r=self.performance.now();return s.trigger(f.FRAG_DECRYPTED,{"frag":e,"payload":i,"stats":{"tstart":n,"tdecrypt":r}}),t.payload=i,this.completeInitSegmentLoad(t)}))}return this.completeInitSegmentLoad(t)})).catch((t=>{this.state!==Ce&&this.state!==Ue&&(this.warn(t),this.resetFragmentLoading(e))}))}"completeInitSegmentLoad"(e){const{"levels":t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state=Ie,e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}"fragContextChanged"(e){const{"fragCurrent":t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}"fragBufferedComplete"(e,t){var s,i,r,n;const a=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===te?"level":"track"} ${e.level} (frag:[${(null!=(s=e.startPTS)?s:NaN).toFixed(3)}-${(null!=(i=e.endPTS)?i:NaN).toFixed(3)}] > buffer:${a?TimeRanges_toString(BufferHelper.getBuffered(a)):"(detached)"})`),"initSegment"!==e.sn){var o;if(e.type!==ie){const t=e.elementaryStreams;if(!Object.keys(t).some((e=>!!t[e])))return void(this.state=Ie)}const t=null==(o=this.levels)?void 0:o[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=Ie,a&&(!this.loadedmetadata&&e.type==te&&a.buffered.length&&(null==(r=this.fragCurrent)?void 0:r.sn)===(null==(n=this.fragPrevious)?void 0:n.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}"seekToStartPos"(){}"_handleFragmentLoadComplete"(e){const{"transmuxer":t}=this;if(!t)return;const{"frag":s,"part":i,"partsLoaded":r}=e,n=!r||0===r.length||r.some((e=>!e)),a=new ChunkMetadata(s.level,s.sn,s.stats.chunkCount+1,0,i?i.index:-1,!n);t.flush(a)}"_handleFragmentLoadProgress"(e){}"_doFragLoad"(e,t,s=null,i){var r;const n=null==t?void 0:t.details;if(!this.levels||!n)throw new Error(`frag load aborted, missing level${n?"":" detail"}s`);let a=null;if(!e.encrypted||null!=(r=e.decryptdata)&&r.key?!e.encrypted&&n.encryptedFragments.length&&this.keyLoader.loadClear(e,n.encryptedFragments):(this.log(`Loading key for ${e.sn} of [${n.startSN}-${n.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${e.level}`),this.state=Pe,this.fragCurrent=e,a=this.keyLoader.load(e).then((e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(f.KEY_LOADED,e),this.state===Pe&&(this.state=Ie),e})),this.hls.trigger(f.KEY_LOADING,{"frag":e}),null===this.fragCurrent&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),s=Math.max(e.start,s||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){const r=n.partList;if(r&&i){s>e.end&&n.fragmentHint&&(e=n.fragmentHint);const o=this.getNextPart(r,e,s);if(o>-1){const l=r[o];let d;return this.log(`Loading part sn: ${e.sn} p: ${l.index} cc: ${e.cc} of playlist [${n.startSN}-${n.endSN}] parts [0-${o}-${r.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=we,d=a?a.then((s=>!s||this.fragContextChanged(s.frag)?null:this.doFragPartsLoad(e,l,t,i))).catch((e=>this.handleFragLoadError(e))):this.doFragPartsLoad(e,l,t,i).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(f.FRAG_LOADING,{"frag":e,"part":l,"targetBufferTime":s}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):d}if(!e.url||this.loadedEndOfParts(r,s))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${n?"of ["+n.startSN+"-"+n.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${e.level}, target: ${parseFloat(s.toFixed(3))}`),h(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=we;const o=this.config.progressive;let l;return l=o&&a?a.then((t=>!t||this.fragContextChanged(null==t?void 0:t.frag)?null:this.fragmentLoader.load(e,i))).catch((e=>this.handleFragLoadError(e))):Promise.all([this.fragmentLoader.load(e,o?i:void 0),a]).then((([e])=>(!o&&e&&i&&i(e),e))).catch((e=>this.handleFragLoadError(e))),this.hls.trigger(f.FRAG_LOADING,{"frag":e,"targetBufferTime":s}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):l}"doFragPartsLoad"(e,t,s,i){return new Promise(((r,n)=>{var a;const o=[],l=null==(a=s.details)?void 0:a.partList,loadPart=t=>{this.fragmentLoader.loadPart(e,t,i).then((i=>{o[t.index]=i;const n=i.part;this.hls.trigger(f.FRAG_LOADED,i);const a=getPartWith(s,e.sn,t.index+1)||findPart(l,e.sn,t.index+1);if(!a)return r({"frag":e,"part":n,"partsLoaded":o});loadPart(a)})).catch(n)};loadPart(t)}))}"handleFragLoadError"(e){if("data"in e){const t=e.data;e.data&&t.details===m.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(f.ERROR,t)}else this.hls.trigger(f.ERROR,{"type":g.OTHER_ERROR,"details":m.INTERNAL_EXCEPTION,"err":e,"error":e,"fatal":!0});return null}"_handleTransmuxerFlush"(e){const t=this.getCurrentContext(e);if(!t||this.state!==Me)return void(this.fragCurrent||this.state===Ce||this.state===Ue||(this.state=Ie));const{"frag":s,"part":i,"level":r}=t,n=self.performance.now();s.stats.parsing.end=n,i&&(i.stats.parsing.end=n),this.updateLevelTiming(s,i,r,e.partial)}"getCurrentContext"(e){const{"levels":t,"fragCurrent":s}=this,{"level":i,"sn":r,"part":n}=e;if(null==t||!t[i])return this.warn(`Levels object was unset while buffering fragment ${r} of level ${i}. The current chunk will not be buffered.`),null;const a=t[i],o=n>-1?getPartWith(a,r,n):null,l=o?o.fragment:function getFragmentWithSN(e,t,s){if(null==e||!e.details)return null;const i=e.details;let r=i.fragments[t-i.startSN];return r||(r=i.fragmentHint,r&&r.sn===t?r:t<i.startSN&&s&&s.sn===t?s:null)}(a,r,s);return l?(s&&s!==l&&(l.stats=s.stats),{"frag":l,"part":o,"level":a}):null}"bufferFragmentData"(e,t,s,i,r){var n;if(!e||this.state!==Me)return;const{"data1":a,"data2":o}=e;let l=a;if(a&&o&&(l=appendUint8Array(a,o)),null==(n=l)||!n.length)return;const d={"type":e.type,"frag":t,"part":s,"chunkMeta":i,"parent":t.type,"data":l};if(this.hls.trigger(f.BUFFER_APPENDING,d),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}"flushBufferGap"(e){const t=this.media;if(!t)return;if(!BufferHelper.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const s=t.currentTime,i=BufferHelper.bufferInfo(t,s,0),r=e.duration,n=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),a=Math.max(Math.min(e.start-n,i.end-n),s+n);e.start-a>n&&this.flushMainBuffer(a,e.start)}"getFwdBufferInfo"(e,t){const s=this.getLoadPosition();return h(s)?this.getFwdBufferInfoAtPos(e,s,t):null}"getFwdBufferInfoAtPos"(e,t,s){const{"config":{"maxBufferHole":i}}=this,r=BufferHelper.bufferInfo(e,t,i);if(0===r.len&&void 0!==r.nextStart){const n=this.fragmentTracker.getBufferedFrag(t,s);if(n&&r.nextStart<n.end)return BufferHelper.bufferInfo(e,t,Math.max(r.nextStart,i))}return r}"getMaxBufferLength"(e){const{"config":t}=this;let s;return s=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}"reduceMaxBufferLength"(e,t){const s=this.config,i=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-3*t,s.maxMaxBufferLength/2,i);return r>=i&&(s.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0)}"getAppendedFrag"(e,t=te){const s=this.fragmentTracker.getAppendedFrag(e,te);return s&&"fragment"in s?s.fragment:s}"getNextFragment"(e,t){const s=t.fragments,i=s.length;if(!i)return null;const{"config":r}=this,n=s[0].start;let a;if(t.live){const o=r.initialLiveManifestSize;if(i<o)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${o})`),null;(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<n)&&(a=this.getInitialLiveFragment(t,s),this.startPosition=this.nextLoadPosition=a?this.hls.liveSyncPosition||a.start:e)}else e<=n&&(a=s[0]);if(!a){const s=r.lowLatencyMode?t.partEnd:t.fragmentEnd;a=this.getFragmentAtPosition(e,s,t)}return this.mapToInitFragWhenRequired(a)}"isLoopLoading"(e,t){const s=this.fragmentTracker.getState(e);return(s===be||s===Re&&!!e.gap)&&this.nextLoadPosition>t}"getNextFragmentLoopLoading"(e,t,s,i,r){const n=e.gap,a=this.getNextFragment(this.nextLoadPosition,t);if(null===a)return a;if(e=a,n&&e&&!e.gap&&s.nextStart){const t=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,i);if(null!==t&&s.len+t.len>=r)return this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e.sn}`),null}return e}"mapToInitFragWhenRequired"(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}"getNextPart"(e,t,s){let i=-1,r=!1,n=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(n=n&&!o.independent,i>-1&&s<o.start)break;const l=o.loaded;l?i=-1:(r||o.independent||n)&&o.fragment===t&&(i=a),r=l}return i}"loadedEndOfParts"(e,t){const s=e[e.length-1];return s&&t>s.start&&s.loaded}"getInitialLiveFragment"(e,t){const s=this.fragPrevious;let i=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),i=function findFragmentByPDT(e,t,s){if(null===t||!Array.isArray(e)||!e.length||!h(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;s=s||0;for(let i=0;i<e.length;++i){const r=e[i];if(pdtWithinToleranceTest(t,s,r))return r}return null}(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const r=s.sn+1;if(r>=e.startSN&&r<=e.endSN){const n=t[r-e.startSN];s.cc===n.cc&&(i=n,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=function findFragWithCC(e,t){return BinarySearch_search(e,(e=>e.cc<t?1:e.cc>t?-1:0))}(t,s.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(i=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}"getFragmentAtPosition"(e,t,s){const{"config":i}=this;let{"fragPrevious":r}=this,{"fragments":n,"endSN":a}=s;const{"fragmentHint":o}=s,{"maxFragLookUpTolerance":l}=i,d=s.partList,h=!!(i.lowLatencyMode&&null!=d&&d.length&&o);let c;if(h&&o&&!this.bitrateTest&&(n=n.concat(o),a=o.sn),e<t){c=findFragmentByPTS(r,n,e,e>t-l?0:l)}else c=n[n.length-1];if(c){const e=c.sn-s.startSN,t=this.fragmentTracker.getState(c);if((t===be||t===Re&&c.gap)&&(r=c),r&&c.sn===r.sn&&(!h||d[0].fragment.sn>c.sn)){if(r&&c.level===r.level){const t=n[e+1];c=c.sn<a&&this.fragmentTracker.getState(t)!==be?t:null}}}return c}"synchronizeToLiveEdge"(e){const{"config":t,"media":s}=this;if(!s)return;const i=this.hls.liveSyncPosition,r=s.currentTime,n=e.fragments[0].start,a=e.edge,o=r>=n-t.maxFragLookUpTolerance&&r<=a;if(null!==i&&s.duration>i&&(r<i||!o)){const n=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&s.readyState<4||r<a-n)&&(this.loadedmetadata||(this.nextLoadPosition=i),s.readyState&&(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${i.toFixed(3)}`),s.currentTime=i))}}"alignPlaylists"(e,t,s){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=e.fragments[0].start,n=!t,a=e.alignedSliding&&h(r);if(n||!a&&!r){const{"fragPrevious":r}=this;alignStream(r,s,e);const n=e.fragments[0].start;return this.log(`Live playlist sliding: ${n.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${r?r.sn:"na"} fragments: ${i}`),n}return r}"waitForCdnTuneIn"(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}"setStartPosition"(e,t){let s=this.startPosition;if(s<t&&(s=-1),-1===s||-1===this.lastCurrentTime){const i=null!==this.startTimeOffset,r=i?this.startTimeOffset:e.startTimeOffset;null!==r&&h(r)?(s=t+r,r<0&&(s+=e.totalduration),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Start time offset ${r} found in ${i?"multivariant":"media"} playlist, adjust startPosition to ${s}`),this.startPosition=s):e.live?s=this.hls.liveSyncPosition||t:this.startPosition=s=0,this.lastCurrentTime=s}this.nextLoadPosition=s}"getLoadPosition"(){const{"media":e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}"handleFragLoadAborted"(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}"resetFragmentLoading"(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===xe)||(this.state=Ie)}"onFragmentOrKeyLoadError"(e,t){if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;var i;if(this.fragContextChanged(s))return void this.warn(`Frag load error must match current frag to retry ${s.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);const r=t.details===m.FRAG_GAP;r&&this.fragmentTracker.fragBuffered(s,!0);const n=t.errorAction,{"action":a,"retryCount":o=0,"retryConfig":l}=n||{};if(n&&a===pe&&l){this.resetStartWhenNotLoaded(this.levelLastLoaded);const i=getRetryDelay(l,o);this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${o+1}/${l.maxNumRetry} in ${i}ms`),n.resolved=!0,this.retryDate=self.performance.now()+i,this.state=xe}else if(l&&n){if(this.resetFragmentErrors(e),!(o<l.maxNumRetry))return void v.warn(`${t.details} reached or exceeded max retry (${o})`);r||a===me||(n.resolved=!0)}else(null==n?void 0:n.action)===ge?this.state=Be:this.state=Ue;this.tickImmediate()}"reduceLengthAndFlushBuffer"(e){if(this.state===Me||this.state===Fe){const t=e.frag,s=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,s),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,(null==t?void 0:t.duration)||10);const n=!r;return n&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),n}return!1}"resetFragmentErrors"(e){e===se&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Ce&&(this.state=Ie)}"afterBufferFlushed"(e,t,s){if(!e)return;const i=BufferHelper.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,s),this.state===Oe&&this.resetLoadingState()}"resetLoadingState"(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Ie}"resetStartWhenNotLoaded"(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=e?e.details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}"resetWhenMissingContext"(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}"removeUnbufferedFrags"(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}"updateLevelTiming"(e,t,s,i){var r;const n=s.details;if(!n)return void this.warn("level.details undefined");if(!Object.keys(e.elementaryStreams).reduce(((t,r)=>{const a=e.elementaryStreams[r];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${r} duration reliably (${o})`),t||!1;const l=i?0:updateFragPTSDTS(n,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS);return this.hls.trigger(f.LEVEL_PTS_UPDATED,{"details":n,"level":s,"drift":l,"type":r,"frag":e,"start":a.startPTS,"end":a.endPTS}),!0}return t}),!1)&&null===(null==(r=this.transmuxer)?void 0:r.error)){const t=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(0===s.fragmentError&&(s.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(t.message),this.hls.trigger(f.ERROR,{"type":g.MEDIA_ERROR,"details":m.FRAG_PARSING_ERROR,"fatal":!1,"error":t,"frag":e,"reason":`Found no media in msn ${e.sn} of level "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=Fe,this.hls.trigger(f.FRAG_PARSED,{"frag":e,"part":t})}"resetTransmuxer"(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}"recoverWorkerError"(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set"state"(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get"state"(){return this._state}}class ChunkCache{"constructor"(){this.chunks=[],this.dataLength=0}"push"(e){this.chunks.push(e),this.dataLength+=e.length}"flush"(){const{"chunks":e,"dataLength":t}=this;let s;return e.length?(s=1===e.length?e[0]:function concatUint8Arrays(e,t){const s=new Uint8Array(t);let i=0;for(let t=0;t<e.length;t++){const r=e[t];s.set(r,i),i+=r.length}return s}(e,t),this.reset(),s):new Uint8Array(0)}"reset"(){this.chunks.length=0,this.dataLength=0}}function dummyTrack(e="",t=9e4){return{"type":e,"id":-1,"pid":-1,"inputTimeScale":t,"sequenceNumber":-1,"samples":[],"dropped":0}}class BaseAudioDemuxer{"constructor"(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}"resetInitSegment"(e,t,s,i){this._id3Track={"type":"id3","id":3,"pid":-1,"inputTimeScale":9e4,"sequenceNumber":0,"samples":[],"dropped":0}}"resetTimeStamp"(e){this.initPTS=e,this.resetContiguity()}"resetContiguity"(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}"canParse"(e,t){return!1}"appendFrame"(e,t,s){}"demux"(e,t){this.cachedData&&(e=appendUint8Array(this.cachedData,e),this.cachedData=null);let s,i=getID3Data(e,0),r=i?i.length:0;const n=this._audioTrack,a=this._id3Track,o=i?getTimeStamp(i):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&h(o))&&(this.basePTS=initPTSFn(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),i&&i.length>0&&a.samples.push({"pts":this.lastPTS,"dts":this.lastPTS,"data":i,"type":re,"duration":Number.POSITIVE_INFINITY});r<l;){if(this.canParse(e,r)){const t=this.appendFrame(n,e,r);t?(this.frameIndex++,this.lastPTS=t.sample.pts,r+=t.length,s=r):r=l}else canParse$2(e,r)?(i=getID3Data(e,r),a.samples.push({"pts":this.lastPTS,"dts":this.lastPTS,"data":i,"type":re,"duration":Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===l&&s!==l){const t=sliceUint8(e,s);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,t):this.cachedData=t}}return{"audioTrack":n,"videoTrack":dummyTrack(),"id3Track":a,"textTrack":dummyTrack()}}"demuxSampleAes"(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}"flush"(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{"audioTrack":this._audioTrack,"videoTrack":dummyTrack(),"id3Track":this._id3Track,"textTrack":dummyTrack()}}"destroy"(){}}const initPTSFn=(e,t,s)=>{if(h(e))return 90*e;return 9e4*t+(s?9e4*s.baseTime/s.timescale:0)};function isHeaderPattern$1(e,t){return 255===e[t]&&240==(246&e[t+1])}function getHeaderLength(e,t){return 1&e[t+1]?7:9}function getFullFrameLength(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function isHeader$1(e,t){return t+1<e.length&&isHeaderPattern$1(e,t)}function probe$1(e,t){if(isHeader$1(e,t)){const s=getHeaderLength(e,t);if(t+s>=e.length)return!1;const i=getFullFrameLength(e,t);if(i<=s)return!1;const r=t+i;return r===e.length||isHeader$1(e,r)}return!1}function initTrackConfig(e,t,s,i,r){if(!e.samplerate){const n=function getAudioConfig(e,t,s,i){let r,n,a,o;const l=navigator.userAgent.toLowerCase(),d=i,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=1+((192&t[s+2])>>>6);const c=(60&t[s+2])>>>2;if(!(c>h.length-1))return a=(1&t[s+2])<<2,a|=(192&t[s+3])>>>6,v.log(`manifest codec:${i}, ADTS type:${r}, samplingIndex:${c}`),/firefox/i.test(l)?c>=6?(r=5,o=new Array(4),n=c-3):(r=2,o=new Array(2),n=c):-1!==l.indexOf("android")?(r=2,o=new Array(2),n=c):(r=5,o=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&c>=6?n=c-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(c>=6&&1===a||/vivaldi/i.test(l))||!i&&1===a)&&(r=2,o=new Array(2)),n=c)),o[0]=r<<3,o[0]|=(14&c)>>1,o[1]|=(1&c)<<7,o[1]|=a<<3,5===r&&(o[1]|=(14&n)>>1,o[2]=(1&n)<<7,o[2]|=8,o[3]=0),{"config":o,"samplerate":h[c],"channelCount":a,"codec":"mp4a.40."+r,"manifestCodec":d};{const t=new Error(`invalid ADTS sampling index:${c}`);e.emit(f.ERROR,f.ERROR,{"type":g.MEDIA_ERROR,"details":m.FRAG_PARSING_ERROR,"fatal":!0,"error":t,"reason":t.message})}}(t,s,i,r);if(!n)return;e.config=n.config,e.samplerate=n.samplerate,e.channelCount=n.channelCount,e.codec=n.codec,e.manifestCodec=n.manifestCodec,v.log(`parsed codec:${e.codec}, rate:${n.samplerate}, channels:${n.channelCount}`)}}function getFrameDuration(e){return 9216e4/e}function appendFrame$2(e,t,s,i,r){const n=i+r*getFrameDuration(e.samplerate),a=function parseFrameHeader(e,t){const s=getHeaderLength(e,t);if(t+s<=e.length){const i=getFullFrameLength(e,t)-s;if(i>0)return{"headerLength":s,"frameLength":i}}}(t,s);let o;if(a){const{"frameLength":i,"headerLength":r}=a,l=r+i,d=Math.max(0,s+l-t.length);d?(o=new Uint8Array(l-r),o.set(t.subarray(s+r,t.length),0)):o=t.subarray(s+r,s+l);const h={"unit":o,"pts":n};return d||e.samples.push(h),{"sample":h,"length":l,"missing":d}}const l=t.length-s;o=new Uint8Array(l),o.set(t.subarray(s,t.length),0);return{"sample":{"unit":o,"pts":n},"length":l,"missing":-1}}let $e=null;const Ge=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Ke=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],He=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Ve=[0,1,1,4];function appendFrame$1(e,t,s,i,r){if(s+24>t.length)return;const n=parseHeader(t,s);if(n&&s+n.frameLength<=t.length){const a=i+r*(9e4*n.samplesPerFrame/n.sampleRate),o={"unit":t.subarray(s,s+n.frameLength),"pts":a,"dts":a};return e.config=[],e.channelCount=n.channelCount,e.samplerate=n.sampleRate,e.samples.push(o),{"sample":o,"length":n.frameLength,"missing":0}}}function parseHeader(e,t){const s=e[t+1]>>3&3,i=e[t+1]>>1&3,r=e[t+2]>>4&15,n=e[t+2]>>2&3;if(1!==s&&0!==r&&15!==r&&3!==n){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*Ge[14*(3===s?3-i:3===i?3:4)+r-1],d=Ke[3*(3===s?0:2===s?1:2)+n],h=3===o?1:2,c=He[s][i],u=Ve[i],f=8*c*u,g=Math.floor(c*l/d+a)*u;if(null===$e){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);$e=e?parseInt(e[1]):0}return!!$e&&$e<=87&&2===i&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{"sampleRate":d,"channelCount":h,"frameLength":g,"samplesPerFrame":f}}}function isHeaderPattern(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function isHeader(e,t){return t+1<e.length&&isHeaderPattern(e,t)}function probe(e,t){if(t+1<e.length&&isHeaderPattern(e,t)){const s=4,i=parseHeader(e,t);let r=s;null!=i&&i.frameLength&&(r=i.frameLength);const n=t+r;return n===e.length||isHeader(e,n)}return!1}const We=/\/emsg[-/]ID3/i;const getAudioBSID=(e,t)=>{let s=0,i=5;t+=i;const r=new Uint32Array(1),n=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=e[t];const o=Math.min(i,8),l=8-o;n[0]=4278190080>>>24+l<<l,r[0]=(a[0]&n[0])>>l,s=s?s<<o|r[0]:r[0],t+=1,i-=o}return s};class AC3Demuxer extends BaseAudioDemuxer{"constructor"(e){super(),this.observer=void 0,this.observer=e}"resetInitSegment"(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={"container":"audio/ac-3","type":"audio","id":2,"pid":-1,"sequenceNumber":0,"segmentCodec":"ac3","samples":[],"manifestCodec":t,"duration":i,"inputTimeScale":9e4,"dropped":0}}"canParse"(e,t){return t+64<e.length}"appendFrame"(e,t,s){const i=appendFrame(e,t,s,this.basePTS,this.frameIndex);if(-1!==i){return{"sample":e.samples[e.samples.length-1],"length":i,"missing":0}}}static"probe"(e){if(!e)return!1;const t=getID3Data(e,0);if(!t)return!1;const s=t.length;return 11===e[s]&&119===e[s+1]&&void 0!==getTimeStamp(t)&&getAudioBSID(e,s)<16}}function appendFrame(e,t,s,i,r){if(s+8>t.length)return-1;if(11!==t[s]||119!==t[s+1])return-1;const n=t[s+4]>>6;if(n>=3)return-1;const a=[48e3,44100,32e3][n],o=63&t[s+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+n];if(s+l>t.length)return-1;const d=t[s+6]>>5;let h=0;2===d?h+=2:(1&d&&1!==d&&(h+=2),4&d&&(h+=2));const c=(t[s+6]<<8|t[s+7])>>12-h&1,u=[2,1,2,3,3,4,4,5][d]+c,f=t[s+5]>>3,g=7&t[s+5],m=new Uint8Array([n<<6|f<<1|g>>2,(3&g)<<6|d<<3|c<<2|o>>4,o<<4&224]),p=i+r*(1536/a*9e4),y=t.subarray(s,s+l);return e.config=m,e.channelCount=u,e.samplerate=a,e.samples.push({"unit":y,"pts":p}),l}class BaseVideoParser{"constructor"(){this.VideoSample=null}"createVideoSample"(e,t,s,i){return{"key":e,"frame":!1,"pts":t,"dts":s,"units":[],"debug":i,"length":0}}"getLastNalUnit"(e){var t;let s,i=this.VideoSample;if(i&&0!==i.units.length||(i=e[e.length-1]),null!=(t=i)&&t.units){const e=i.units;s=e[e.length-1]}return s}"pushAccessUnit"(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const s=t.samples,i=s.length;if(!i)return void t.dropped++;{const t=s[i-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}e.debug.length&&v.log(e.pts+"/"+e.dts+":"+e.debug)}}class ExpGolomb{"constructor"(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}"loadWord"(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");i.set(e.subarray(s,s+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r}"skipBits"(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}"readBits"(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&v.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}"skipLZ"(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}"skipUEG"(){this.skipBits(1+this.skipLZ())}"skipEG"(){this.skipBits(1+this.skipLZ())}"readUEG"(){const e=this.skipLZ();return this.readBits(e+1)-1}"readEG"(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}"readBoolean"(){return 1===this.readBits(1)}"readUByte"(){return this.readBits(8)}"readUShort"(){return this.readBits(16)}"readUInt"(){return this.readBits(32)}"skipScalingList"(e){let t,s=8,i=8;for(let r=0;r<e;r++)0!==i&&(t=this.readEG(),i=(s+t+256)%256),s=0===i?s:i}"readSPS"(){let e,t,s,i=0,r=0,n=0,a=0;const o=this.readUByte.bind(this),l=this.readBits.bind(this),d=this.readUEG.bind(this),h=this.readBoolean.bind(this),c=this.skipBits.bind(this),u=this.skipEG.bind(this),f=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);o();const m=o();if(l(5),c(3),o(),f(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){const e=d();if(3===e&&c(1),f(),f(),c(1),h())for(t=3!==e?8:12,s=0;s<t;s++)h()&&g(s<6?16:64)}f();const p=d();if(0===p)d();else if(1===p)for(c(1),u(),u(),e=d(),s=0;s<e;s++)u();f(),c(1);const y=d(),T=d(),v=l(1);0===v&&c(1),c(1),h()&&(i=d(),r=d(),n=d(),a=d());let E=[1,1];if(h()&&h()){switch(o()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[o()<<8|o(),o()<<8|o()]}}return{"width":Math.ceil(16*(y+1)-2*i-2*r),"height":(2-v)*(T+1)*16-(v?2:4)*(n+a),"pixelRatio":E}}"readSliceType"(){return this.readUByte(),this.readUEG(),this.readUEG()}}class AvcVideoParser extends BaseVideoParser{"parseAVCPES"(e,t,s,i,r){const n=this.parseAVCNALu(e,s.data);let a,o=this.VideoSample,l=!1;s.data=null,o&&n.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts,"")),n.forEach((i=>{var n;switch(i.type){case 1:{let t=!1;a=!0;const r=i.data;if(l&&r.length>4){const e=new ExpGolomb(r).readSliceType();2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var d;if(t)null!=(d=o)&&d.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null);o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts,"")),o.frame=!0,o.key=t;break}case 5:a=!0,null!=(n=o)&&n.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts,"")),o.key=!0,o.frame=!0;break;case 6:a=!0,parseSEIMessageFromNALu(i.data,1,s.pts,t.samples);break;case 7:{var h,c;a=!0,l=!0;const t=i.data,s=new ExpGolomb(t).readSPS();if(!e.sps||e.width!==s.width||e.height!==s.height||(null==(h=e.pixelRatio)?void 0:h[0])!==s.pixelRatio[0]||(null==(c=e.pixelRatio)?void 0:c[1])!==s.pixelRatio[1]){e.width=s.width,e.height=s.height,e.pixelRatio=s.pixelRatio,e.sps=[t],e.duration=r;const i=t.subarray(1,4);let n="avc1.";for(let e=0;e<3;e++){let t=i[e].toString(16);t.length<2&&(t="0"+t),n+=t}e.codec=n}break}case 8:a=!0,e.pps=[i.data];break;case 9:a=!0,e.audFound=!0,o&&this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts,"");break;case 12:a=!0;break;default:a=!1,o&&(o.debug+="unknown NAL "+i.type+" ")}if(o&&a){o.units.push(i)}})),i&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}"parseAVCNALu"(e,t){const s=t.byteLength;let i=e.naluState||0;const r=i,n=[];let a,o,l,d=0,h=-1,c=0;for(-1===i&&(h=0,c=31&t[0],i=0,d=1);d<s;)if(a=t[d++],i)if(1!==i)if(a)if(1===a){if(o=d-i-1,h>=0){const e={"data":t.subarray(h,o),"type":c};n.push(e)}else{const s=this.getLastNalUnit(e.samples);s&&(r&&d<=4-r&&s.state&&(s.data=s.data.subarray(0,s.data.byteLength-r)),o>0&&(s.data=appendUint8Array(s.data,t.subarray(0,o)),s.state=0))}d<s?(l=31&t[d],h=d,c=l,i=0):i=-1}else i=0;else i=3;else i=a?0:2;else i=a?0:1;if(h>=0&&i>=0){const e={"data":t.subarray(h,s),"type":c,"state":i};n.push(e)}if(0===n.length){const s=this.getLastNalUnit(e.samples);s&&(s.data=appendUint8Array(s.data,t))}return e.naluState=i,n}}class SampleAesDecrypter{"constructor"(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new Decrypter(t,{"removePKCS7Padding":!1})}"decryptBuffer"(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}"decryptAacSample"(e,t,s){const i=e[t].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),n=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(n).then((r=>{const n=new Uint8Array(r);i.set(n,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}))}"decryptAacSamples"(e,t,s){for(;;t++){if(t>=e.length)return void s();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}"getAvcEncryptedData"(e){const t=16*Math.floor((e.length-48)/160)+16,s=new Int8Array(t);let i=0;for(let t=32;t<e.length-16;t+=160,i+=16)s.set(e.subarray(t,t+16),i);return s}"getAvcDecryptedUnit"(e,t){const s=new Uint8Array(t);let i=0;for(let t=32;t<e.length-16;t+=160,i+=16)e.set(s.subarray(i,i+16),t);return e}"decryptAvcSample"(e,t,s,i,r){const n=discardEPB(r.data),a=this.getAvcEncryptedData(n);this.decryptBuffer(a.buffer).then((a=>{r.data=this.getAvcDecryptedUnit(n,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,i)}))}"decryptAvcSamples"(e,t,s,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length)return void i();const r=e[t].units;for(;!(s>=r.length);s++){const n=r[s];if(!(n.data.length<=48||1!==n.type&&5!==n.type||(this.decryptAvcSample(e,t,s,i,n),this.decrypter.isSync())))return}}}}const Ye=188;class TSDemuxer{"constructor"(e,t,s){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.videoParser=new AvcVideoParser}static"probe"(e){const t=TSDemuxer.syncOffset(e);return t>0&&v.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),-1!==t}static"syncOffset"(e){const t=e.length;let s=Math.min(940,t-Ye)+1,i=0;for(;i<s;){let r=!1,n=-1,a=0;for(let o=i;o<t;o+=Ye){if(71!==e[o]||t-o!==Ye&&71!==e[o+Ye]){if(a)return-1;break}if(a++,-1===n&&(n=o,0!==n&&(s=Math.min(n+18612,e.length-Ye)+1)),r||(r=0===parsePID(e,o)),r&&a>1&&(0===n&&a>2||o+Ye>s))return n}i++}return-1}static"createTrack"(e,t){return{"container":"video"===e||"audio"===e?"video/mp2t":void 0,"type":e,"id":$[e],"pid":-1,"inputTimeScale":9e4,"sequenceNumber":0,"samples":[],"dropped":0,"duration":"audio"===e?t:void 0}}"resetInitSegment"(e,t,s,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=TSDemuxer.createTrack("video"),this._audioTrack=TSDemuxer.createTrack("audio",i),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s,this._duration=i}"resetTimeStamp"(){}"resetContiguity"(){const{"_audioTrack":e,"_videoTrack":t,"_id3Track":s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}"demux"(e,t,s=!1,i=!1){let r;s||(this.sampleAes=null);const n=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let d=n.pid,h=n.pesData,c=a.pid,u=o.pid,f=a.pesData,g=o.pesData,m=null,p=this.pmtParsed,y=this._pmtId,T=e.length;if(this.remainderData&&(T=(e=appendUint8Array(this.remainderData,e)).length,this.remainderData=null),T<Ye&&!i)return this.remainderData=e,{"audioTrack":a,"videoTrack":n,"id3Track":o,"textTrack":l};const E=Math.max(0,TSDemuxer.syncOffset(e));T-=(T-E)%Ye,T<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,T,e.buffer.byteLength-T));let S=0;for(let t=E;t<T;t+=Ye)if(71===e[t]){const i=!!(64&e[t+1]),T=parsePID(e,t);let S;if((48&e[t+3])>>4>1){if(S=t+5+e[t+4],S===t+Ye)continue}else S=t+4;switch(T){case d:i&&(h&&(r=parsePES(h))&&this.videoParser.parseAVCPES(n,l,r,!1,this._duration),h={"data":[],"size":0}),h&&(h.data.push(e.subarray(S,t+Ye)),h.size+=t+Ye-S);break;case c:if(i){if(f&&(r=parsePES(f)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,r);break;case"mp3":this.parseMPEGPES(a,r);break;case"ac3":this.parseAC3PES(a,r)}f={"data":[],"size":0}}f&&(f.data.push(e.subarray(S,t+Ye)),f.size+=t+Ye-S);break;case u:i&&(g&&(r=parsePES(g))&&this.parseID3PES(o,r),g={"data":[],"size":0}),g&&(g.data.push(e.subarray(S,t+Ye)),g.size+=t+Ye-S);break;case 0:i&&(S+=e[S]+1),y=this._pmtId=parsePAT(e,S);break;case y:{i&&(S+=e[S]+1);const r=parsePMT(e,S,this.typeSupported,s,this.observer);d=r.videoPid,d>0&&(n.pid=d,n.segmentCodec=r.segmentVideoCodec),c=r.audioPid,c>0&&(a.pid=c,a.segmentCodec=r.segmentAudioCodec),u=r.id3Pid,u>0&&(o.pid=u),null===m||p||(v.warn(`MPEG-TS PMT found at ${t} after unknown PID '${m}'. Backtracking to sync byte @${E} to parse all TS packets.`),m=null,t=E-188),p=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=T}}else S++;S>0&&emitParsingError(this.observer,new Error(`Found ${S} TS packet/s that do not start with 0x47`)),n.pesData=h,a.pesData=f,o.pesData=g;const L={"audioTrack":a,"videoTrack":n,"id3Track":o,"textTrack":l};return i&&this.extractRemainingSamples(L),L}"flush"(){const{"remainderData":e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{"videoTrack":this._videoTrack,"audioTrack":this._audioTrack,"id3Track":this._id3Track,"textTrack":this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}"extractRemainingSamples"(e){const{"audioTrack":t,"videoTrack":s,"id3Track":i,"textTrack":r}=e,n=s.pesData,a=t.pesData,o=i.pesData;let l;if(n&&(l=parsePES(n))?(this.videoParser.parseAVCPES(s,r,l,!0,this._duration),s.pesData=null):s.pesData=n,a&&(l=parsePES(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=a&&a.size&&v.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=parsePES(o))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=o}"demuxSampleAes"(e,t,s){const i=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,t);return this.decrypt(i,r)}"decrypt"(e,t){return new Promise((s=>{const{"audioTrack":i,"videoTrack":r}=e;i.samples&&"aac"===i.segmentCodec?t.decryptAacSamples(i.samples,0,(()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,(()=>{s(e)})):s(e)})):r.samples&&t.decryptAvcSamples(r.samples,0,0,(()=>{s(e)}))}))}"destroy"(){this._duration=0}"parseAACPES"(e,t){let s=0;const i=this.aacOverFlow;let r,n,a,o=t.data;if(i){this.aacOverFlow=null;const t=i.missing,r=i.sample.unit.byteLength;if(-1===t)o=appendUint8Array(i.sample.unit,o);else{const n=r-t;i.sample.unit.set(o.subarray(0,t),n),e.samples.push(i.sample),s=i.missing}}for(r=s,n=o.length;r<n-1&&!isHeader$1(o,r);r++);if(r!==s){let e;const t=r<n-1;if(e=t?`AAC PES did not start with ADTS header,offset:${r}`:"No ADTS header found in AAC PES",emitParsingError(this.observer,new Error(e),t),!t)return}if(initTrackConfig(e,this.observer,o,r,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!i)return void v.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=getFrameDuration(e.samplerate);a=i.sample.pts+t}}let l,d=0;for(;r<n;){if(l=appendFrame$2(e,o,r,a,d),r+=l.length,l.missing){this.aacOverFlow=l;break}for(d++;r<n-1&&!isHeader$1(o,r);r++);}}"parseMPEGPES"(e,t){const s=t.data,i=s.length;let r=0,n=0;const a=t.pts;if(void 0!==a)for(;n<i;)if(isHeader(s,n)){const t=appendFrame$1(e,s,n,a,r);if(!t)break;n+=t.length,r++}else n++;else v.warn("[tsdemuxer]: MPEG PES unknown PTS")}"parseAC3PES"(e,t){{const s=t.data,i=t.pts;if(void 0===i)return void v.warn("[tsdemuxer]: AC3 PES unknown PTS");const r=s.length;let n,a=0,o=0;for(;o<r&&(n=appendFrame(e,s,o,i,a++))>0;)o+=n}}"parseID3PES"(e,t){if(void 0===t.pts)return void v.warn("[tsdemuxer]: ID3 PES unknown PTS");const s=_extends({},t,{"type":this._videoTrack?ae:re,"duration":Number.POSITIVE_INFINITY});e.samples.push(s)}}function parsePID(e,t){return((31&e[t+1])<<8)+e[t+2]}function parsePAT(e,t){return(31&e[t+10])<<8|e[t+11]}function parsePMT(e,t,s,i,r){const n={"audioPid":-1,"videoPid":-1,"id3Pid":-1,"segmentVideoCodec":"avc","segmentAudioCodec":"aac"},a=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<a;){const a=parsePID(e,t),o=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!i){logEncryptedSamplesFoundInUnencryptedStream("ADTS AAC");break}case 15:-1===n.audioPid&&(n.audioPid=a);break;case 21:-1===n.id3Pid&&(n.id3Pid=a);break;case 219:if(!i){logEncryptedSamplesFoundInUnencryptedStream("H.264");break}case 27:-1===n.videoPid&&(n.videoPid=a,n.segmentVideoCodec="avc");break;case 3:case 4:s.mpeg||s.mp3?-1===n.audioPid&&(n.audioPid=a,n.segmentAudioCodec="mp3"):v.log("MPEG audio found, not supported in this browser");break;case 193:if(!i){logEncryptedSamplesFoundInUnencryptedStream("AC-3");break}case 129:s.ac3?-1===n.audioPid&&(n.audioPid=a,n.segmentAudioCodec="ac3"):v.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===n.audioPid&&o>0){let i=t+5,r=o;for(;r>2;){if(106===e[i])!0!==s.ac3?v.log("AC-3 audio found, not supported in this browser for now"):(n.audioPid=a,n.segmentAudioCodec="ac3");const t=e[i+1]+2;i+=t,r-=t}}break;case 194:case 135:return emitParsingError(r,new Error("Unsupported EC-3 in M2TS found")),n;case 36:return emitParsingError(r,new Error("Unsupported HEVC in M2TS found")),n}t+=o+5}return n}function emitParsingError(e,t,s){v.warn(`parsing error: ${t.message}`),e.emit(f.ERROR,f.ERROR,{"type":g.MEDIA_ERROR,"details":m.FRAG_PARSING_ERROR,"fatal":!1,"levelRetry":s,"error":t,"reason":t.message})}function logEncryptedSamplesFoundInUnencryptedStream(e){v.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function parsePES(e){let t,s,i,r,n,a=0;const o=e.data;if(!e||0===e.size)return null;for(;o[0].length<19&&o.length>1;)o[0]=appendUint8Array(o[0],o[1]),o.splice(1,1);t=o[0];if(1===(t[0]<<16)+(t[1]<<8)+t[2]){if(s=(t[4]<<8)+t[5],s&&s>e.size-6)return null;const l=t[7];192&l&&(r=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&l?(n=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,r-n>54e5&&(v.warn(`${Math.round((r-n)/9e4)}s delta between PTS and DTS, align them`),r=n)):n=r),i=t[8];let d=i+9;if(e.size<=d)return null;e.size-=d;const h=new Uint8Array(e.size);for(let e=0,s=o.length;e<s;e++){t=o[e];let s=t.byteLength;if(d){if(d>s){d-=s;continue}t=t.subarray(d),s-=d,d=0}h.set(t,a),a+=s}return s&&(s-=i+3),{"data":h,"pts":r,"dts":n,"len":s}}return null}class AAC{static"getSilentFrame"(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const je=Math.pow(2,32)-1;class MP4{static"init"(){let e;for(e in MP4.types={"avc1":[],"avcC":[],"btrt":[],"dinf":[],"dref":[],"esds":[],"ftyp":[],"hdlr":[],"mdat":[],"mdhd":[],"mdia":[],"mfhd":[],"minf":[],"moof":[],"moov":[],"mp4a":[],".mp3":[],"dac3":[],"ac-3":[],"mvex":[],"mvhd":[],"pasp":[],"sdtp":[],"stbl":[],"stco":[],"stsc":[],"stsd":[],"stsz":[],"stts":[],"tfdt":[],"tfhd":[],"traf":[],"trak":[],"trun":[],"trex":[],"tkhd":[],"vmhd":[],"smhd":[]},MP4.types)MP4.types.hasOwnProperty(e)&&(MP4.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={"video":t,"audio":s};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=r,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const n=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,n,o,n,a),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,i))}static"box"(e,...t){let s=8,i=t.length;const r=i;for(;i--;)s+=t[i].byteLength;const n=new Uint8Array(s);for(n[0]=s>>24&255,n[1]=s>>16&255,n[2]=s>>8&255,n[3]=255&s,n.set(e,4),i=0,s=8;i<r;i++)n.set(t[i],s),s+=t[i].byteLength;return n}static"hdlr"(e){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[e])}static"mdat"(e){return MP4.box(MP4.types.mdat,e)}static"mdhd"(e,t){t*=e;const s=Math.floor(t/(je+1)),i=Math.floor(t%(je+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}static"mdia"(e){return MP4.box(MP4.types.mdia,MP4.mdhd(e.timescale,e.duration),MP4.hdlr(e.type),MP4.minf(e))}static"mfhd"(e){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static"minf"(e){return"audio"===e.type?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(e)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(e))}static"moof"(e,t,s){return MP4.box(MP4.types.moof,MP4.mfhd(e),MP4.traf(s,t))}static"moov"(e){let t=e.length;const s=[];for(;t--;)s[t]=MP4.trak(e[t]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(e[0].timescale,e[0].duration)].concat(s).concat(MP4.mvex(e)))}static"mvex"(e){let t=e.length;const s=[];for(;t--;)s[t]=MP4.trex(e[t]);return MP4.box.apply(null,[MP4.types.mvex,...s])}static"mvhd"(e,t){t*=e;const s=Math.floor(t/(je+1)),i=Math.floor(t%(je+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,s>>24,s>>16&255,s>>8&255,255&s,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,r)}static"sdtp"(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let i,r;for(i=0;i<t.length;i++)r=t[i].flags,s[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return MP4.box(MP4.types.sdtp,s)}static"stbl"(e){return MP4.box(MP4.types.stbl,MP4.stsd(e),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))}static"avc1"(e){let t,s,i,r=[],n=[];for(t=0;t<e.sps.length;t++)s=e.sps[t],i=s.byteLength,r.push(i>>>8&255),r.push(255&i),r=r.concat(Array.prototype.slice.call(s));for(t=0;t<e.pps.length;t++)s=e.pps[t],i=s.byteLength,n.push(i>>>8&255),n.push(255&i),n=n.concat(Array.prototype.slice.call(s));const a=MP4.box(MP4.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|e.sps.length].concat(r).concat([e.pps.length]).concat(n))),o=e.width,l=e.height,d=e.pixelRatio[0],h=e.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,h>>24,h>>16&255,h>>8&255,255&h])))}static"esds"(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static"audioStsd"(e){const t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static"mp4a"(e){return MP4.box(MP4.types.mp4a,MP4.audioStsd(e),MP4.box(MP4.types.esds,MP4.esds(e)))}static"mp3"(e){return MP4.box(MP4.types[".mp3"],MP4.audioStsd(e))}static"ac3"(e){return MP4.box(MP4.types["ac-3"],MP4.audioStsd(e),MP4.box(MP4.types.dac3,e.config))}static"stsd"(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(e)):"ac3"===e.segmentCodec?MP4.box(MP4.types.stsd,MP4.STSD,MP4.ac3(e)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(e)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(e))}static"tkhd"(e){const t=e.id,s=e.duration*e.timescale,i=e.width,r=e.height,n=Math.floor(s/(je+1)),a=Math.floor(s%(je+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,r>>8&255,255&r,0,0]))}static"traf"(e,t){const s=MP4.sdtp(e),i=e.id,r=Math.floor(t/(je+1)),n=Math.floor(t%(je+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n])),MP4.trun(e,s.length+16+20+8+16+8+8),s)}static"trak"(e){return e.duration=e.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(e),MP4.mdia(e))}static"trex"(e){const t=e.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static"trun"(e,t){const s=e.samples||[],i=s.length,r=12+16*i,n=new Uint8Array(r);let a,o,l,d,h,c;for(t+=8+r,n.set(["video"===e.type?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<i;a++)o=s[a],l=o.duration,d=o.size,h=o.flags,c=o.cts,n.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,d>>>24&255,d>>>16&255,d>>>8&255,255&d,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*a);return MP4.box(MP4.types.trun,n)}static"initSegment"(e){MP4.types||MP4.init();const t=MP4.moov(e);return appendUint8Array(MP4.FTYP,t)}}MP4.types=void 0,MP4.HDLR_TYPES=void 0,MP4.STTS=void 0,MP4.STSC=void 0,MP4.STCO=void 0,MP4.STSZ=void 0,MP4.VMHD=void 0,MP4.SMHD=void 0,MP4.STSD=void 0,MP4.FTYP=void 0,MP4.DINF=void 0;function toTimescaleFromBase(e,t,s=1,i=!1){const r=e*t*s;return i?Math.round(r):r}function toMsFromMpegTsClock(e,t=!1){return toTimescaleFromBase(e,1e3,1/9e4,t)}let qe,ze=null,Xe=null;class MP4Remuxer{"constructor"(e,t,s,i=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,null===ze){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);ze=e?parseInt(e[1]):0}if(null===Xe){const e=navigator.userAgent.match(/Safari\/(\d+)/i);Xe=e?parseInt(e[1]):0}}"destroy"(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}"resetTimeStamp"(e){v.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}"resetNextTimestamp"(){v.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}"resetInitSegment"(){v.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}"getVideoStartPts"(e){let t=!1;const s=e[0].pts,i=e.reduce(((e,i)=>{let r=i.pts,n=r-e;return n<-4294967296&&(t=!0,r=normalizePts(r,s),n=r-e),n>0?e:r}),s);return t&&v.debug("PTS rollover detected"),i}"remux"(e,t,s,i,r,n,a,o){let l,d,h,c,u,f,g=r,m=r;const p=e.pid>-1,y=t.pid>-1,T=t.samples.length,E=e.samples.length>0,S=a&&T>0||T>1;if((!p||E)&&(!y||S)||this.ISGenerated||a){if(this.ISGenerated){var L,A,R,b;const e=this.videoTrackConfig;!e||t.width===e.width&&t.height===e.height&&(null==(L=t.pixelRatio)?void 0:L[0])===(null==(A=e.pixelRatio)?void 0:A[0])&&(null==(R=t.pixelRatio)?void 0:R[1])===(null==(b=e.pixelRatio)?void 0:b[1])||this.resetInitSegment()}else h=this.generateIS(e,t,r,n);const s=this.isVideoContiguous;let i,a=-1;if(S&&(a=function findKeyframeIndex(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!s&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){v.warn(`[mp4-remuxer]: Dropped ${a} out of ${T} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,m+=(t.samples[0].pts-e)/t.inputTimeScale,i=m}else-1===a&&(v.warn(`[mp4-remuxer]: No keyframe found out of ${T} video samples`),f=!1);if(this.ISGenerated){if(E&&S){const s=this.getVideoStartPts(t.samples),i=(normalizePts(e.samples[0].pts,s)-s)/t.inputTimeScale;g+=Math.max(0,i),m+=Math.max(0,-i)}if(E){if(e.samplerate||(v.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),h=this.generateIS(e,t,r,n)),d=this.remuxAudio(e,g,this.isAudioContiguous,n,y||S||o===se?m:void 0),S){const i=d?d.endPTS-d.startPTS:0;t.inputTimeScale||(v.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),h=this.generateIS(e,t,r,n)),l=this.remuxVideo(t,m,s,i)}}else S&&(l=this.remuxVideo(t,m,s,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=i)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(u=flushTextTrackMetadataCueSamples(s,r,this._initPTS,this._initDTS)),i.samples.length&&(c=flushTextTrackUserdataCueSamples(i,r,this._initPTS))),{"audio":d,"video":l,"initSegment":h,"independent":f,"text":c,"id3":u}}"generateIS"(e,t,s,i){const r=e.samples,n=t.samples,a=this.typeSupported,o={},l=this._initPTS;let d,h,c,u=!l||i,f="audio/mp4";if(u&&(d=h=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={"id":"audio","container":f,"codec":e.codec,"initSegment":"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):MP4.initSegment([e]),"metadata":{"channelCount":e.channelCount}},u&&(c=e.inputTimeScale,l&&c===l.timescale?u=!1:d=h=r[0].pts-Math.round(c*s))}if(t.sps&&t.pps&&n.length){if(t.timescale=t.inputTimeScale,o.video={"id":"main","container":"video/mp4","codec":t.codec,"initSegment":MP4.initSegment([t]),"metadata":{"width":t.width,"height":t.height}},u)if(c=t.inputTimeScale,l&&c===l.timescale)u=!1;else{const e=this.getVideoStartPts(n),t=Math.round(c*s);h=Math.min(h,normalizePts(n[0].dts,e)-t),d=Math.min(d,e-t)}this.videoTrackConfig={"width":t.width,"height":t.height,"pixelRatio":t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,u?(this._initPTS={"baseTime":d,"timescale":c},this._initDTS={"baseTime":h,"timescale":c}):d=c=void 0,{"tracks":o,"initPTS":d,"timescale":c}}"remuxVideo"(e,t,s,i){const r=e.inputTimeScale,n=e.samples,a=[],o=n.length,l=this._initPTS;let d,h,c=this.nextAvcDts,u=8,p=this.videoSampleDuration,y=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,E=!1;if(!s||null===c){const e=t*r,i=n[0].pts-normalizePts(n[0].dts,n[0].pts);ze&&null!==c&&Math.abs(e-i-c)<15e3?s=!0:c=e-i}const S=l.baseTime*r/l.timescale;for(let e=0;e<o;e++){const t=n[e];t.pts=normalizePts(t.pts-S,c),t.dts=normalizePts(t.dts-S,c),t.dts<n[e>0?e-1:e].dts&&(E=!0)}E&&n.sort((function(e,t){const s=e.dts-t.dts,i=e.pts-t.pts;return s||i})),d=n[0].dts,h=n[n.length-1].dts;const L=h-d,A=L?Math.round(L/(o-1)):p||e.inputTimeScale/30;if(s){const e=d-c,s=e>A,i=e<-1;if((s||i)&&(s?v.warn(`AVC: ${toMsFromMpegTsClock(e,!0)} ms (${e}dts) hole between fragments detected at ${t.toFixed(3)}`):v.warn(`AVC: ${toMsFromMpegTsClock(-e,!0)} ms (${e}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!i||c>=n[0].pts||ze)){d=c;const t=n[0].pts-e;if(s)n[0].dts=d,n[0].pts=t;else for(let s=0;s<n.length&&!(n[s].dts>t);s++)n[s].dts-=e,n[s].pts-=e;v.log(`Video: Initial PTS/DTS adjusted: ${toMsFromMpegTsClock(t,!0)}/${toMsFromMpegTsClock(d,!0)}, delta: ${toMsFromMpegTsClock(e,!0)} ms`)}}d=Math.max(0,d);let R=0,b=0,k=d;for(let e=0;e<o;e++){const t=n[e],s=t.units,i=s.length;let r=0;for(let e=0;e<i;e++)r+=s[e].data.length;b+=r,R+=i,t.length=r,t.dts<k?(t.dts=k,k+=A/4|0||1):k=t.dts,y=Math.min(t.pts,y),T=Math.max(t.pts,T)}h=n[o-1].dts;const D=b+4*R+8;let C;try{C=new Uint8Array(D)}catch(e){return void this.observer.emit(f.ERROR,f.ERROR,{"type":g.MUX_ERROR,"details":m.REMUX_ALLOC_ERROR,"fatal":!1,"error":e,"bytes":D,"reason":`fail allocating video mdat ${D}`})}const I=new DataView(C.buffer);I.setUint32(0,D),C.set(MP4.types.mdat,4);let P=!1,w=Number.POSITIVE_INFINITY,x=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,M=Number.NEGATIVE_INFINITY;for(let e=0;e<o;e++){const t=n[e],s=t.units;let l,d=0;for(let e=0,t=s.length;e<t;e++){const t=s[e],i=t.data,r=t.data.byteLength;I.setUint32(u,r),u+=4,C.set(i,u),u+=r,d+=4+r}if(e<o-1)p=n[e+1].dts-t.dts,l=n[e+1].pts-t.pts;else{const s=this.config,a=e>0?t.dts-n[e-1].dts:A;if(l=e>0?t.pts-n[e-1].pts:A,s.stretchShortVideoTrack&&null!==this.nextAudioPts){const e=Math.floor(s.maxBufferHole*r),n=(i?y+i*r:this.nextAudioPts)-t.pts;n>e?(p=n-a,p<0?p=a:P=!0,v.log(`[mp4-remuxer]: It is approximately ${n/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=a}else p=a}const h=Math.round(t.pts-t.dts);w=Math.min(w,p),_=Math.max(_,p),x=Math.min(x,l),M=Math.max(M,l),a.push(new Mp4Sample(t.key,p,d,h))}if(a.length)if(ze){if(ze<70){const e=a[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(Xe&&M-x<_-w&&A/_<.025&&0===a[0].cts){v.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=d;for(let t=0,s=a.length;t<s;t++){const i=e+a[t].duration,r=e+a[t].cts;if(t<s-1){const e=i+a[t+1].cts;a[t].duration=e-r}else a[t].duration=t?a[t-1].duration:A;a[t].cts=0,e=i}}p=P||!p?A:p,this.nextAvcDts=c=h+p,this.videoSampleDuration=p,this.isVideoContiguous=!0;const F={"data1":MP4.moof(e.sequenceNumber++,d,_extends({},e,{"samples":a})),"data2":C,"startPTS":y/r,"endPTS":(T+p)/r,"startDTS":d/r,"endDTS":c/r,"type":"video","hasAudio":!1,"hasVideo":!0,"nb":a.length,"dropped":e.dropped};return e.samples=[],e.dropped=0,F}"getSamplesPerFrame"(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}"remuxAudio"(e,t,s,i,r){const n=e.inputTimeScale,a=n/(e.samplerate?e.samplerate:n),o=this.getSamplesPerFrame(e),l=o*a,d=this._initPTS,h="mp3"===e.segmentCodec&&this.typeSupported.mpeg,c=[],u=void 0!==r;let p=e.samples,y=h?0:8,T=this.nextAudioPts||-1;const E=t*n,S=d.baseTime*n/d.timescale;if(this.isAudioContiguous=s=s||p.length&&T>0&&(i&&Math.abs(E-T)<9e3||Math.abs(normalizePts(p[0].pts-S,E)-T)<20*l),p.forEach((function(e){e.pts=normalizePts(e.pts-S,E)})),!s||T<0){if(p=p.filter((e=>e.pts>=0)),!p.length)return;T=0===r?0:i&&!u?Math.max(0,E):p[0].pts}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let s=0,i=T;s<p.length;s++){const r=p[s],a=r.pts,o=a-i,d=Math.abs(1e3*o/n);if(o<=-t*l&&u)0===s&&(v.warn(`Audio frame @ ${(a/n).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*o/n)} ms.`),this.nextAudioPts=T=i=a);else if(o>=t*l&&d<1e4&&u){let t=Math.round(o/l);i=a-t*l,i<0&&(t--,i+=l),0===s&&(this.nextAudioPts=T=i),v.warn(`[mp4-remuxer]: Injecting ${t} audio frame @ ${(i/n).toFixed(3)}s due to ${Math.round(1e3*o/n)} ms gap.`);for(let n=0;n<t;n++){const t=Math.max(i,0);let n=AAC.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);n||(v.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),n=r.unit.subarray()),p.splice(s,0,{"unit":n,"pts":t}),i+=l,s++}}r.pts=i,i+=l}}let L,A=null,R=null,b=0,k=p.length;for(;k--;)b+=p[k].unit.byteLength;for(let t=0,i=p.length;t<i;t++){const i=p[t],r=i.unit;let n=i.pts;if(null!==R){c[t-1].duration=Math.round((n-R)/a)}else{if(s&&"aac"===e.segmentCodec&&(n=T),A=n,!(b>0))return;b+=y;try{L=new Uint8Array(b)}catch(e){return void this.observer.emit(f.ERROR,f.ERROR,{"type":g.MUX_ERROR,"details":m.REMUX_ALLOC_ERROR,"fatal":!1,"error":e,"bytes":b,"reason":`fail allocating audio mdat ${b}`})}if(!h){new DataView(L.buffer).setUint32(0,b),L.set(MP4.types.mdat,4)}}L.set(r,y);const l=r.byteLength;y+=l,c.push(new Mp4Sample(!0,o,l,0)),R=n}const D=c.length;if(!D)return;const C=c[c.length-1];this.nextAudioPts=T=R+a*C.duration;const I=h?new Uint8Array(0):MP4.moof(e.sequenceNumber++,A/a,_extends({},e,{"samples":c}));e.samples=[];const P=A/n,w=T/n,x={"data1":I,"data2":L,"startPTS":P,"endPTS":w,"startDTS":P,"endDTS":w,"type":"audio","hasAudio":!0,"hasVideo":!1,"nb":D};return this.isAudioContiguous=!0,x}"remuxEmptyAudio"(e,t,s,i){const r=e.inputTimeScale,n=r/(e.samplerate?e.samplerate:r),a=this.nextAudioPts,o=this._initDTS,l=9e4*o.baseTime/o.timescale,d=(null!==a?a:i.startDTS*r)+l,h=i.endDTS*r+l,c=1024*n,u=Math.ceil((h-d)/c),f=AAC.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(v.warn("[mp4-remuxer]: remux empty Audio"),!f)return void v.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const g=[];for(let e=0;e<u;e++){const t=d+e*c;g.push({"unit":f,"pts":t,"dts":t})}return e.samples=g,this.remuxAudio(e,t,s,!1)}}function normalizePts(e,t){let s;if(null===t)return e;for(s=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=s;return e}function flushTextTrackMetadataCueSamples(e,t,s,i){const r=e.samples.length;if(!r)return;const n=e.inputTimeScale;for(let a=0;a<r;a++){const r=e.samples[a];r.pts=normalizePts(r.pts-s.baseTime*n/s.timescale,t*n)/n,r.dts=normalizePts(r.dts-i.baseTime*n/i.timescale,t*n)/n}const a=e.samples;return e.samples=[],{"samples":a}}function flushTextTrackUserdataCueSamples(e,t,s){const i=e.samples.length;if(!i)return;const r=e.inputTimeScale;for(let n=0;n<i;n++){const i=e.samples[n];i.pts=normalizePts(i.pts-s.baseTime*r/s.timescale,t*r)/r}e.samples.sort(((e,t)=>e.pts-t.pts));const n=e.samples;return e.samples=[],{"samples":n}}class Mp4Sample{"constructor"(e,t,s,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=s,this.cts=i,this.flags={"isLeading":0,"isDependedOn":0,"hasRedundancy":0,"degradPrio":0,"dependsOn":e?2:1,"isNonSync":e?0:1}}}function getParsedTrackCodec(e,t){const s=null==e?void 0:e.codec;if(s&&s.length>4)return s;if(t===L){if("ec-3"===s||"ac-3"===s||"alac"===s)return s;if("fLaC"===s||"Opus"===s){return getCodecCompatibleName(s,!1)}const e="mp4a.40.5";return v.info(`Parsed audio codec "${s}" or audio object type not handled. Using "${e}"`),e}return v.warn(`Unhandled video codec "${s}"`),"hvc1"===s||"hev1"===s?"hvc1.1.6.L120.90":"av01"===s?"av01.0.04M.08":"avc1.42e01e"}try{qe=self.performance.now.bind(self.performance)}catch(e){v.debug("Unable to use Performance API on this environment"),qe=null==b?void 0:b.Date.now}const Qe=[{"demux":class MP4Demuxer{"constructor"(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}"resetTimeStamp"(){}"resetInitSegment"(e,t,s,i){const r=this.videoTrack=dummyTrack("video",1),n=this.audioTrack=dummyTrack("audio",1),a=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=parseInitSegment(e);if(o.video){const{"id":e,"timescale":t,"codec":s}=o.video;r.id=e,r.timescale=a.timescale=t,r.codec=s}if(o.audio){const{"id":e,"timescale":t,"codec":s}=o.audio;n.id=e,n.timescale=t,n.codec=s}a.id=$.text,r.sampleDuration=0,r.duration=n.duration=i}"resetContiguity"(){this.remainderData=null}static"probe"(e){return function hasMoofData(e){const t=e.byteLength;for(let s=0;s<t;){const i=readUint32(e,s);if(i>8&&109===e[s+4]&&111===e[s+5]&&111===e[s+6]&&102===e[s+7])return!0;s=i>1?s+i:t}return!1}(e)}"demux"(e,t){this.timeOffset=t;let s=e;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=appendUint8Array(this.remainderData,e));const t=function segmentValidRange(e){const t={"valid":null,"remainder":null},s=findBox(e,["moof"]);if(s.length<2)return t.remainder=e,t;const i=s[s.length-1];return t.valid=sliceUint8(e,0,i.byteOffset-8),t.remainder=sliceUint8(e,i.byteOffset-8),t}(s);this.remainderData=t.remainder,i.samples=t.valid||new Uint8Array}else i.samples=s;const n=this.extractID3Track(i,t);return r.samples=parseSamples(t,i),{"videoTrack":i,"audioTrack":this.audioTrack,"id3Track":n,"textTrack":this.txtTrack}}"flush"(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return s.samples=parseSamples(e,t),{"videoTrack":t,"audioTrack":dummyTrack(),"id3Track":i,"textTrack":dummyTrack()}}"extractID3Track"(e,t){const s=this.id3Track;if(e.samples.length){const i=findBox(e.samples,["emsg"]);i&&i.forEach((e=>{const i=function parseEmsg(e){const t=e[0];let s="",i="",r=0,n=0,a=0,o=0,l=0,d=0;if(0===t){for(;"\0"!==bin2str(e.subarray(d,d+1));)s+=bin2str(e.subarray(d,d+1)),d+=1;for(s+=bin2str(e.subarray(d,d+1)),d+=1;"\0"!==bin2str(e.subarray(d,d+1));)i+=bin2str(e.subarray(d,d+1)),d+=1;i+=bin2str(e.subarray(d,d+1)),d+=1,r=readUint32(e,12),n=readUint32(e,16),o=readUint32(e,20),l=readUint32(e,24),d=28}else if(1===t){d+=4,r=readUint32(e,d),d+=4;const t=readUint32(e,d);d+=4;const n=readUint32(e,d);for(d+=4,a=2**32*t+n,c(a)||(a=Number.MAX_SAFE_INTEGER,v.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=readUint32(e,d),d+=4,l=readUint32(e,d),d+=4;"\0"!==bin2str(e.subarray(d,d+1));)s+=bin2str(e.subarray(d,d+1)),d+=1;for(s+=bin2str(e.subarray(d,d+1)),d+=1;"\0"!==bin2str(e.subarray(d,d+1));)i+=bin2str(e.subarray(d,d+1)),d+=1;i+=bin2str(e.subarray(d,d+1)),d+=1}return{"schemeIdUri":s,"value":i,"timeScale":r,"presentationTime":a,"presentationTimeDelta":n,"eventDuration":o,"id":l,"payload":e.subarray(d,e.byteLength)}}(e);if(We.test(i.schemeIdUri)){const e=h(i.presentationTime)?i.presentationTime/i.timeScale:t+i.presentationTimeDelta/i.timeScale;let r=4294967295===i.eventDuration?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;r<=.001&&(r=Number.POSITIVE_INFINITY);const n=i.payload;s.samples.push({"data":n,"len":n.byteLength,"dts":e,"pts":e,"type":ae,"duration":r})}}))}return s}"demuxSampleAes"(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}"destroy"(){}},"remux":class PassThroughRemuxer{"constructor"(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}"destroy"(){}"resetTimeStamp"(e){this.initPTS=e,this.lastEndTime=null}"resetNextTimestamp"(){this.lastEndTime=null}"resetInitSegment"(e,t,s,i){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(function patchEncyptionData(e,t){if(!e||!t)return e;const s=t.keyId;s&&t.isCommonEncryption&&findBox(e,["moov","trak"]).forEach((e=>{const t=findBox(e,["mdia","minf","stbl","stsd"])[0].subarray(8);let i=findBox(t,["enca"]);const r=i.length>0;r||(i=findBox(t,["encv"])),i.forEach((e=>{findBox(r?e.subarray(28):e.subarray(78),["sinf"]).forEach((e=>{const t=parseSinf(e);if(t){const e=t.subarray(8,24);e.some((e=>0!==e))||(v.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Hex_hexDump(e)} -> ${Hex_hexDump(s)}`),t.set(s,8))}}))}))}));return e}(e,i)),this.emitInitSegment=!0}"generateInitSegment"(e){let{"audioCodec":t,"videoCodec":s}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const i=this.initData=parseInitSegment(e);i.audio&&(t=getParsedTrackCodec(i.audio,L)),i.video&&(s=getParsedTrackCodec(i.video,A));const r={};i.audio&&i.video?r.audiovideo={"container":"video/mp4","codec":t+","+s,"initSegment":e,"id":"main"}:i.audio?r.audio={"container":"audio/mp4","codec":t,"initSegment":e,"id":"audio"}:i.video?r.video={"container":"video/mp4","codec":s,"initSegment":e,"id":"main"}:v.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r}"remux"(e,t,s,i,r,n){var a,o;let{"initPTS":l,"lastEndTime":d}=this;const c={"audio":void 0,"video":void 0,"text":i,"id3":s,"initSegment":void 0};h(d)||(d=this.lastEndTime=r||0);const u=t.samples;if(null==u||!u.length)return c;const f={"initPTS":void 0,"timescale":1};let g=this.initData;if(null!=(a=g)&&a.length||(this.generateInitSegment(u),g=this.initData),null==(o=g)||!o.length)return v.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const m=function getDuration(e,t){let s=0,i=0,r=0;const n=findBox(e,["moof","traf"]);for(let e=0;e<n.length;e++){const a=n[e],o=findBox(a,["tfhd"])[0],l=t[readUint32(o,4)];if(!l)continue;const d=l.default,h=readUint32(o,0)|(null==d?void 0:d.flags);let c=null==d?void 0:d.duration;8&h&&(c=readUint32(o,2&h?12:8));const u=l.timescale||9e4,f=findBox(a,["trun"]);for(let e=0;e<f.length;e++)s=computeRawDurationFromSamples(f[e]),!s&&c&&(s=c*readUint32(f[e],4)),l.type===A?i+=s/u:l.type===L&&(r+=s/u)}if(0===i&&0===r){let t=1/0,s=0,i=0;const r=findBox(e,["sidx"]);for(let e=0;e<r.length;e++){const n=parseSegmentIndex(r[e]);if(null!=n&&n.references){t=Math.min(t,n.earliestPresentationTime/n.timescale);const e=n.references.reduce(((e,t)=>e+t.info.duration||0),0);s=Math.max(s,e+n.earliestPresentationTime/n.timescale),i=s-t}}if(i&&h(i))return i}return i||r}(u,g),p=function getStartDTS(e,t){return findBox(t,["moof","traf"]).reduce(((t,s)=>{const i=findBox(s,["tfdt"])[0],r=i[0],n=findBox(s,["tfhd"]).reduce(((t,s)=>{const n=readUint32(s,4),a=e[n];if(a){let e=readUint32(i,4);if(1===r){if(e===N)return v.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;e*=N+1,e+=readUint32(i,8)}const s=e/(a.timescale||9e4);if(h(s)&&(null===t||s<t))return s}return t}),null);return null!==n&&h(n)&&(null===t||n<t)?n:t}),null)}(g,u),y=null===p?r:p;(function isInvalidInitPts(e,t,s,i){if(null===e)return!0;const r=Math.max(i,1),n=t-e.baseTime/e.timescale;return Math.abs(n-s)>r}(l,y,r,m)||f.timescale!==l.timescale&&n)&&(f.initPTS=y-r,l&&1===l.timescale&&v.warn("Adjusting initPTS by "+(f.initPTS-l.baseTime)),this.initPTS=l={"baseTime":f.initPTS,"timescale":1});const T=e?y-l.baseTime/l.timescale:d,E=T+m;!function offsetStartDTS(e,t,s){findBox(t,["moof","traf"]).forEach((t=>{findBox(t,["tfhd"]).forEach((i=>{const r=readUint32(i,4),n=e[r];if(!n)return;const a=n.timescale||9e4;findBox(t,["tfdt"]).forEach((e=>{const t=e[0],i=s*a;if(i){let s=readUint32(e,4);if(0===t)s-=i,s=Math.max(s,0),writeUint32(e,4,s);else{s*=Math.pow(2,32),s+=readUint32(e,8),s-=i,s=Math.max(s,0);const t=Math.floor(s/(N+1)),r=Math.floor(s%(N+1));writeUint32(e,4,t),writeUint32(e,8,r)}}}))}))}))}(g,u,l.baseTime/l.timescale),m>0?this.lastEndTime=E:(v.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const S=!!g.audio,R=!!g.video;let b="";S&&(b+="audio"),R&&(b+="video");const k={"data1":u,"startPTS":T,"startDTS":T,"endPTS":E,"endDTS":E,"type":b,"hasAudio":S,"hasVideo":R,"nb":1,"dropped":0};return c.audio="audio"===k.type?k:void 0,c.video="audio"!==k.type?k:void 0,c.initSegment=f,c.id3=flushTextTrackMetadataCueSamples(s,r,l,l),i.samples.length&&(c.text=flushTextTrackUserdataCueSamples(i,r,l)),c}}},{"demux":TSDemuxer,"remux":MP4Remuxer},{"demux":class AACDemuxer extends BaseAudioDemuxer{"constructor"(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}"resetInitSegment"(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={"container":"audio/adts","type":"audio","id":2,"pid":-1,"sequenceNumber":0,"segmentCodec":"aac","samples":[],"manifestCodec":t,"duration":i,"inputTimeScale":9e4,"dropped":0}}static"probe"(e){if(!e)return!1;const t=getID3Data(e,0);let s=(null==t?void 0:t.length)||0;if(probe(e,s))return!1;for(let t=e.length;s<t;s++)if(probe$1(e,s))return v.log("ADTS sync word found !"),!0;return!1}"canParse"(e,t){return function canParse$1(e,t){return function canGetFrameLength(e,t){return t+5<e.length}(e,t)&&isHeaderPattern$1(e,t)&&getFullFrameLength(e,t)<=e.length-t}(e,t)}"appendFrame"(e,t,s){initTrackConfig(e,this.observer,t,s,e.manifestCodec);const i=appendFrame$2(e,t,s,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i}},"remux":MP4Remuxer},{"demux":class MP3Demuxer extends BaseAudioDemuxer{"resetInitSegment"(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={"container":"audio/mpeg","type":"audio","id":2,"pid":-1,"sequenceNumber":0,"segmentCodec":"mp3","samples":[],"manifestCodec":t,"duration":i,"inputTimeScale":9e4,"dropped":0}}static"probe"(e){if(!e)return!1;const t=getID3Data(e,0);let s=(null==t?void 0:t.length)||0;if(t&&11===e[s]&&119===e[s+1]&&void 0!==getTimeStamp(t)&&getAudioBSID(e,s)<=16)return!1;for(let t=e.length;s<t;s++)if(probe(e,s))return v.log("MPEG Audio sync word found !"),!0;return!1}"canParse"(e,t){return function canParse(e,t){return isHeaderPattern(e,t)&&4<=e.length-t}(e,t)}"appendFrame"(e,t,s){if(null!==this.basePTS)return appendFrame$1(e,t,s,this.basePTS,this.frameIndex)}},"remux":MP4Remuxer}];Qe.splice(2,0,{"demux":AC3Demuxer,"remux":MP4Remuxer});class Transmuxer{"constructor"(e,t,s,i,r){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.vendor=i,this.id=r}"configure"(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}"push"(e,t,s,i){const r=s.transmuxing;r.executeStart=qe();let n=new Uint8Array(e);const{"currentTransmuxState":a,"transmuxConfig":o}=this;i&&(this.currentTransmuxState=i);const{"contiguous":l,"discontinuity":d,"trackSwitch":h,"accurateTimeOffset":c,"timeOffset":u,"initSegmentChange":p}=i||a,{"audioCodec":y,"videoCodec":T,"defaultInitPts":E,"duration":S,"initSegmentData":L}=o,A=function getEncryptionType(e,t){let s=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(s=t);return s}(n,t);if(A&&"AES-128"===A.method){const e=this.getDecrypter();if(!e.isSync())return this.decryptionPromise=e.webCryptoDecrypt(n,A.key.buffer,A.iv.buffer).then((e=>{const t=this.push(e,null,s);return this.decryptionPromise=null,t})),this.decryptionPromise;{let t=e.softwareDecrypt(n,A.key.buffer,A.iv.buffer);if(s.part>-1&&(t=e.flush()),!t)return r.executeEnd=qe(),emptyResult(s);n=new Uint8Array(t)}}const R=this.needsProbing(d,h);if(R){const e=this.configureTransmuxer(n);if(e)return v.warn(`[transmuxer] ${e.message}`),this.observer.emit(f.ERROR,f.ERROR,{"type":g.MEDIA_ERROR,"details":m.FRAG_PARSING_ERROR,"fatal":!1,"error":e,"reason":e.message}),r.executeEnd=qe(),emptyResult(s)}(d||h||p||R)&&this.resetInitSegment(L,y,T,S,t),(d||p||R)&&this.resetInitialTimestamp(E),l||this.resetContiguity();const b=this.transmux(n,A,u,c,s),k=this.currentTransmuxState;return k.contiguous=!0,k.discontinuity=!1,k.trackSwitch=!1,r.executeEnd=qe(),b}"flush"(e){const t=e.transmuxing;t.executeStart=qe();const{"decrypter":s,"currentTransmuxState":i,"decryptionPromise":r}=this;if(r)return r.then((()=>this.flush(e)));const n=[],{"timeOffset":a}=i;if(s){const t=s.flush();t&&n.push(this.push(t,null,e))}const{"demuxer":o,"remuxer":l}=this;if(!o||!l)return t.executeEnd=qe(),[emptyResult(e)];const d=o.flush(a);return isPromise(d)?d.then((t=>(this.flushRemux(n,t,e),n))):(this.flushRemux(n,d,e),n)}"flushRemux"(e,t,s){const{"audioTrack":i,"videoTrack":r,"id3Track":n,"textTrack":a}=t,{"accurateTimeOffset":o,"timeOffset":l}=this.currentTransmuxState;v.log(`[transmuxer.ts]: Flushed fragment ${s.sn}${s.part>-1?" p: "+s.part:""} of level ${s.level}`);const d=this.remuxer.remux(i,r,n,a,l,o,!0,this.id);e.push({"remuxResult":d,"chunkMeta":s}),s.transmuxing.executeEnd=qe()}"resetInitialTimestamp"(e){const{"demuxer":t,"remuxer":s}=this;t&&s&&(t.resetTimeStamp(e),s.resetTimeStamp(e))}"resetContiguity"(){const{"demuxer":e,"remuxer":t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}"resetInitSegment"(e,t,s,i,r){const{"demuxer":n,"remuxer":a}=this;n&&a&&(n.resetInitSegment(e,t,s,i),a.resetInitSegment(e,t,s,r))}"destroy"(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}"transmux"(e,t,s,i,r){let n;return n=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,s,i,r):this.transmuxUnencrypted(e,s,i,r),n}"transmuxUnencrypted"(e,t,s,i){const{"audioTrack":r,"videoTrack":n,"id3Track":a,"textTrack":o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{"remuxResult":this.remuxer.remux(r,n,a,o,t,s,!1,this.id),"chunkMeta":i}}"transmuxSampleAes"(e,t,s,i,r){return this.demuxer.demuxSampleAes(e,t,s).then((e=>({"remuxResult":this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,s,i,!1,this.id),"chunkMeta":r})))}"configureTransmuxer"(e){const{"config":t,"observer":s,"typeSupported":i,"vendor":r}=this;let n;for(let t=0,s=Qe.length;t<s;t++){var a;if(null!=(a=Qe[t].demux)&&a.probe(e)){n=Qe[t];break}}if(!n)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,d=n.remux,h=n.demux;l&&l instanceof d||(this.remuxer=new d(s,t,i,r)),o&&o instanceof h||(this.demuxer=new h(s,t,i),this.probe=h.probe)}"needsProbing"(e,t){return!this.demuxer||!this.remuxer||e||t}"getDecrypter"(){let e=this.decrypter;return e||(e=this.decrypter=new Decrypter(this.config)),e}}const emptyResult=e=>({"remuxResult":{},"chunkMeta":e});function isPromise(e){return"then"in e&&e.then instanceof Function}class TransmuxConfig{"constructor"(e,t,s,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=i,this.defaultInitPts=r||null}}class TransmuxState{"constructor"(e,t,s,i,r,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=n}}var Je={"exports":{}};!function(e){var t=Object.prototype.hasOwnProperty,s="~";function Events(){}function EE(e,t,s){this.fn=e,this.context=t,this.once=s||!1}function addListener(e,t,i,r,n){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new EE(i,r||e,n),o=s?s+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],a]:e._events[o].push(a):(e._events[o]=a,e._eventsCount++),e}function clearEvent(e,t){0==--e._eventsCount?e._events=new Events:delete e._events[t]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(s=!1)),EventEmitter.prototype.eventNames=function eventNames(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(s?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},EventEmitter.prototype.listeners=function listeners(e){var t=s?s+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,n=i.length,a=new Array(n);r<n;r++)a[r]=i[r].fn;return a},EventEmitter.prototype.listenerCount=function listenerCount(e){var t=s?s+e:e,i=this._events[t];return i?i.fn?1:i.length:0},EventEmitter.prototype.emit=function emit(e,t,i,r,n,a){var o=s?s+e:e;if(!this._events[o])return!1;var l,d,h=this._events[o],c=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),c){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,i),!0;case 4:return h.fn.call(h.context,t,i,r),!0;case 5:return h.fn.call(h.context,t,i,r,n),!0;case 6:return h.fn.call(h.context,t,i,r,n,a),!0}for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=arguments[d];h.fn.apply(h.context,l)}else{var u,f=h.length;for(d=0;d<f;d++)switch(h[d].once&&this.removeListener(e,h[d].fn,void 0,!0),c){case 1:h[d].fn.call(h[d].context);break;case 2:h[d].fn.call(h[d].context,t);break;case 3:h[d].fn.call(h[d].context,t,i);break;case 4:h[d].fn.call(h[d].context,t,i,r);break;default:if(!l)for(u=1,l=new Array(c-1);u<c;u++)l[u-1]=arguments[u];h[d].fn.apply(h[d].context,l)}}return!0},EventEmitter.prototype.on=function on(e,t,s){return addListener(this,e,t,s,!1)},EventEmitter.prototype.once=function once(e,t,s){return addListener(this,e,t,s,!0)},EventEmitter.prototype.removeListener=function removeListener(e,t,i,r){var n=s?s+e:e;if(!this._events[n])return this;if(!t)return clearEvent(this,n),this;var a=this._events[n];if(a.fn)a.fn!==t||r&&!a.once||i&&a.context!==i||clearEvent(this,n);else{for(var o=0,l=[],d=a.length;o<d;o++)(a[o].fn!==t||r&&!a[o].once||i&&a[o].context!==i)&&l.push(a[o]);l.length?this._events[n]=1===l.length?l[0]:l:clearEvent(this,n)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(e){var t;return e?(t=s?s+e:e,this._events[t]&&clearEvent(this,t)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=s,EventEmitter.EventEmitter=EventEmitter,e.exports=EventEmitter}(Je);var Ze=getDefaultExportFromCjs(Je.exports);class TransmuxerInterface{"constructor"(e,t,s,i){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=i;const forwardMessage=(e,t)=>{(t=t||{}).frag=this.frag,t.id=this.id,e===f.ERROR&&(this.error=t.error),this.hls.trigger(e,t)};this.observer=new Ze,this.observer.on(f.FRAG_DECRYPTED,forwardMessage),this.observer.on(f.ERROR,forwardMessage);const n=getMediaSource(r.preferManagedMediaSource)||{"isTypeSupported":()=>!1},a={"mpeg":n.isTypeSupported("audio/mpeg"),"mp3":n.isTypeSupported('audio/mp4; codecs="mp3"'),"ac3":n.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&"undefined"!=typeof Worker){if(r.workerPath||function hasUMDWorker(){return"function"==typeof __HLS_WORKER_BUNDLE__}()){try{r.workerPath?(v.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=function loadWorker(e){const t=new self.URL(e,self.location.href).href;return{"worker":new self.Worker(t),"scriptURL":t}}(r.workerPath)):(v.log(`injecting Web Worker for "${t}"`),this.workerContext=function injectWorker(){const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{"type":"text/javascript"}),t=self.URL.createObjectURL(e);return{"worker":new self.Worker(t),"objectURL":t}}()),this.onwmsg=e=>this.onWorkerMessage(e);const{"worker":e}=this.workerContext;e.addEventListener("message",this.onwmsg),e.onerror=e=>{const s=new Error(`${e.message}  (${e.filename}:${e.lineno})`);r.enableWorker=!1,v.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(f.ERROR,{"type":g.OTHER_ERROR,"details":m.INTERNAL_EXCEPTION,"fatal":!1,"event":"demuxerWorker","error":s})},e.postMessage({"cmd":"init","typeSupported":a,"vendor":"","id":t,"config":JSON.stringify(r)})}catch(e){v.warn(`Error setting up "${t}" Web Worker, fallback to inline`,e),this.resetWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,a,r,"",t)}return}}this.transmuxer=new Transmuxer(this.observer,a,r,"",t)}"resetWorker"(){if(this.workerContext){const{"worker":e,"objectURL":t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}"destroy"(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}"push"(e,t,s,i,r,n,a,o,l,d){var h,c;l.transmuxing.start=self.performance.now();const{"transmuxer":u}=this,f=n?n.start:r.start,g=r.decryptdata,m=this.frag,p=!(m&&r.cc===m.cc),y=!(m&&l.level===m.level),T=m?l.sn-m.sn:-1,E=this.part?l.part-this.part.index:-1,S=0===T&&l.id>1&&l.id===(null==m?void 0:m.stats.chunkCount),L=!y&&(1===T||0===T&&(1===E||S&&E<=0)),A=self.performance.now();(y||T||0===r.stats.parsing.start)&&(r.stats.parsing.start=A),!n||!E&&L||(n.stats.parsing.start=A);const R=!(m&&(null==(h=r.initSegment)?void 0:h.url)===(null==(c=m.initSegment)?void 0:c.url)),b=new TransmuxState(p,L,o,y,f,R);if(!L||p||R){v.log(`[transmuxer-interface, ${r.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}\n        discontinuity: ${p}\n        trackSwitch: ${y}\n        contiguous: ${L}\n        accurateTimeOffset: ${o}\n        timeOffset: ${f}\n        initSegmentChange: ${R}`);const e=new TransmuxConfig(s,i,t,a,d);this.configureTransmuxer(e)}if(this.frag=r,this.part=n,this.workerContext)this.workerContext.worker.postMessage({"cmd":"demux","data":e,"decryptdata":g,"chunkMeta":l,"state":b},e instanceof ArrayBuffer?[e]:[]);else if(u){const t=u.push(e,g,l,b);isPromise(t)?(u.async=!0,t.then((e=>{this.handleTransmuxComplete(e)})).catch((e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}))):(u.async=!1,this.handleTransmuxComplete(t))}}"flush"(e){e.transmuxing.start=self.performance.now();const{"transmuxer":t}=this;if(this.workerContext)this.workerContext.worker.postMessage({"cmd":"flush","chunkMeta":e});else if(t){let s=t.flush(e);isPromise(s)||t.async?(isPromise(s)||(s=Promise.resolve(s)),s.then((t=>{this.handleFlushResult(t,e)})).catch((t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}))):this.handleFlushResult(s,e)}}"transmuxerError"(e,t,s){this.hls&&(this.error=e,this.hls.trigger(f.ERROR,{"type":g.MEDIA_ERROR,"details":m.FRAG_PARSING_ERROR,"chunkMeta":t,"frag":this.frag||void 0,"fatal":!1,"error":e,"err":e,"reason":s}))}"handleFlushResult"(e,t){e.forEach((e=>{this.handleTransmuxComplete(e)})),this.onFlush(t)}"onWorkerMessage"(e){const t=e.data;if(null==t||!t.event)return void v.warn("worker message received with no "+(t?"event name":"data"));const s=this.hls;if(this.hls)switch(t.event){case"init":{var i;const e=null==(i=this.workerContext)?void 0:i.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":v[t.data.logType]&&v[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,s.trigger(t.event,t.data)}}"configureTransmuxer"(e){const{"transmuxer":t}=this;this.workerContext?this.workerContext.worker.postMessage({"cmd":"configure","config":e}):t&&t.configure(e)}"handleTransmuxComplete"(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}function subtitleOptionsIdentical(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!mediaAttributesIdentical(e[s].attrs,t[s].attrs))return!1;return!0}function mediaAttributesIdentical(e,t,s){const i=e["STABLE-RENDITION-ID"];return i&&!s?i===t["STABLE-RENDITION-ID"]:!(s||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some((s=>e[s]!==t[s]))}function subtitleTrackMatchesTextTrack(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class BufferableInstance{"constructor"(e){this.buffered=void 0;const getRange=(t,s,i)=>{if((s>>>=0)>i-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][t]};this.buffered={get"length"(){return e.length},"end"(t){return getRange("end",t,e.length)},"start"(t){return getRange("start",t,e.length)}}}}class BufferOperationQueue{"constructor"(e){this.buffers=void 0,this.queues={"video":[],"audio":[],"audiovideo":[]},this.buffers=e}"append"(e,t,s){const i=this.queues[t];i.push(e),1!==i.length||s||this.executeNext(t)}"insertAbort"(e,t){this.queues[t].unshift(e),this.executeNext(t)}"appendBlocker"(e){let t;const s=new Promise((e=>{t=e})),i={"execute":t,"onStart":()=>{},"onComplete":()=>{},"onError":()=>{}};return this.append(i,e),s}"executeNext"(e){const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(t){v.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${t}`),s.onError(t);const i=this.buffers[e];null!=i&&i.updating||this.shiftAndExecuteNext(e)}}}"shiftAndExecuteNext"(e){this.queues[e].shift(),this.executeNext(e)}"current"(e){return this.queues[e][0]}}const et=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;function removeSourceChildren(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach((t=>{e.removeChild(t)}))}const tt={"42":225,"92":233,"94":237,"95":243,"96":250,"123":231,"124":247,"125":209,"126":241,"127":9608,"128":174,"129":176,"130":189,"131":191,"132":8482,"133":162,"134":163,"135":9834,"136":224,"137":32,"138":232,"139":226,"140":234,"141":238,"142":244,"143":251,"144":193,"145":201,"146":211,"147":218,"148":220,"149":252,"150":8216,"151":161,"152":42,"153":8217,"154":9473,"155":169,"156":8480,"157":8226,"158":8220,"159":8221,"160":192,"161":194,"162":199,"163":200,"164":202,"165":203,"166":235,"167":206,"168":207,"169":239,"170":212,"171":217,"172":249,"173":219,"174":171,"175":187,"176":195,"177":227,"178":205,"179":204,"180":236,"181":210,"182":242,"183":213,"184":245,"185":123,"186":125,"187":92,"188":94,"189":95,"190":124,"191":8764,"192":196,"193":228,"194":214,"195":246,"196":223,"197":165,"198":164,"199":9475,"200":197,"201":229,"202":216,"203":248,"204":9487,"205":9491,"206":9495,"207":9499},getCharForByte=e=>String.fromCharCode(tt[e]||e),st=15,it=100,rt={"17":1,"18":3,"21":5,"22":7,"23":9,"16":11,"19":12,"20":14},nt={"17":2,"18":4,"21":6,"22":8,"23":10,"19":13,"20":15},at={"25":1,"26":3,"29":5,"30":7,"31":9,"24":11,"27":12,"28":14},ot={"25":2,"26":4,"29":6,"30":8,"31":10,"27":13,"28":15},lt=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CaptionsLogger{"constructor"(){this.time=null,this.verboseLevel=0}"log"(e,t){if(this.verboseLevel>=e){const s="function"==typeof t?t():t;v.log(`${this.time} [${e}] ${s}`)}}}const dt=function numArrayToHexArray(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class PenState{"constructor"(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}"reset"(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}"setStyles"(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const i=t[s];e.hasOwnProperty(i)&&(this[i]=e[i])}}"isDefault"(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}"equals"(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}"copy"(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}"toString"(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class StyledUnicodeChar{"constructor"(){this.uchar=" ",this.penState=new PenState}"reset"(){this.uchar=" ",this.penState.reset()}"setChar"(e,t){this.uchar=e,this.penState.copy(t)}"setPenState"(e){this.penState.copy(e)}"equals"(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}"copy"(e){this.uchar=e.uchar,this.penState.copy(e.penState)}"isEmpty"(){return" "===this.uchar&&this.penState.isDefault()}}class Row{"constructor"(e){this.chars=[],this.pos=0,this.currPenState=new PenState,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<it;e++)this.chars.push(new StyledUnicodeChar);this.logger=e}"equals"(e){for(let t=0;t<it;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}"copy"(e){for(let t=0;t<it;t++)this.chars[t].copy(e.chars[t])}"isEmpty"(){let e=!0;for(let t=0;t<it;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}"setCursor"(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>it&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=it)}"moveCursor"(e){const t=this.pos+e;if(e>1)for(let e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)}"backSpace"(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}"insertChar"(e){e>=144&&this.backSpace();const t=getCharForByte(e);this.pos>=it?this.logger.log(0,(()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!")):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}"clearFromPos"(e){let t;for(t=e;t<it;t++)this.chars[t].reset()}"clear"(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}"clearToEndOfRow"(){this.clearFromPos(this.pos)}"getTextString"(){const e=[];let t=!0;for(let s=0;s<it;s++){const i=this.chars[s].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}"setPenStyles"(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class CaptionScreen{"constructor"(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<st;t++)this.rows.push(new Row(e));this.logger=e}"reset"(){for(let e=0;e<st;e++)this.rows[e].clear();this.currRow=14}"equals"(e){let t=!0;for(let s=0;s<st;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}"copy"(e){for(let t=0;t<st;t++)this.rows[t].copy(e.rows[t])}"isEmpty"(){let e=!0;for(let t=0;t<st;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}"backSpace"(){this.rows[this.currRow].backSpace()}"clearToEndOfRow"(){this.rows[this.currRow].clearToEndOfRow()}"insertChar"(e){this.rows[this.currRow].insertChar(e)}"setPen"(e){this.rows[this.currRow].setPenStyles(e)}"moveCursor"(e){this.rows[this.currRow].moveCursor(e)}"setCursor"(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}"setPAC"(e){this.logger.log(2,(()=>"pacData = "+JSON.stringify(e)));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let e=0;e<st;e++)this.rows[e].clear();const e=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){const i=s.rows[e].cueStartTime,r=this.logger.time;if(null!==i&&null!==r&&i<r)for(let i=0;i<this.nrRollUpRows;i++)this.rows[t-this.nrRollUpRows+i+1].copy(s.rows[e+i])}}this.currRow=t;const s=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,i=Math.max(t-1,0);s.setCursor(e.indent),e.color=s.chars[i].penState.foreground}const i={"foreground":e.color,"underline":e.underline,"italics":e.italics,"background":"black","flash":!1};this.setPen(i)}"setBkgData"(e){this.logger.log(2,(()=>"bkgData = "+JSON.stringify(e))),this.backSpace(),this.setPen(e),this.insertChar(32)}"setRollUpRows"(e){this.nrRollUpRows=e}"rollUp"(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,(()=>this.getDisplayText()));const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}"getDisplayText"(e){e=e||!1;const t=[];let s="",i=-1;for(let s=0;s<st;s++){const r=this.rows[s].getTextString();r&&(i=s+1,e?t.push("Row "+i+": '"+r+"'"):t.push(r.trim()))}return t.length>0&&(s=e?"["+t.join(" | ")+"]":t.join("\n")),s}"getTextAndFormat"(){return this.rows}}class Cea608Channel{"constructor"(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(s),this.nonDisplayedMemory=new CaptionScreen(s),this.lastOutputScreen=new CaptionScreen(s),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}"reset"(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}"getHandler"(){return this.outputFilter}"setHandler"(e){this.outputFilter=e}"setPAC"(e){this.writeScreen.setPAC(e)}"setBkgData"(e){this.writeScreen.setBkgData(e)}"setMode"(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(()=>"MODE="+e)),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}"insertChars"(e){for(let t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(()=>t+": "+this.writeScreen.getDisplayText(!0))),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0))),this.outputDataUpdate())}"ccRCL"(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}"ccBS"(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}"ccAOF"(){}"ccAON"(){}"ccDER"(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}"ccRU"(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}"ccFON"(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({"flash":!0})}"ccRDC"(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}"ccTR"(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}"ccRTD"(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}"ccEDM"(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}"ccCR"(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}"ccENM"(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}"ccEOC"(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(()=>"DISP: "+this.displayedMemory.getDisplayText()))}this.outputDataUpdate(!0)}"ccTO"(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}"ccMIDROW"(e){const t={"flash":!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[s]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}"outputDataUpdate"(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}"cueSplitAtTime"(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Cea608Parser{"constructor"(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory={"a":null,"b":null},this.logger=void 0;const i=this.logger=new CaptionsLogger;this.channels=[null,new Cea608Channel(e,t,i),new Cea608Channel(e+1,s,i)]}"getHandler"(e){return this.channels[e].getHandler()}"setHandler"(e,t){this.channels[e].setHandler(t)}"addData"(e,t){this.logger.time=e;for(let e=0;e<t.length;e+=2){const s=127&t[e],i=127&t[e+1];let r=!1,n=null;if(0===s&&0===i)continue;this.logger.log(3,(()=>"["+dt([t[e],t[e+1]])+"] -> ("+dt([s,i])+")"));const a=this.cmdHistory;if(s>=16&&s<=31){if(hasCmdRepeated(s,i,a)){setLastCmd(null,null,a),this.logger.log(3,(()=>"Repeated command ("+dt([s,i])+") is dropped"));continue}setLastCmd(s,i,this.cmdHistory),r=this.parseCmd(s,i),r||(r=this.parseMidrow(s,i)),r||(r=this.parsePAC(s,i)),r||(r=this.parseBackgroundAttributes(s,i))}else setLastCmd(null,null,a);if(!r&&(n=this.parseChars(s,i),n)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(n)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||n||this.logger.log(2,(()=>"Couldn't parse cleaned data "+dt([s,i])+" orig: "+dt([t[e],t[e+1]])))}}"parseCmd"(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const s=20===e||21===e||23===e?1:2,i=this.channels[s];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),this.currentChannel=s,!0}"parseMidrow"(e,t){let s=0;if((17===e||25===e)&&t>=32&&t<=47){if(s=17===e?1:2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[s];return!!i&&(i.ccMIDROW(t),this.logger.log(3,(()=>"MIDROW ("+dt([e,t])+")")),!0)}return!1}"parsePAC"(e,t){let s;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const i=e<=23?1:2;s=t>=64&&t<=95?1===i?rt[e]:at[e]:1===i?nt[e]:ot[e];const r=this.channels[i];return!!r&&(r.setPAC(this.interpretPAC(s,t)),this.currentChannel=i,!0)}"interpretPAC"(e,t){let s;const i={"color":null,"italics":!1,"indent":null,"underline":!1,"row":e};return s=t>95?t-96:t-64,i.underline=!(1&~s),s<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((s-16)/2),i}"parseChars"(e,t){let s,i=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let e;e=17===r?t+80:18===r?t+112:t+144,this.logger.log(2,(()=>"Special char '"+getCharForByte(e)+"' in channel "+s)),i=[e]}else e>=32&&e<=127&&(i=0===t?[e]:[e,t]);return i&&this.logger.log(3,(()=>"Char codes =  "+dt(i).join(","))),i}"parseBackgroundAttributes"(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let s;const i={};16===e||24===e?(s=Math.floor((t-32)/2),i.background=lt[s],t%2==1&&(i.background=i.background+"_semi")):45===t?i.background="transparent":(i.foreground="black",47===t&&(i.underline=!0));const r=e<=23?1:2;return this.channels[r].setBkgData(i),!0}"reset"(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}setLastCmd(null,null,this.cmdHistory)}"cueSplitAtTime"(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function setLastCmd(e,t,s){s.a=e,s.b=t}function hasCmdRepeated(e,t,s){return s.a===e&&s.b===t}class OutputFilter{"constructor"(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}"dispatchCue"(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}"newCue"(e,t,s){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}"reset"(){this.cueRanges=[],this.startTime=null}}var ht=function(){if(null!=b&&b.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function isAllowedValue(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const s=t.toLowerCase();return!!~e.indexOf(s)&&s}function findAlignSetting(e){return isAllowedValue(t,e)}function extend(e,...t){let s=1;for(;s<arguments.length;s++){const t=arguments[s];for(const s in t)e[s]=t[s]}return e}function VTTCue(t,s,i){const r=this,n={"enumerable":!0};r.hasBeenReset=!1;let a="",o=!1,l=t,d=s,h=i,c=null,u="",f=!0,g="auto",m="start",p=50,y="middle",T=50,v="middle";Object.defineProperty(r,"id",extend({},n,{"get":function(){return a},"set":function(e){a=""+e}})),Object.defineProperty(r,"pauseOnExit",extend({},n,{"get":function(){return o},"set":function(e){o=!!e}})),Object.defineProperty(r,"startTime",extend({},n,{"get":function(){return l},"set":function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");l=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"endTime",extend({},n,{"get":function(){return d},"set":function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"text",extend({},n,{"get":function(){return h},"set":function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(r,"region",extend({},n,{"get":function(){return c},"set":function(e){c=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"vertical",extend({},n,{"get":function(){return u},"set":function(t){const s=function findDirectionSetting(t){return isAllowedValue(e,t)}(t);if(!1===s)throw new SyntaxError("An invalid or illegal string was specified.");u=s,this.hasBeenReset=!0}})),Object.defineProperty(r,"snapToLines",extend({},n,{"get":function(){return f},"set":function(e){f=!!e,this.hasBeenReset=!0}})),Object.defineProperty(r,"line",extend({},n,{"get":function(){return g},"set":function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"lineAlign",extend({},n,{"get":function(){return m},"set":function(e){const t=findAlignSetting(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"position",extend({},n,{"get":function(){return p},"set":function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");p=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"positionAlign",extend({},n,{"get":function(){return y},"set":function(e){const t=findAlignSetting(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(r,"size",extend({},n,{"get":function(){return T},"set":function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");T=e,this.hasBeenReset=!0}})),Object.defineProperty(r,"align",extend({},n,{"get":function(){return v},"set":function(e){const t=findAlignSetting(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),r.displayState=void 0}return VTTCue.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},VTTCue}();class StringDecoder{"decode"(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function parseTimeStamp(e){function computeSeconds(e,t,s,i){return 3600*(0|e)+60*(0|t)+(0|s)+parseFloat(i||0)}const t=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?computeSeconds(t[2],t[3],0,t[4]):computeSeconds(t[1],t[2],t[3],t[4]):null}class Settings{"constructor"(){this.values=Object.create(null)}"set"(e,t){this.get(e)||""===t||(this.values[e]=t)}"get"(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}"has"(e){return e in this.values}"alt"(e,t,s){for(let i=0;i<s.length;++i)if(t===s[i]){this.set(e,t);break}}"integer"(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}"percent"(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function parseOptions(e,t,s,i){const r=i?e.split(i):[e];for(const e in r){if("string"!=typeof r[e])continue;const i=r[e].split(s);if(2!==i.length)continue;t(i[0],i[1])}}const ct=new ht(0,0,""),ut="middle"===ct.align?"middle":"center";function parseCue(e,t,s){const i=e;function consumeTimeStamp(){const t=parseTimeStamp(e);if(null===t)throw new Error("Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function skipWhitespace(){e=e.replace(/^\s+/,"")}if(skipWhitespace(),t.startTime=consumeTimeStamp(),skipWhitespace(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.slice(3),skipWhitespace(),t.endTime=consumeTimeStamp(),skipWhitespace(),function consumeCueSettings(e,t){const i=new Settings;parseOptions(e,(function(e,t){let r;switch(e){case"region":for(let r=s.length-1;r>=0;r--)if(s[r].id===t){i.set(e,s[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),i.integer(e,r[0]),i.percent(e,r[0])&&i.set("snapToLines",!1),i.alt(e,r[0],["auto"]),2===r.length&&i.alt("lineAlign",r[1],["start",ut,"end"]);break;case"position":r=t.split(","),i.percent(e,r[0]),2===r.length&&i.alt("positionAlign",r[1],["start",ut,"end","line-left","line-right","auto"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start",ut,"end","left","right"])}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical","");let r=i.get("line","auto");"auto"===r&&-1===ct.line&&(r=-1),t.line=r,t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align",ut);let n=i.get("position","auto");"auto"===n&&50===ct.position&&(n="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=n}(e,t)}function fixLineBreaks(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class VTTParser{"constructor"(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}"parse"(e){const t=this;function collectNextLine(){let e=t.buffer,s=0;for(e=fixLineBreaks(e);s<e.length&&"\r"!==e[s]&&"\n"!==e[s];)++s;const i=e.slice(0,s);return"\r"===e[s]&&++s,"\n"===e[s]&&++s,t.buffer=e.slice(s),i}e&&(t.buffer+=t.decoder.decode(e,{"stream":!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=collectNextLine();const s=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==s||!s[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let s=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:e=collectNextLine(),t.state){case"HEADER":/:/.test(e)?parseOptions(e,(function(e,t){}),/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new ht(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{parseCue(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const i=-1!==e.indexOf("--\x3e");if(!e||i&&(s=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}"flush"(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const ft=/\r\n|\n\r|\n|\r/g,gt=function startsWith(e,t,s=0){return e.slice(s,s+t.length)===t},mt=function hash(e){let t=5381,s=e.length;for(;s;)t=33*t^e.charCodeAt(--s);return(t>>>0).toString()};function generateCueId(e,t,s){return mt(e.toString())+mt(t.toString())+mt(s)}function parseWebVTT(e,t,s,i,r,n,a){const o=new VTTParser,l=utf8ArrayToStr(new Uint8Array(e)).trim().replace(ft,"\n").split("\n"),d=[],c=t?function toMpegTsClockFromTimescale(e,t=1){return toTimescaleFromBase(e,9e4,1/t)}(t.baseTime,t.timescale):0;let u,f="00:00.000",g=0,m=0,p=!0;o.oncue=function(e){const n=s[i];let a=s.ccOffset;const o=(g-c)/9e4;if(null!=n&&n.new&&(void 0!==m?a=s.ccOffset=n.start:function calculateOffset(e,t,s){let i=e[t],r=e[i.prevCC];if(!r||!r.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;null!=(n=r)&&n.new;){var n;e.ccOffset+=i.start-r.start,i.new=!1,i=r,r=e[i.prevCC]}e.presentationOffset=s}(s,i,o)),o){if(!t)return void(u=new Error("Missing initPTS for VTT MPEGTS"));a=o-s.presentationOffset}const l=e.endTime-e.startTime,h=normalizePts(9e4*(e.startTime+a-m),9e4*r)/9e4;e.startTime=Math.max(h,0),e.endTime=Math.max(h+l,0);const f=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(f)),e.id||(e.id=generateCueId(e.startTime,e.endTime,f)),e.endTime>0&&d.push(e)},o.onparsingerror=function(e){u=e},o.onflush=function(){u?a(u):n(d)},l.forEach((e=>{if(p){if(gt(e,"X-TIMESTAMP-MAP=")){p=!1,e.slice(16).split(",").forEach((e=>{gt(e,"LOCAL:")?f=e.slice(6):gt(e,"MPEGTS:")&&(g=parseInt(e.slice(7)))}));try{m=function cueString2millis(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(h(t)&&h(s)&&h(i)&&h(r)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=6e4*i,t+=36e5*r,t}(f)/1e3}catch(e){u=e}return}""===e&&(p=!1)}o.parse(e+"\n")})),o.flush()}const pt="stpp.ttml.im1t",yt=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Tt=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,vt={"left":"start","center":"center","right":"end","start":"start","end":"end"};function parseIMSC1(e,t,s,i){const r=findBox(new Uint8Array(e),["mdat"]);if(0===r.length)return void i(new Error("Could not parse IMSC1 mdat"));const n=r.map((e=>utf8ArrayToStr(e))),a=function toTimescaleFromScale(e,t,s=1,i=!1){return toTimescaleFromBase(e,t,1/s,i)}(t.baseTime,1,t.timescale);try{n.forEach((e=>s(function parseTTML(e,t){const s=(new DOMParser).parseFromString(e,"text/xml"),i=s.getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const r={"frameRate":30,"subFrameRate":1,"frameRateMultiplier":0,"tickRate":0},n=Object.keys(r).reduce(((e,t)=>(e[t]=i.getAttribute(`ttp:${t}`)||r[t],e)),{}),a="preserve"!==i.getAttribute("xml:space"),o=collectionToDictionary(getElementCollection(i,"styling","style")),l=collectionToDictionary(getElementCollection(i,"layout","region")),d=getElementCollection(i,"body","[begin]");return[].map.call(d,(e=>{const s=getTextContent(e,a);if(!s||!e.hasAttribute("begin"))return null;const i=parseTtmlTime(e.getAttribute("begin"),n),r=parseTtmlTime(e.getAttribute("dur"),n);let d=parseTtmlTime(e.getAttribute("end"),n);if(null===i)throw timestampParsingError(e);if(null===d){if(null===r)throw timestampParsingError(e);d=i+r}const h=new ht(i-t,d-t,s);h.id=generateCueId(h.startTime,h.endTime,h.text);const c=function getTtmlStyles(e,t,s){const i="http://www.w3.org/ns/ttml#styling";let r=null;const n=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&s.hasOwnProperty(a)&&(r=s[a]);return n.reduce(((s,n)=>{const a=getAttributeNS(t,i,n)||getAttributeNS(e,i,n)||getAttributeNS(r,i,n);return a&&(s[n]=a),s}),{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{"textAlign":u}=c;if(u){const e=vt[u];e&&(h.lineAlign=e),h.align=u}return _extends(h,c),h})).filter((e=>null!==e))}(e,a))))}catch(e){i(e)}}function getElementCollection(e,t,s){const i=e.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(s)):[]}function collectionToDictionary(e){return e.reduce(((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e}),{})}function getTextContent(e,t){return[].slice.call(e.childNodes).reduce(((e,s,i)=>{var r;return"br"===s.nodeName&&i?e+"\n":null!=(r=s.childNodes)&&r.length?getTextContent(s,t):t?e+s.textContent.trim().replace(/\s+/g," "):e+s.textContent}),"")}function getAttributeNS(e,t,s){return e&&e.hasAttributeNS(t,s)?e.getAttributeNS(t,s):null}function timestampParsingError(e){return new Error(`Could not parse ttml timestamp ${e}`)}function parseTtmlTime(e,t){if(!e)return null;let s=parseTimeStamp(e);return null===s&&(yt.test(e)?s=function parseHoursMinutesSecondsFrames(e,t){const s=yt.exec(e),i=(0|s[4])+(0|s[5])/t.subFrameRate;return 3600*(0|s[1])+60*(0|s[2])+(0|s[3])+i/t.frameRate}(e,t):Tt.test(e)&&(s=function parseTimeUnits(e,t){const s=Tt.exec(e),i=Number(s[1]);switch(s[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}(e,t))),s}function captionsOrSubtitlesFromCharacteristics(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function canReuseVttTextTrack(e,t){return!!e&&e.kind===captionsOrSubtitlesFromCharacteristics(t)&&subtitleTrackMatchesTextTrack(t,e)}class CapLevelController{"constructor"(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}"setStreamController"(e){this.streamController=e}"destroy"(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}"registerListeners"(){const{"hls":e}=this;e.on(f.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(f.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(f.MANIFEST_PARSED,this.onManifestParsed,this),e.on(f.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(f.BUFFER_CODECS,this.onBufferCodecs,this),e.on(f.MEDIA_DETACHING,this.onMediaDetaching,this)}"unregisterListener"(){const{"hls":e}=this;e.off(f.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(f.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(f.MANIFEST_PARSED,this.onManifestParsed,this),e.off(f.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(f.BUFFER_CODECS,this.onBufferCodecs,this),e.off(f.MEDIA_DETACHING,this.onMediaDetaching,this)}"onFpsDropLevelCapping"(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({"bitrate":s.bitrate,"height":s.height,"width":s.width})}"onMediaAttaching"(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}"onManifestParsed"(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}"onLevelsUpdated"(e,t){this.timer&&h(this.autoLevelCapping)&&this.detectPlayerSize()}"onBufferCodecs"(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}"onMediaDetaching"(){this.stopCapping()}"detectPlayerSize"(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&v.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}"getMaxLevel"(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter(((t,s)=>this.isLevelAllowed(t)&&s<=e));return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}"startCapping"(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}"stopCapping"(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}"getDimensions"(){if(this.clientRect)return this.clientRect;const e=this.media,t={"width":0,"height":0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,t.width||t.height||(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get"mediaWidth"(){return this.getDimensions().width*this.contentScaleFactor}get"mediaHeight"(){return this.getDimensions().height*this.contentScaleFactor}get"contentScaleFactor"(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}"isLevelAllowed"(e){return!this.restrictedLevels.some((t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height))}static"getMaxLevelByMediaSize"(e,t,s){if(null==e||!e.length)return-1;let i=e.length-1;const r=Math.max(t,s);for(let t=0;t<e.length;t+=1){const s=e[t];if((s.width>=r||s.height>=r)&&(n=s,!(a=e[t+1])||n.width!==a.width||n.height!==a.height)){i=t;break}}var n,a;return i}}const Et="[eme]";class EMEController{"constructor"(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.debug=v.debug.bind(v,Et),this.log=v.log.bind(v,Et),this.warn=v.warn.bind(v,Et),this.error=v.error.bind(v,Et),this.onMediaEncrypted=e=>{const{"initDataType":t,"initData":s}=e,i=`"${e.type}" event: init data type: "${t}"`;if(this.debug(i),null!==s){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=getKeySystemsForConfig(this.config));const t=e.map(keySystemDomainToKeySystemFormat).filter((e=>!!e));this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then((r=>{const n=keySystemFormatToKeySystemDomain(r);let a,o;if("sinf"===t){if(n!==k.FAIRPLAY)return void this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${t}" for selected key-system ${n}`);const r=bin2str(new Uint8Array(s));try{const e=parseSinf(base64Decode(JSON.parse(r).sinf));if(!e)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=e.subarray(8,24),o=k.FAIRPLAY}catch(e){return void this.warn(`${i} Failed to parse sinf: ${e}`)}}else{if(n!==k.WIDEVINE&&n!==k.PLAYREADY)return void this.warn(`Ignoring unexpected "${e.type}" event with init data type: "${t}" for selected key-system ${n}`);const r=function parseMultiPssh(e){const t=[];if(e instanceof ArrayBuffer){const s=e.byteLength;let i=0;for(;i+32<s;){const s=parsePssh(new DataView(e,i));t.push(s),i+=s.size}}return t}(s),l=r.filter((e=>!!e.systemId&&keySystemIdToKeySystemDomain(e.systemId)===n));l.length>1&&this.warn(`${i} Using first of ${l.length} pssh found for selected key-system ${n}`);const d=l[0];if(!d)return void(0===r.length||r.some((e=>!e.systemId))?this.warn(`${i} contains incomplete or invalid pssh data`):this.log(`ignoring ${i} for ${r.map((e=>keySystemIdToKeySystemDomain(e.systemId))).join(",")} pssh data in favor of playlist keys`));if(o=keySystemIdToKeySystemDomain(d.systemId),0===d.version&&d.data)if(o===k.WIDEVINE){const e=d.data.length-22;a=d.data.subarray(e,e+16)}else o===k.PLAYREADY&&(a=parsePlayReadyWRM(d.data))}if(!o||!a)return void this.log(`Unable to handle ${i} with key-system ${n}`);const l=Hex_hexDump(a),{"keyIdToKeySessionPromise":d,"mediaKeySessions":h}=this;let c=d[l];for(let e=0;e<h.length;e++){const i=h[e],r=i.decryptdata;if(!r.keyId)continue;const n=Hex_hexDump(r.keyId);if(l===n||-1!==r.uri.replace(/-/g,"").indexOf(l)){if(c=d[n],r.pssh)break;delete d[n],r.pssh=new Uint8Array(s),r.keyId=a,c=d[l]=c.then((()=>this.generateRequestWithPreferredKeySession(i,t,s,"encrypted-event-key-match"))),c.catch((e=>this.handleError(e)));break}}if(!c){if(o!==n)return void this.log(`Ignoring "${i}" with ${o} init data for selected key-system ${n}`);c=d[l]=this.getKeySystemSelectionPromise([o]).then((({"keySystem":e,"mediaKeys":i})=>{var r;this.throwIfDestroyed();const n=new LevelKey("ISO-23001-7",l,null!=(r=keySystemDomainToKeySystemFormat(e))?r:"");return n.pssh=new Uint8Array(s),n.keyId=a,this.attemptSetMediaKeys(e,i).then((()=>{this.throwIfDestroyed();const r=this.createMediaKeySessionContext({"decryptdata":n,"keySystem":e,"mediaKeys":i});return this.generateRequestWithPreferredKeySession(r,t,s,"encrypted-event-no-match")}))})),c.catch((e=>this.handleError(e)))}}))}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}"destroy"(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}"registerListeners"(){this.hls.on(f.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(f.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(f.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(f.MANIFEST_LOADED,this.onManifestLoaded,this)}"unregisterListeners"(){this.hls.off(f.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(f.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(f.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(f.MANIFEST_LOADED,this.onManifestLoaded,this)}"getLicenseServerUrl"(e){const{"drmSystems":t,"widevineLicenseUrl":s}=this.config,i=t[e];return i?i.licenseUrl:e===k.WIDEVINE&&s?s:void 0}"getLicenseServerUrlOrThrow"(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error(`no license server URL configured for key-system "${e}"`);return t}"getServerCertificateUrl"(e){const{"drmSystems":t}=this.config,s=t[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}"attemptKeySystemAccess"(e){const t=this.hls.levels,uniqueCodec=(e,t,s)=>!!e&&s.indexOf(e)===t,s=t.map((e=>e.audioCodec)).filter(uniqueCodec),i=t.map((e=>e.videoCodec)).filter(uniqueCodec);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise(((t,r)=>{const attempt=e=>{const n=e.shift();this.getMediaKeysPromise(n,s,i).then((e=>t({"keySystem":n,"mediaKeys":e}))).catch((t=>{e.length?attempt(e):r(t instanceof EMEKeyError?t:new EMEKeyError({"type":g.KEY_SYSTEM_ERROR,"details":m.KEY_SYSTEM_NO_ACCESS,"error":t,"fatal":!0},t.message))}))};attempt(e)}))}"requestMediaKeySystemAccess"(e,t){const{"requestMediaKeySystemAccessFunc":s}=this.config;if("function"!=typeof s){let e=`Configured requestMediaKeySystemAccess is not a function ${s}`;return null===F&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return s(e,t)}"getMediaKeysPromise"(e,t,s){const i=function getSupportedMediaKeySystemConfigurations(e,t,s,i){let r;switch(e){case k.FAIRPLAY:r=["cenc","sinf"];break;case k.WIDEVINE:case k.PLAYREADY:r=["cenc"];break;case k.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function createMediaKeySystemConfigurations(e,t,s,i){return[{"initDataTypes":e,"persistentState":i.persistentState||"optional","distinctiveIdentifier":i.distinctiveIdentifier||"optional","sessionTypes":i.sessionTypes||[i.sessionType||"temporary"],"audioCapabilities":t.map((e=>({"contentType":`audio/mp4; codecs="${e}"`,"robustness":i.audioRobustness||"","encryptionScheme":i.audioEncryptionScheme||null}))),"videoCapabilities":s.map((e=>({"contentType":`video/mp4; codecs="${e}"`,"robustness":i.videoRobustness||"","encryptionScheme":i.videoEncryptionScheme||null})))}]}(r,t,s,i)}(e,t,s,this.config.drmSystemOptions),r=this.keySystemAccessPromises[e];let n=null==r?void 0:r.keySystemAccess;if(!n){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(i)}`),n=this.requestMediaKeySystemAccess(e,i);const t=this.keySystemAccessPromises[e]={"keySystemAccess":n};return n.catch((t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)})),n.then((s=>{this.log(`Access for key-system "${s.keySystem}" obtained`);const i=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),t.mediaKeys=s.createMediaKeys().then((t=>(this.log(`Media-keys created for "${e}"`),i.then((s=>s?this.setMediaKeysServerCertificate(t,e,s):t))))),t.mediaKeys.catch((t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)})),t.mediaKeys}))}return n.then((()=>r.mediaKeys))}"createMediaKeySessionContext"({"decryptdata":e,"keySystem":t,"mediaKeys":s}){this.log(`Creating key-system session "${t}" keyId: ${Hex_hexDump(e.keyId||[])}`);const i=s.createSession(),r={"decryptdata":e,"keySystem":t,"mediaKeys":s,"mediaKeysSession":i,"keyStatus":"status-pending"};return this.mediaKeySessions.push(r),r}"renewKeySession"(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(s,r,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}"getKeyIdString"(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return Hex_hexDump(e.keyId)}"updateKeySession"(e,t){var s;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${Hex_hexDump((null==(s=e.decryptdata)?void 0:s.keyId)||[])}\n      } (data length: ${t?t.byteLength:t})`),i.update(t)}"selectKeySystemFormat"(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}"getKeyFormatPromise"(e){return new Promise(((t,s)=>{const i=getKeySystemsForConfig(this.config),r=e.map(keySystemFormatToKeySystemDomain).filter((e=>!!e&&-1!==i.indexOf(e)));return this.getKeySystemSelectionPromise(r).then((({"keySystem":e})=>{const i=keySystemDomainToKeySystemFormat(e);i?t(i):s(new Error(`Unable to find format for key-system "${e}"`))})).catch(s)}))}"loadKey"(e){const t=e.keyInfo.decryptdata,s=this.getKeyIdString(t),i=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let r=this.keyIdToKeySessionPromise[s];return r||(r=this.keyIdToKeySessionPromise[s]=this.getKeySystemForKeyPromise(t).then((({"keySystem":s,"mediaKeys":r})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(s,r).then((()=>{this.throwIfDestroyed();const e=this.createMediaKeySessionContext({"keySystem":s,"mediaKeys":r,"decryptdata":t});return this.generateRequestWithPreferredKeySession(e,"cenc",t.pssh,"playlist-key")}))))),r.catch((e=>this.handleError(e)))),r}"throwIfDestroyed"(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}"handleError"(e){this.hls&&(this.error(e.message),e instanceof EMEKeyError?this.hls.trigger(f.ERROR,e.data):this.hls.trigger(f.ERROR,{"type":g.KEY_SYSTEM_ERROR,"details":m.KEY_SYSTEM_NO_KEYS,"error":e,"fatal":!0}))}"getKeySystemForKeyPromise"(e){const t=this.getKeyIdString(e),s=this.keyIdToKeySessionPromise[t];if(!s){const t=keySystemFormatToKeySystemDomain(e.keyFormat),s=t?[t]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess(s)}return s}"getKeySystemSelectionPromise"(e){if(e.length||(e=getKeySystemsForConfig(this.config)),0===e.length)throw new EMEKeyError({"type":g.KEY_SYSTEM_ERROR,"details":m.KEY_SYSTEM_NO_CONFIGURED_LICENSE,"fatal":!0},`Missing key-system license configuration options ${JSON.stringify({"drmSystems":this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}"attemptSetMediaKeys"(e,t){const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(s).then((()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(i),i.then((()=>{this.log(`Media-keys set for "${e}"`),s.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter((e=>-1===s.indexOf(e)))}))}"generateRequestWithPreferredKeySession"(e,t,s,i){var r,n;const a=null==(r=this.config.drmSystems)||null==(n=r[e.keySystem])?void 0:n.generateRequest;if(a)try{const i=a.call(this.hls,t,s,e);if(!i)throw new Error("Invalid response from configured generateRequest filter");t=i.initDataType,s=e.decryptdata.pssh=i.initData?new Uint8Array(i.initData):null}catch(e){var o;if(this.warn(e.message),null!=(o=this.hls)&&o.config.debug)throw e}if(null===s)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${l} (init data type: ${t} length: ${s?s.byteLength:null})`);const d=new Ze,h=e._onmessage=t=>{const s=e.mediaKeysSession;if(!s)return void d.emit("error",new Error("invalid state"));const{"messageType":i,"message":r}=t;this.log(`"${i}" message event for session "${s.sessionId}" message size: ${r.byteLength}`),"license-request"===i||"license-renewal"===i?this.renewLicense(e,r).catch((e=>{this.handleError(e),d.emit("error",e)})):"license-release"===i?e.keySystem===k.FAIRPLAY&&(this.updateKeySession(e,strToUtf8array("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${i}"`)},c=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void d.emit("error",new Error("invalid state"));this.onKeyStatusChange(e);const s=e.keyStatus;d.emit("keyStatus",s),"expired"===s&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",h),e.mediaKeysSession.addEventListener("keystatuseschange",c);const u=new Promise(((e,t)=>{d.on("error",t),d.on("keyStatus",(s=>{s.startsWith("usable")?e():"output-restricted"===s?t(new EMEKeyError({"type":g.KEY_SYSTEM_ERROR,"details":m.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,"fatal":!1},"HDCP level output restricted")):"internal-error"===s?t(new EMEKeyError({"type":g.KEY_SYSTEM_ERROR,"details":m.KEY_SYSTEM_STATUS_INTERNAL_ERROR,"fatal":!0},`key status changed to "${s}"`)):"expired"===s?t(new Error("key expired while generating request")):this.warn(`unhandled key status change "${s}"`)}))}));return e.mediaKeysSession.generateRequest(t,s).then((()=>{var t;this.log(`Request generated for key-session "${null==(t=e.mediaKeysSession)?void 0:t.sessionId}" keyId: ${l}`)})).catch((e=>{throw new EMEKeyError({"type":g.KEY_SYSTEM_ERROR,"details":m.KEY_SYSTEM_NO_SESSION,"error":e,"fatal":!1},`Error generating key-session request: ${e}`)})).then((()=>u)).catch((t=>{throw d.removeAllListeners(),this.removeSession(e),t})).then((()=>(d.removeAllListeners(),e)))}"onKeyStatusChange"(e){e.mediaKeysSession.keyStatuses.forEach(((t,s)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${Hex_hexDump("buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s))} session keyId: ${Hex_hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t}))}"fetchServerCertificate"(e){const t=this.config,s=new(0,t.loader)(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise(((r,n)=>{const a={"responseType":"arraybuffer","url":i},o=t.certLoadPolicy.default,l={"loadPolicy":o,"timeout":o.maxLoadTimeMs,"maxRetry":0,"retryDelay":0,"maxRetryDelay":0},d={"onSuccess":(e,t,s,i)=>{r(e.data)},"onError":(t,s,r,o)=>{n(new EMEKeyError({"type":g.KEY_SYSTEM_ERROR,"details":m.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,"fatal":!0,"networkDetails":r,"response":_objectSpread2({"url":a.url,"data":void 0},t)},`"${e}" certificate request failed (${i}). Status: ${t.code} (${t.text})`))},"onTimeout":(t,s,r)=>{n(new EMEKeyError({"type":g.KEY_SYSTEM_ERROR,"details":m.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,"fatal":!0,"networkDetails":r,"response":{"url":a.url,"data":void 0}},`"${e}" certificate request timed out (${i})`))},"onAbort":(e,t,s)=>{n(new Error("aborted"))}};s.load(a,l,d)}))):Promise.resolve()}"setMediaKeysServerCertificate"(e,t,s){return new Promise(((i,r)=>{e.setServerCertificate(s).then((r=>{this.log(`setServerCertificate ${r?"success":"not supported by CDM"} (${null==s?void 0:s.byteLength}) on "${t}"`),i(e)})).catch((e=>{r(new EMEKeyError({"type":g.KEY_SYSTEM_ERROR,"details":m.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,"error":e,"fatal":!0},e.message))}))}))}"renewLicense"(e,t){return this.requestLicense(e,new Uint8Array(t)).then((t=>this.updateKeySession(e,new Uint8Array(t)).catch((e=>{throw new EMEKeyError({"type":g.KEY_SYSTEM_ERROR,"details":m.KEY_SYSTEM_SESSION_UPDATE_FAILED,"error":e,"fatal":!0},e.message)}))))}"unpackPlayReadyKeyMessage"(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=(new DOMParser).parseFromString(s,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let t;for(let s=0,i=r.length;s<i;s++){var n,a;t=r[s];const i=null==(n=t.querySelector("name"))?void 0:n.textContent,o=null==(a=t.querySelector("value"))?void 0:a.textContent;i&&o&&e.setRequestHeader(i,o)}}const o=i.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return strToUtf8array(atob(l))}"setupLicenseXHR"(e,t,s,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then((()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,i)})).catch((n=>{if(!s.decryptdata)throw n;return e.open("POST",t,!0),r.call(this.hls,e,t,s,i)})).then((s=>{e.readyState||e.open("POST",t,!0);return{"xhr":e,"licenseChallenge":s||i}})):(e.open("POST",t,!0),Promise.resolve({"xhr":e,"licenseChallenge":i}))}"requestLicense"(e,t){const s=this.config.keyLoadPolicy.default;return new Promise(((i,r)=>{const n=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${n}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let t=a.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const s=this.config.licenseResponseCallback;if(s)try{t=s.call(this.hls,a,n,e)}catch(e){this.error(e)}i(t)}else{const o=s.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)r(new EMEKeyError({"type":g.KEY_SYSTEM_ERROR,"details":m.KEY_SYSTEM_LICENSE_REQUEST_FAILED,"fatal":!0,"networkDetails":a,"response":{"url":n,"data":void 0,"code":a.status,"text":a.statusText}},`License Request XHR failed (${n}). Status: ${a.status} (${a.statusText})`));else{const s=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${s} attempts left`),this.requestLicense(e,t).then(i,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,n,e,t).then((({"xhr":t,"licenseChallenge":s})=>{e.keySystem==k.PLAYREADY&&(s=this.unpackPlayReadyKeyMessage(t,s)),t.send(s)}))}))}"onMediaAttached"(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,s.removeEventListener("encrypted",this.onMediaEncrypted),s.removeEventListener("waitingforkey",this.onWaitingForKey),s.addEventListener("encrypted",this.onMediaEncrypted),s.addEventListener("waitingforkey",this.onWaitingForKey)}"onMediaDetached"(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},LevelKey.clearKeyUriToKeyIdMap();const s=t.length;EMEController.CDMCleanupPromise=Promise.all(t.map((e=>this.removeSession(e))).concat(null==e?void 0:e.setMediaKeys(null).catch((e=>{this.log(`Could not clear media keys: ${e}`)})))).then((()=>{s&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)})).catch((e=>{this.log(`Could not close sessions and clear media keys: ${e}`)}))}"onManifestLoading"(){this.keyFormatPromise=null}"onManifestLoaded"(e,{"sessionKeys":t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce(((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e)),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}"removeSession"(e){const{"mediaKeysSession":t,"licenseXhr":s}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);return i>-1&&this.mediaKeySessions.splice(i,1),t.remove().catch((e=>{this.log(`Could not remove session: ${e}`)})).then((()=>t.close())).catch((e=>{this.log(`Could not close session: ${e}`)}))}}}EMEController.CDMCleanupPromise=void 0;class EMEKeyError extends Error{"constructor"(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var St,Lt,At;!function(e){e.MANIFEST="m",e.AUDIO="a",e.VIDEO="v",e.MUXED="av",e.INIT="i",e.CAPTION="c",e.TIMED_TEXT="tt",e.KEY="k",e.OTHER="o"}(St||(St={})),function(e){e.DASH="d",e.HLS="h",e.SMOOTH="s",e.OTHER="o"}(Lt||(Lt={})),function(e){e.OBJECT="CMCD-Object",e.REQUEST="CMCD-Request",e.SESSION="CMCD-Session",e.STATUS="CMCD-Status"}(At||(At={}));const Rt={[At.OBJECT]:["br","d","ot","tb"],[At.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[At.SESSION]:["cid","pr","sf","sid","st","v"],[At.STATUS]:["bs","rtp"]};class SfItem{"constructor"(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map((e=>e instanceof SfItem?e:new SfItem(e)))),this.value=e,this.params=t}}class SfToken{"constructor"(e){this.description=void 0,this.description=e}}function throwError(e,t,s,i){return new Error(`failed to ${e} "${function format(e){return Array.isArray(e)?JSON.stringify(e):e instanceof Map?"Map{}":e instanceof Set?"Set{}":"object"==typeof e?JSON.stringify(e):String(e)}(t)}" as ${s}`,{"cause":i})}const bt="Bare Item";const kt=/[\x00-\x1f\x7f]+/;function serializeError(e,t,s){return throwError("serialize",e,t,s)}function serializeByteSequence(e){if(!1===ArrayBuffer.isView(e))throw serializeError(e,"Byte Sequence");return`:${function base64encode(e){return btoa(String.fromCharCode(...e))}(e)}:`}function serializeInteger(e){if(function isInvalidInt(e){return e<-999999999999999||999999999999999<e}(e))throw serializeError(e,"Integer");return e.toString()}function roundToEven(e,t){if(e<0)return-roundToEven(-e,t);const s=Math.pow(10,t);if(Math.abs(e*s%1-.5)<Number.EPSILON){const t=Math.floor(e*s);return(t%2==0?t:t+1)/s}return Math.round(e*s)/s}function serializeDecimal(e){const t=roundToEven(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw serializeError(e,"Decimal");const s=t.toString();return s.includes(".")?s:`${s}.0`}function serializeToken(e){const t=function symbolToStr(e){return e.description||e.toString().slice(7,-1)}(e);if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw serializeError(t,"Token");return t}function serializeBareItem(e){switch(typeof e){case"number":if(!h(e))throw serializeError(e,bt);return Number.isInteger(e)?serializeInteger(e):serializeDecimal(e);case"string":return function serializeString(e){if(kt.test(e))throw serializeError(e,"String");return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(e);case"symbol":return serializeToken(e);case"boolean":return function serializeBoolean(e){if("boolean"!=typeof e)throw serializeError(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function serializeDate(e){return`@${serializeInteger(e.getTime()/1e3)}`}(e);if(e instanceof Uint8Array)return serializeByteSequence(e);if(e instanceof SfToken)return serializeToken(e);default:throw serializeError(e,bt)}}function serializeKey(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw serializeError(e,"Key");return e}function serializeParams(e){return null==e?"":Object.entries(e).map((([e,t])=>!0===t?`;${serializeKey(e)}`:`;${serializeKey(e)}=${serializeBareItem(t)}`)).join("")}function serializeItem(e){return e instanceof SfItem?`${serializeBareItem(e.value)}${serializeParams(e.params)}`:serializeBareItem(e)}function serializeDict(e,t={"whitespace":!0}){if("object"!=typeof e)throw serializeError(e,"Dict");const s=e instanceof Map?e.entries():Object.entries(e),i=null!=t&&t.whitespace?" ":"";return Array.from(s).map((([e,t])=>{t instanceof SfItem==!1&&(t=new SfItem(t));let s=serializeKey(e);return!0===t.value?s+=serializeParams(t.params):(s+="=",Array.isArray(t.value)?s+=function serializeInnerList(e){return`(${e.value.map(serializeItem).join(" ")})${serializeParams(e.params)}`}(t):s+=serializeItem(t)),s})).join(`,${i}`)}const toRounded=e=>Math.round(e),toHundred=e=>100*toRounded(e/100),Dt={"br":toRounded,"d":toRounded,"bl":toHundred,"dl":toHundred,"mtp":toHundred,"nor":(e,t)=>(null!=t&&t.baseUrl&&(e=function urlToRelativePath(e,t){const s=new URL(e),i=new URL(t);if(s.origin!==i.origin)return e;const r=s.pathname.split("/").slice(1),n=i.pathname.split("/").slice(1,-1);for(;r[0]===n[0];)r.shift(),n.shift();for(;n.length;)n.shift(),r.unshift("..");return r.join("/")}(e,t.baseUrl)),encodeURIComponent(e)),"rtp":toHundred,"tb":toRounded};function processCmcd(e,t){const s={};if(null==e||"object"!=typeof e)return s;const i=Object.keys(e).sort(),r=_extends({},Dt,null==t?void 0:t.formatters),n=null==t?void 0:t.filter;return i.forEach((i=>{if(null!=n&&n(i))return;let a=e[i];const o=r[i];o&&(a=o(a,t)),"v"===i&&1===a||"pr"==i&&1===a||(e=>"number"==typeof e?h(e):null!=e&&""!==e&&!1!==e)(a)&&((e=>"ot"===e||"sf"===e||"st"===e)(i)&&"string"==typeof a&&(a=new SfToken(a)),s[i]=a)})),s}function encodeCmcd(e,t={}){return e?function encodeSfDict(e,t){return serializeDict(e,t)}(processCmcd(e,t),_extends({"whitespace":!1},t)):""}function appendCmcdHeaders(e,t,s){return _extends(e,function toCmcdHeaders(e,t={}){if(!e)return{};const s=Object.entries(e),i=Object.entries(Rt).concat(Object.entries((null==t?void 0:t.customHeaderMap)||{})),r=s.reduce(((e,t)=>{var s;const[r,n]=t,a=(null==(s=i.find((e=>e[1].includes(r))))?void 0:s[0])||At.REQUEST;return null!=e[a]||(e[a]={}),e[a][r]=n,e}),{});return Object.entries(r).reduce(((e,[s,i])=>(e[s]=encodeCmcd(i,t),e)),{})}(t,s))}const Ct=/CMCD=[^&#]+/;function appendCmcdQuery(e,t,s){const i=function toCmcdQuery(e,t={}){if(!e)return"";const s=encodeCmcd(e,t);return`CMCD=${encodeURIComponent(s)}`}(t,s);if(!i)return e;if(Ct.test(e))return e.replace(Ct,i);const r=e.includes("?")?"&":"?";return`${e}${r}${i}`}function cloneRenditionGroups(e,t,s,i){e&&Object.keys(t).forEach((r=>{const n=e.filter((e=>e.groupId===r)).map((e=>{const n=_extends({},e);return n.details=void 0,n.attrs=new AttrList(n.attrs),n.url=n.attrs.URI=performUriReplacement(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",s),n.groupId=n.attrs["GROUP-ID"]=t[r],n.attrs["PATHWAY-ID"]=i,n}));e.push(...n)}))}function performUriReplacement(e,t,s,i){const{"HOST":r,"PARAMS":n,[s]:a}=i;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return r&&!o&&(l.host=r),n&&Object.keys(n).sort().forEach((e=>{e&&l.searchParams.set(e,n[e])})),l.href}const It=/^age:\s*[\d.]+\s*$/im;class XhrLoader{"constructor"(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}"destroy"(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}"abortInternal"(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}"abort"(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}"load"(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}"loadInternal"(){const{"config":e,"context":t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then((()=>{if(this.loader===s&&!this.stats.aborted)return r(s,t.url)})).catch((e=>{if(this.loader===s&&!this.stats.aborted)return s.open("GET",t.url,!0),r(s,t.url)})).then((()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)})).catch((e=>{this.callbacks.onError({"code":s.status,"text":e.message},t,s,i)})):this.openAndSendXhr(s,t,e)}"openAndSendXhr"(e,t,s){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{"maxTimeToFirstByteMs":r,"maxLoadTimeMs":n}=s.loadPolicy;if(i)for(const t in i)e.setRequestHeader(t,i[t]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=r&&h(r)?r:n,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}"readystatechange"(){const{"context":e,"loader":t,"stats":s}=this;if(!e||!t)return;const i=t.readyState,r=this.config;if(!s.aborted&&i>=2&&(0===s.loading.first&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),4===i)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const i=t.status,n="text"===t.responseType?t.responseText:null;if(i>=200&&i<300){const r=null!=n?n:t.response;if(null!=r){s.loading.end=Math.max(self.performance.now(),s.loading.first);const n="arraybuffer"===t.responseType?r.byteLength:r.length;if(s.loaded=s.total=n,s.bwEstimate=8e3*s.total/(s.loading.end-s.loading.first),!this.callbacks)return;const a=this.callbacks.onProgress;if(a&&a(s,e,r,t),!this.callbacks)return;const o={"url":t.responseURL,"data":r,"code":i};return void this.callbacks.onSuccess(o,s,e,t)}}const a=r.loadPolicy.errorRetry;shouldRetry(a,s.retry,!1,{"url":e.url,"data":void 0,"code":i})?this.retry(a):(v.error(`${i} while loading ${e.url}`),this.callbacks.onError({"code":i,"text":t.statusText},e,t,s))}}"loadtimeout"(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(shouldRetry(e,this.stats.retry,!0))this.retry(e);else{var t;v.warn(`timeout while loading ${null==(t=this.context)?void 0:t.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}"retry"(e){const{"context":t,"stats":s}=this;this.retryDelay=getRetryDelay(e,s.retry),s.retry++,v.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}"loadprogress"(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}"getCacheAge"(){let e=null;if(this.loader&&It.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}"getResponseHeader"(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const Pt=/(\d+)-(\d+)\/(\d+)/;class FetchLoader{"constructor"(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||getRequest,this.controller=new self.AbortController,this.stats=new LoadStats}"destroy"(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}"abortInternal"(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}"abort"(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}"load"(e,t,s){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const r=function getRequestParameters(e,t){const s={"method":"GET","mode":"cors","credentials":"same-origin","signal":t,"headers":new self.Headers(_extends({},e.headers))};e.rangeEnd&&s.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return s}(e,this.controller.signal),n=s.onProgress,a="arraybuffer"===e.responseType,o=a?"byteLength":"length",{"maxTimeToFirstByteMs":l,"maxLoadTimeMs":d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=l&&h(l)?l:d,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),s.onTimeout(i,e,this.response)}),t.timeout),self.fetch(this.request).then((r=>{this.response=this.loader=r;const o=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout((()=>{this.abortInternal(),s.onTimeout(i,e,this.response)}),d-(o-i.loading.start)),!r.ok){const{"status":e,"statusText":t}=r;throw new FetchError(t||"fetch, bad network response",e,r)}return i.loading.first=o,i.total=function getContentLength(e){const t=e.get("Content-Range");if(t){const e=function getByteRangeLength(e){const t=Pt.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(h(e))return e}const s=e.get("Content-Length");if(s)return parseInt(s)}(r.headers)||i.total,n&&h(t.highWaterMark)?this.loadProgressively(r,i,e,t.highWaterMark,n):a?r.arrayBuffer():"json"===e.responseType?r.json():r.text()})).then((r=>{const a=this.response;if(!a)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const l=r[o];l&&(i.loaded=i.total=l);const d={"url":a.url,"data":r,"code":a.status};n&&!h(t.highWaterMark)&&n(i,e,r,a),s.onSuccess(d,i,e,a)})).catch((t=>{if(self.clearTimeout(this.requestTimeout),i.aborted)return;const r=t&&t.code||0,n=t?t.message:null;s.onError({"code":r,"text":n},e,t?t.details:null,i)}))}"getCacheAge"(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}"getResponseHeader"(e){return this.response?this.response.headers.get(e):null}"loadProgressively"(e,t,s,i=0,r){const n=new ChunkCache,a=e.body.getReader(),pump=()=>a.read().then((a=>{if(a.done)return n.dataLength&&r(t,s,n.flush(),e),Promise.resolve(new ArrayBuffer(0));const o=a.value,l=o.length;return t.loaded+=l,l<i||n.dataLength?(n.push(o),n.dataLength>=i&&r(t,s,n.flush(),e)):r(t,s,o,e),pump()})).catch((()=>Promise.reject()));return pump()}}function getRequest(e,t){return new self.Request(e.url,t)}class FetchError extends Error{"constructor"(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const wt=/\s/,xt={"newCue"(e,t,s,i){const r=[];let n,a,o,l,d;const h=self.VTTCue||self.TextTrackCue;for(let u=0;u<i.rows.length;u++)if(n=i.rows[u],o=!0,l=0,d="",!n.isEmpty()){var c;for(let e=0;e<n.chars.length;e++)wt.test(n.chars[e].uchar)&&o?l++:(d+=n.chars[e].uchar,o=!1);n.cueStartTime=t,t===s&&(s+=1e-4),l>=16?l--:l++;const i=fixLineBreaks(d.trim()),f=generateCueId(t,s,i);null!=e&&null!=(c=e.cues)&&c.getCueById(f)||(a=new h(t,s,i),a.id=f,a.line=u+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),r.push(a))}return e&&r.length&&(r.sort(((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line)),r.forEach((t=>addCueToTrack(e,t)))),r}},_t=_objectSpread2(_objectSpread2({"autoStartLoad":!0,"startPosition":-1,"defaultAudioCodec":void 0,"debug":!1,"capLevelOnFPSDrop":!1,"capLevelToPlayerSize":!1,"ignoreDevicePixelRatio":!1,"preferManagedMediaSource":!0,"initialLiveManifestSize":1,"maxBufferLength":30,"backBufferLength":1/0,"frontBufferFlushThreshold":1/0,"maxBufferSize":6e7,"maxBufferHole":.1,"highBufferWatchdogPeriod":2,"nudgeOffset":.1,"nudgeMaxRetry":3,"maxFragLookUpTolerance":.25,"liveSyncDurationCount":3,"liveMaxLatencyDurationCount":1/0,"liveSyncDuration":void 0,"liveMaxLatencyDuration":void 0,"maxLiveSyncPlaybackRate":1,"liveDurationInfinity":!1,"liveBackBufferLength":null,"maxMaxBufferLength":600,"enableWorker":!0,"workerPath":null,"enableSoftwareAES":!0,"startLevel":void 0,"startFragPrefetch":!1,"fpsDroppedMonitoringPeriod":5e3,"fpsDroppedMonitoringThreshold":.2,"appendErrorMaxRetry":3,"loader":XhrLoader,"fLoader":void 0,"pLoader":void 0,"xhrSetup":void 0,"licenseXhrSetup":void 0,"licenseResponseCallback":void 0,"abrController":class AbrController{"constructor"(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{"fragCurrent":e,"partCurrent":t,"hls":s}=this,{"autoLevelEnabled":i,"media":r}=s;if(!e||!r)return;const n=performance.now(),a=t?t.stats:e.stats,o=t?t.duration:e.duration,l=n-a.loading.start,d=s.minAutoLevel;if(a.aborted||a.loaded&&a.loaded===a.total||e.level<=d)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!i||r.paused||!r.playbackRate||!r.readyState)return;const c=s.mainForwardBufferInfo;if(null===c)return;const u=this.bwEstimator.getEstimateTTFB(),g=Math.abs(r.playbackRate);if(l<=Math.max(u,o/(2*g)*1e3))return;const m=c.len/g,p=a.loading.first?a.loading.first-a.loading.start:-1,y=a.loaded&&p>-1,T=this.getBwEstimate(),E=s.levels,S=E[e.level],L=a.total||Math.max(a.loaded,Math.round(o*S.averageBitrate/8));let A=y?l-p:l;A<1&&y&&(A=Math.min(l,8*a.loaded/T));const R=y?1e3*a.loaded/A:0,b=R?(L-a.loaded)/R:8*L/T+u/1e3;if(b<=m)return;const k=R?8*R:T;let D,C=Number.POSITIVE_INFINITY;for(D=e.level-1;D>d;D--){const e=E[D].maxBitrate;if(C=this.getTimeToLoadFrag(u/1e3,k,o*e,!E[D].details),C<m)break}if(C>=b)return;if(C>10*o)return;s.nextLoadLevel=s.nextAutoLevel=D,y?this.bwEstimator.sample(l-Math.min(u,p),a.loaded):this.bwEstimator.sampleTTFB(l);const I=E[D].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>I&&this.resetEstimator(I),this.clearTimer(),v.warn(`[abr] Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly;\n      Time to underbuffer: ${m.toFixed(3)} s\n      Estimated load time for current fragment: ${b.toFixed(3)} s\n      Estimated load time for down switch fragment: ${C.toFixed(3)} s\n      TTFB estimate: ${0|p} ms\n      Current BW estimate: ${h(T)?0|T:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${D} @ ${0|I} bps`),s.trigger(f.FRAG_LOAD_EMERGENCY_ABORTED,{"frag":e,"part":t,"stats":a})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}"resetEstimator"(e){e&&(v.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}"initEstimator"(){const e=this.hls.config;return new EwmaBandWidthEstimator(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}"registerListeners"(){const{"hls":e}=this;e.on(f.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.FRAG_LOADING,this.onFragLoading,this),e.on(f.FRAG_LOADED,this.onFragLoaded,this),e.on(f.FRAG_BUFFERED,this.onFragBuffered,this),e.on(f.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(f.LEVEL_LOADED,this.onLevelLoaded,this),e.on(f.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(f.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(f.ERROR,this.onError,this)}"unregisterListeners"(){const{"hls":e}=this;e&&(e.off(f.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.FRAG_LOADING,this.onFragLoading,this),e.off(f.FRAG_LOADED,this.onFragLoaded,this),e.off(f.FRAG_BUFFERED,this.onFragBuffered,this),e.off(f.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(f.LEVEL_LOADED,this.onLevelLoaded,this),e.off(f.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(f.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(f.ERROR,this.onError,this))}"destroy"(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}"onManifestLoading"(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}"onLevelsUpdated"(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}"onMaxAutoLevelUpdated"(){this.firstSelection=-1,this.nextAutoLevelKey=""}"onFragLoading"(e,t){const s=t.frag;if(!this.ignoreFragment(s)){var i;if(!s.bitrateTest)this.fragCurrent=s,this.partCurrent=null!=(i=t.part)?i:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}"onLevelSwitching"(e,t){this.clearTimer()}"onError"(e,t){if(!t.fatal)switch(t.details){case m.BUFFER_ADD_CODEC_ERROR:case m.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case m.FRAG_LOAD_TIMEOUT:{const e=t.frag,{"fragCurrent":s,"partCurrent":i}=this;if(e&&s&&e.sn===s.sn&&e.level===s.level){const t=performance.now(),s=i?i.stats:e.stats,r=t-s.loading.start,n=s.loading.first?s.loading.first-s.loading.start:-1;if(s.loaded&&n>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(r-Math.min(e,n),s.loaded)}else this.bwEstimator.sampleTTFB(r)}break}}}"getTimeToLoadFrag"(e,t,s,i){return e+s/t+(i?this.lastLevelLoadSec:0)}"onLevelLoaded"(e,t){const s=this.hls.config,{"loading":i}=t.stats,r=i.end-i.start;h(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD)}"onFragLoaded"(e,{"frag":t,"part":s}){const i=s?s.stats:t.stats;if(t.type===te&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=s?s.duration:t.duration,r=this.hls.levels[t.level],n=(r.loaded?r.loaded.bytes:0)+i.loaded,a=(r.loaded?r.loaded.duration:0)+e;r.loaded={"bytes":n,"duration":a},r.realBitrate=Math.round(8*n/a)}if(t.bitrateTest){const e={"stats":i,"frag":t,"part":s,"id":t.type};this.onFragBuffered(f.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}"onFragBuffered"(e,t){const{"frag":s,"part":i}=t,r=null!=i&&i.stats.loaded?i.stats:s.stats;if(r.aborted)return;if(this.ignoreFragment(s))return;const n=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(n,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}"ignoreFragment"(e){return e.type!==te||"initSegment"===e.sn}"clearTimer"(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get"firstAutoLevel"(){const{"maxAutoLevel":e,"minAutoLevel":t}=this.hls,s=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,i,1,1);if(r>-1)return r;const n=this.hls.firstLevel,a=Math.min(Math.max(n,t),e);return v.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${n} clamped to ${a}`),a}get"forcedAutoLevel"(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get"nextAutoLevel"(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(!(-1===e||t&&s&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return e;const i=t&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,i)&&t[e].loadError<=t[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}"getAutoLevelKey"(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}"getNextABRAutoLevel"(){const{"fragCurrent":e,"partCurrent":t,"hls":s}=this,{"maxAutoLevel":i,"config":r,"minAutoLevel":n}=s,a=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let d=r.abrBandWidthFactor,h=r.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,n,i,l,0,d,h);if(e>=0)return e}let c=a?Math.min(a,r.maxStarvationDelay):r.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){c=(a?Math.min(a,r.maxLoadingDelay):r.maxLoadingDelay)-e,v.info(`[abr] bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*c)} ms`),d=h=1}}const u=this.findBestLevel(o,n,i,l,c,d,h);if(v.info(`[abr] ${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${u}`),u>-1)return u;const f=s.levels[n],g=s.levels[s.loadLevel];return(null==f?void 0:f.bitrate)<(null==g?void 0:g.bitrate)?n:s.loadLevel}"getStarvationDelay"(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/s}"getBwEstimate"(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}"findBestLevel"(e,t,s,i,r,n,a){var o;const l=i+r,d=this.lastLoadedFragLevel,c=-1===d?this.hls.firstLevel:d,{"fragCurrent":u,"partCurrent":f}=this,{"levels":g,"allAudioTracks":m,"loadLevel":p,"config":y}=this.hls;if(1===g.length)return 0;const T=g[c],E=!(null==T||null==(o=T.details)||!o.live),S=-1===p||-1===d;let L,A="SDR",R=(null==T?void 0:T.frameRate)||0;const{"audioPreference":b,"videoPreference":k}=y,D=this.audioTracksByGroup||(this.audioTracksByGroup=function getAudioTracksByGroup(e){return e.reduce(((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={"tracks":[],"channels":{"2":0},"hasDefault":!1,"hasAutoSelect":!1}),s.tracks.push(t);const i=t.channels||"2";return s.channels[i]=(s.channels[i]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e}),{"hasDefaultAudio":!1,"hasAutoSelectAudio":!1,"groups":{}})}(m));if(S){if(-1!==this.firstSelection)return this.firstSelection;const i=this.codecTiers||(this.codecTiers=function getCodecTiers(e,t,s,i){return e.slice(s,i+1).reduce(((e,s)=>{if(!s.codecSet)return e;const i=s.audioGroups;let r=e[s.codecSet];r||(e[s.codecSet]=r={"minBitrate":1/0,"minHeight":1/0,"minFramerate":1/0,"maxScore":0,"videoRanges":{"SDR":0},"channels":{"2":0},"hasDefaultAudio":!i,"fragmentError":0}),r.minBitrate=Math.min(r.minBitrate,s.bitrate);const n=Math.min(s.height,s.width);return r.minHeight=Math.min(r.minHeight,n),r.minFramerate=Math.min(r.minFramerate,s.frameRate),r.maxScore=Math.max(r.maxScore,s.score),r.fragmentError+=s.fragmentError,r.videoRanges[s.videoRange]=(r.videoRanges[s.videoRange]||0)+1,i&&i.forEach((e=>{if(!e)return;const s=t.groups[e];s&&(r.hasDefaultAudio=r.hasDefaultAudio||t.hasDefaultAudio?s.hasDefault:s.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(s.channels).forEach((e=>{r.channels[e]=(r.channels[e]||0)+s.channels[e]})))})),e}),{})}(g,D,t,s)),r=function getStartCodecTier(e,t,s,i,r){const n=Object.keys(e),a=null==i?void 0:i.channels,o=null==i?void 0:i.audioCodec,l=a&&2===parseInt(a);let d=!0,c=!1,u=1/0,f=1/0,g=1/0,m=0,p=[];const{"preferHDR":y,"allowedVideoRanges":T}=getVideoSelectionOptions(t,r);for(let t=n.length;t--;){const s=e[n[t]];d=s.channels[2]>0,u=Math.min(u,s.minHeight),f=Math.min(f,s.minFramerate),g=Math.min(g,s.minBitrate);const i=T.filter((e=>s.videoRanges[e]>0));i.length>0&&(c=!0,p=i)}u=h(u)?u:0,f=h(f)?f:0;const v=Math.max(1080,u),E=Math.max(30,f);return g=h(g)?g:s,s=Math.max(g,s),c||(t=void 0,p=[]),{"codecSet":n.reduce(((t,i)=>{const r=e[i];if(i===t)return t;if(r.minBitrate>s)return logStartCodecCandidateIgnored(i,`min bitrate of ${r.minBitrate} > current estimate of ${s}`),t;if(!r.hasDefaultAudio)return logStartCodecCandidateIgnored(i,"no renditions with default or auto-select sound found"),t;if(o&&i.indexOf(o.substring(0,4))%5!=0)return logStartCodecCandidateIgnored(i,`audio codec preference "${o}" not found`),t;if(a&&!l){if(!r.channels[a])return logStartCodecCandidateIgnored(i,`no renditions with ${a} channel sound found (channels options: ${Object.keys(r.channels)})`),t}else if((!o||l)&&d&&0===r.channels[2])return logStartCodecCandidateIgnored(i,"no renditions with stereo sound found"),t;return r.minHeight>v?(logStartCodecCandidateIgnored(i,`min resolution of ${r.minHeight} > maximum of ${v}`),t):r.minFramerate>E?(logStartCodecCandidateIgnored(i,`min framerate of ${r.minFramerate} > maximum of ${E}`),t):p.some((e=>r.videoRanges[e]>0))?r.maxScore<m?(logStartCodecCandidateIgnored(i,`max score of ${r.maxScore} < selected max of ${m}`),t):t&&(codecsSetSelectionPreferenceValue(i)>=codecsSetSelectionPreferenceValue(t)||r.fragmentError>e[t].fragmentError)?t:(m=r.maxScore,i):(logStartCodecCandidateIgnored(i,`no variants with VIDEO-RANGE of ${JSON.stringify(p)} found`),t)}),void 0),"videoRanges":p,"preferHDR":y,"minFramerate":f,"minBitrate":g}}(i,A,e,b,k),{"codecSet":n,"videoRanges":a,"minFramerate":o,"minBitrate":l,"preferHDR":d}=r;L=n,A=d?a[a.length-1]:a[0],R=o,e=Math.max(e,l),v.log(`[abr] picked start tier ${JSON.stringify(r)}`)}else L=null==T?void 0:T.codecSet,A=null==T?void 0:T.videoRange;const C=f?f.duration:u?u.duration:0,I=this.bwEstimator.getEstimateTTFB()/1e3,P=[];for(let o=s;o>=t;o--){var w;const t=g[o],u=o>c;if(!t)continue;if(y.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const s=navigator.mediaCapabilities;"function"==typeof(null==s?void 0:s.decodingInfo)&&requiresMediaCapabilitiesDecodingInfo(t,D,A,R,e,b)?(t.supportedPromise=getMediaDecodingInfoPromise(t,D,s),t.supportedPromise.then((e=>{if(!this.hls)return;t.supportedResult=e;const s=this.hls.levels,i=s.indexOf(t);e.error?v.warn(`[abr] MediaCapabilities decodingInfo error: "${e.error}" for level ${i} ${JSON.stringify(e)}`):e.supported||(v.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${i} ${JSON.stringify(e)}`),i>-1&&s.length>1&&(v.log(`[abr] Removing unsupported level ${i}`),this.hls.removeLevel(i)))}))):t.supportedResult=Ee}if(L&&t.codecSet!==L||A&&t.videoRange!==A||u&&R>t.frameRate||!u&&R>0&&R<t.frameRate||t.supportedResult&&(null==(w=t.supportedResult.decodingInfoResults)||!w[0].smooth)){P.push(o);continue}const m=t.details,k=(f?null==m?void 0:m.partTarget:null==m?void 0:m.averagetargetduration)||C;let x;x=u?a*e:n*e;const _=C&&i>=2*C&&0===r?g[o].averageBitrate:g[o].maxBitrate,M=this.getTimeToLoadFrag(I,x,_*k,void 0===m);if(x>=_&&(o===d||0===t.loadError&&0===t.fragmentError)&&(M<=I||!h(M)||E&&!this.bitrateTestDelay||M<l)){const e=this.forcedAutoLevel;return o===p||-1!==e&&e===p||(P.length&&v.trace(`[abr] Skipped level(s) ${P.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${g[P[0]].codecs}" ${g[P[0]].videoRange}; not compatible with "${T.codecs}" ${A}`),v.info(`[abr] switch candidate:${c}->${o} adjustedbw(${Math.round(x)})-bitrate=${Math.round(x-_)} ttfb:${I.toFixed(1)} avgDuration:${k.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${M.toFixed(1)} firstSelection:${S} codecSet:${L} videoRange:${A} hls.loadLevel:${p}`)),S&&(this.firstSelection=o),o}}return-1}set"nextAutoLevel"(e){const{"maxAutoLevel":t,"minAutoLevel":s}=this.hls,i=Math.min(Math.max(e,s),t);this._nextAutoLevel!==i&&(this.nextAutoLevelKey="",this._nextAutoLevel=i)}},"bufferController":class BufferController{"constructor"(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={"audio":0,"video":0,"audiovideo":0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=e=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{"media":e,"mediaSource":t}=this;this.log("Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(f.MEDIA_ATTACHED,{"media":e,"mediaSource":t})),t&&t.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{"mediaSrc":e,"_objectUrl":t}=this;e!==t&&v.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)},this.hls=e;const t="[buffer-controller]";this.appendSource=function isManagedMediaSource(e){return"undefined"!=typeof self&&e===self.ManagedMediaSource}(getMediaSource(e.config.preferManagedMediaSource)),this.log=v.log.bind(v,t),this.warn=v.warn.bind(v,t),this.error=v.error.bind(v,t),this._initSourceBuffer(),this.registerListeners()}"hasSourceTypes"(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}"destroy"(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}"registerListeners"(){const{"hls":e}=this;e.on(f.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(f.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.MANIFEST_PARSED,this.onManifestParsed,this),e.on(f.BUFFER_RESET,this.onBufferReset,this),e.on(f.BUFFER_APPENDING,this.onBufferAppending,this),e.on(f.BUFFER_CODECS,this.onBufferCodecs,this),e.on(f.BUFFER_EOS,this.onBufferEos,this),e.on(f.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(f.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(f.FRAG_PARSED,this.onFragParsed,this),e.on(f.FRAG_CHANGED,this.onFragChanged,this)}"unregisterListeners"(){const{"hls":e}=this;e.off(f.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(f.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.MANIFEST_PARSED,this.onManifestParsed,this),e.off(f.BUFFER_RESET,this.onBufferReset,this),e.off(f.BUFFER_APPENDING,this.onBufferAppending,this),e.off(f.BUFFER_CODECS,this.onBufferCodecs,this),e.off(f.BUFFER_EOS,this.onBufferEos,this),e.off(f.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(f.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(f.FRAG_PARSED,this.onFragParsed,this),e.off(f.FRAG_CHANGED,this.onFragChanged,this)}"_initSourceBuffer"(){this.sourceBuffer={},this.operationQueue=new BufferOperationQueue(this.sourceBuffer),this.listeners={"audio":[],"video":[],"audiovideo":[]},this.appendErrors={"audio":0,"video":0,"audiovideo":0},this.lastMpegAudioChunk=null}"onManifestLoading"(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}"onManifestParsed"(e,t){let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=s,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}"onMediaAttaching"(e,t){const s=this.media=t.media,i=getMediaSource(this.appendSource);if(s&&i){var r;const e=this.mediaSource=new i;this.log(`created media source: ${null==(r=e.constructor)?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming));const t=this._objectUrl=self.URL.createObjectURL(e);if(this.appendSource)try{s.removeAttribute("src");const i=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||i&&e instanceof i,removeSourceChildren(s),function addSource(e,t){const s=self.document.createElement("source");s.type="video/mp4",s.src=t,e.appendChild(s)}(s,t),s.load()}catch(e){s.src=t}else s.src=t;s.addEventListener("emptied",this._onMediaEmptied)}}"onMediaDetaching"(){const{"media":e,"mediaSource":t,"_objectUrl":s}=this;if(t){if(this.log("media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){this.warn(`onMediaDetaching: ${e.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),s&&self.URL.revokeObjectURL(s),this.mediaSrc===s?(e.removeAttribute("src"),this.appendSource&&removeSourceChildren(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(f.MEDIA_DETACHED,void 0)}"onBufferReset"(){this.getSourceBufferTypes().forEach((e=>{this.resetBuffer(e)})),this._initSourceBuffer(),this.hls.resumeBuffering()}"resetBuffer"(e){const t=this.sourceBuffer[e];try{var s;if(t)this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,null!=(s=this.mediaSource)&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}catch(t){this.warn(`onBufferReset ${e}`,t)}}"onBufferCodecs"(e,t){const s=this.getSourceBufferTypes().length,i=Object.keys(t);if(i.forEach((e=>{if(s){const s=this.tracks[e];if(s&&"function"==typeof s.buffer.changeType){var i;const{"id":r,"codec":n,"levelCodec":a,"container":o,"metadata":l}=t[e],d=pickMostCompleteCodecName(s.codec,s.levelCodec),h=null==d?void 0:d.replace(et,"$1");let c=pickMostCompleteCodecName(n,a);const u=null==(i=c)?void 0:i.replace(et,"$1");if(c&&h!==u){"audio"===e.slice(0,5)&&(c=getCodecCompatibleName(c,this.appendSource));const t=`${o};codecs=${c}`;this.appendChangeType(e,t),this.log(`switching codec ${d} to ${c}`),this.tracks[e]={"buffer":s.buffer,"codec":n,"container":o,"levelCodec":a,"metadata":l,"id":r}}}}else this.pendingTracks[e]=t[e]})),s)return;const r=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==r&&(this.log(`${r} bufferCodec event(s) expected ${i.join(",")}`),this.bufferCodecEventsExpected=r),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks()}"appendChangeType"(e,t){const{"operationQueue":s}=this,i={"execute":()=>{const i=this.sourceBuffer[e];i&&(this.log(`changing ${e} sourceBuffer type to ${t}`),i.changeType(t)),s.shiftAndExecuteNext(e)},"onStart":()=>{},"onComplete":()=>{},"onError":t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}};s.append(i,e,!!this.pendingTracks[e])}"onBufferAppending"(e,t){const{"hls":s,"operationQueue":i,"tracks":r}=this,{"data":n,"type":a,"frag":o,"part":l,"chunkMeta":d}=t,h=d.buffering[a],c=self.performance.now();h.start=c;const u=o.stats.buffering,p=l?l.stats.buffering:null;0===u.start&&(u.start=c),p&&0===p.start&&(p.start=c);const y=r.audio;let T=!1;"audio"===a&&"audio/mpeg"===(null==y?void 0:y.container)&&(T=!this.lastMpegAudioChunk||1===d.id||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const v=o.start,E={"execute":()=>{if(h.executeStart=self.performance.now(),T){const e=this.sourceBuffer[a];if(e){const t=v-e.timestampOffset;Math.abs(t)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${v} (delta: ${t}) sn: ${o.sn})`),e.timestampOffset=v)}}this.appendExecutor(n,a)},"onStart":()=>{},"onComplete":()=>{const e=self.performance.now();h.executeEnd=h.end=e,0===u.first&&(u.first=e),p&&0===p.first&&(p.first=e);const{"sourceBuffer":t}=this,s={};for(const e in t)s[e]=BufferHelper.getBuffered(t[e]);this.appendErrors[a]=0,"audio"===a||"video"===a?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(f.BUFFER_APPENDED,{"type":a,"frag":o,"part":l,"chunkMeta":d,"parent":o.type,"timeRanges":s})},"onError":e=>{const t={"type":g.MEDIA_ERROR,"parent":o.type,"details":m.BUFFER_APPEND_ERROR,"sourceBufferName":a,"frag":o,"part":l,"chunkMeta":d,"error":e,"err":e,"fatal":!1};if(e.code===DOMException.QUOTA_EXCEEDED_ERR)t.details=m.BUFFER_FULL_ERROR;else{const e=++this.appendErrors[a];t.details=m.BUFFER_APPEND_ERROR,this.warn(`Failed ${e}/${s.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer`),e>=s.config.appendErrorMaxRetry&&(t.fatal=!0)}s.trigger(f.ERROR,t)}};i.append(E,a,!!this.pendingTracks[a])}"onBufferFlushing"(e,t){const{"operationQueue":s}=this,flushOperation=e=>({"execute":this.removeExecutor.bind(this,e,t.startOffset,t.endOffset),"onStart":()=>{},"onComplete":()=>{this.hls.trigger(f.BUFFER_FLUSHED,{"type":e})},"onError":t=>{this.warn(`Failed to remove from ${e} SourceBuffer`,t)}});t.type?s.append(flushOperation(t.type),t.type):this.getSourceBufferTypes().forEach((e=>{s.append(flushOperation(e),e)}))}"onFragParsed"(e,t){const{"frag":s,"part":i}=t,r=[],n=i?i.elementaryStreams:s.elementaryStreams;n[R]?r.push("audiovideo"):(n[L]&&r.push("audio"),n[A]&&r.push("video"));0===r.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers((()=>{const e=self.performance.now();s.stats.buffering.end=e,i&&(i.stats.buffering.end=e);const t=i?i.stats:s.stats;this.hls.trigger(f.FRAG_BUFFERED,{"frag":s,"part":i,"stats":t,"id":s.type})}),r)}"onFragChanged"(e,t){this.trimBuffers()}"onBufferEos"(e,t){this.getSourceBufferTypes().reduce(((e,s)=>{const i=this.sourceBuffer[s];return!i||t.type&&t.type!==s||(i.ending=!0,i.ended||(i.ended=!0,this.log(`${s} sourceBuffer now EOS`))),e&&!(i&&!i.ended)}),!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers((()=>{this.getSourceBufferTypes().forEach((e=>{const t=this.sourceBuffer[e];t&&(t.ending=!1)}));const{"mediaSource":e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream()):e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)})))}"onLevelUpdated"(e,{"details":t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}"trimBuffers"(){const{"hls":e,"details":t,"media":s}=this;if(!s||null===t)return;if(!this.getSourceBufferTypes().length)return;const i=e.config,r=s.currentTime,n=t.levelTargetDuration,a=t.live&&null!==i.liveBackBufferLength?i.liveBackBufferLength:i.backBufferLength;if(h(a)&&a>0){const e=Math.max(a,n),t=Math.floor(r/n)*n-e;this.flushBackBuffer(r,n,t)}if(h(i.frontBufferFlushThreshold)&&i.frontBufferFlushThreshold>0){const e=Math.max(i.maxBufferLength,i.frontBufferFlushThreshold),t=Math.max(e,n),s=Math.floor(r/n)*n+t;this.flushFrontBuffer(r,n,s)}}"flushBackBuffer"(e,t,s){const{"details":i,"sourceBuffer":r}=this;this.getSourceBufferTypes().forEach((n=>{const a=r[n];if(a){const r=BufferHelper.getBuffered(a);if(r.length>0&&s>r.start(0)){if(this.hls.trigger(f.BACK_BUFFER_REACHED,{"bufferEnd":s}),null!=i&&i.live)this.hls.trigger(f.LIVE_BACK_BUFFER_REACHED,{"bufferEnd":s});else if(a.ended&&r.end(r.length-1)-e<2*t)return void this.log(`Cannot flush ${n} back buffer while SourceBuffer is in ended state`);this.hls.trigger(f.BUFFER_FLUSHING,{"startOffset":0,"endOffset":s,"type":n})}}}))}"flushFrontBuffer"(e,t,s){const{"sourceBuffer":i}=this;this.getSourceBufferTypes().forEach((r=>{const n=i[r];if(n){const i=BufferHelper.getBuffered(n),a=i.length;if(a<2)return;const o=i.start(a-1),l=i.end(a-1);if(s>o||e>=o&&e<=l)return;if(n.ended&&e-l<2*t)return void this.log(`Cannot flush ${r} front buffer while SourceBuffer is in ended state`);this.hls.trigger(f.BUFFER_FLUSHING,{"startOffset":o,"endOffset":1/0,"type":r})}}))}"updateMediaElementDuration"(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{"details":e,"hls":t,"media":s,"mediaSource":i}=this,r=e.fragments[0].start+e.totalduration,n=s.duration,a=h(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(i.duration=1/0,this.updateSeekableRange(e)):(r>a&&r>n||!h(n))&&(this.log(`Updating Media Source duration to ${r.toFixed(3)}`),i.duration=r)}"updateSeekableRange"(e){const t=this.mediaSource,s=e.fragments;if(s.length&&e.live&&null!=t&&t.setLiveSeekableRange){const i=Math.max(0,s[0].start),r=Math.max(i,i+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${i}-${r}.`),t.setLiveSeekableRange(i,r)}}"checkPendingTracks"(){const{"bufferCodecEventsExpected":e,"operationQueue":t,"pendingTracks":s}=this,i=Object.keys(s).length;if(i&&(!e||2===i||"audiovideo"in s)){this.createSourceBuffers(s),this.pendingTracks={};const e=this.getSourceBufferTypes();if(e.length)this.hls.trigger(f.BUFFER_CREATED,{"tracks":this.tracks}),e.forEach((e=>{t.executeNext(e)}));else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(f.ERROR,{"type":g.MEDIA_ERROR,"details":m.BUFFER_INCOMPATIBLE_CODECS_ERROR,"fatal":!0,"error":e,"reason":e.message})}}}"createSourceBuffers"(e){const{"sourceBuffer":t,"mediaSource":s}=this;if(!s)throw Error("createSourceBuffers called when mediaSource was null");for(const r in e)if(!t[r]){var i;const n=e[r];if(!n)throw Error(`source buffer exists for track ${r}, however track does not`);let a=-1===(null==(i=n.levelCodec)?void 0:i.indexOf(","))?n.levelCodec:n.codec;a&&"audio"===r.slice(0,5)&&(a=getCodecCompatibleName(a,this.appendSource));const o=`${n.container};codecs=${a}`;this.log(`creating sourceBuffer(${o})`);try{const e=t[r]=s.addSourceBuffer(o),i=r;this.addBufferListener(i,"updatestart",this._onSBUpdateStart),this.addBufferListener(i,"updateend",this._onSBUpdateEnd),this.addBufferListener(i,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(i,"bufferedchange",((e,t)=>{const s=t.removedRanges;null!=s&&s.length&&this.hls.trigger(f.BUFFER_FLUSHED,{"type":r})})),this.tracks[r]={"buffer":e,"codec":a,"container":n.container,"levelCodec":n.levelCodec,"metadata":n.metadata,"id":n.id}}catch(e){this.error(`error while trying to add sourceBuffer: ${e.message}`),this.hls.trigger(f.ERROR,{"type":g.MEDIA_ERROR,"details":m.BUFFER_ADD_CODEC_ERROR,"fatal":!1,"error":e,"sourceBufferName":r,"mimeType":o})}}}get"mediaSrc"(){var e,t;const s=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==s?void 0:s.src}"_onSBUpdateStart"(e){const{"operationQueue":t}=this;t.current(e).onStart()}"_onSBUpdateEnd"(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const{"operationQueue":s}=this;s.current(e).onComplete(),s.shiftAndExecuteNext(e)}"_onSBUpdateError"(e,t){var s;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(s=this.mediaSource)?void 0:s.readyState}`);this.error(`${i}`,t),this.hls.trigger(f.ERROR,{"type":g.MEDIA_ERROR,"details":m.BUFFER_APPENDING_ERROR,"sourceBufferName":e,"error":i,"fatal":!1});const r=this.operationQueue.current(e);r&&r.onError(i)}"removeExecutor"(e,t,s){const{"media":i,"mediaSource":r,"operationQueue":n,"sourceBuffer":a}=this,o=a[e];if(!i||!r||!o)return this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void n.shiftAndExecuteNext(e);const l=h(i.duration)?i.duration:1/0,d=h(r.duration)?r.duration:1/0,c=Math.max(0,t),u=Math.min(s,l,d);u>c&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${c},${u}] from the ${e} SourceBuffer`),o.remove(c,u)):n.shiftAndExecuteNext(e)}"appendExecutor"(e,t){const s=this.sourceBuffer[t];if(s)s.ended=!1,s.appendBuffer(e);else if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`)}"blockBuffers"(e,t=this.getSourceBufferTypes()){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);const{"operationQueue":s}=this,i=t.map((e=>s.appendBlocker(e)));Promise.all(i).then((()=>{e(),t.forEach((e=>{const t=this.sourceBuffer[e];null!=t&&t.updating||s.shiftAndExecuteNext(e)}))}))}"getSourceBufferTypes"(){return Object.keys(this.sourceBuffer)}"addBufferListener"(e,t,s){const i=this.sourceBuffer[e];if(!i)return;const r=s.bind(this,e);this.listeners[e].push({"event":t,"listener":r}),i.addEventListener(t,r)}"removeBufferListeners"(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach((e=>{t.removeEventListener(e.event,e.listener)}))}},"capLevelController":CapLevelController,"errorController":class ErrorController{"constructor"(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=v.log.bind(v,"[info]:"),this.warn=v.warn.bind(v,"[warning]:"),this.error=v.error.bind(v,"[error]:"),this.registerListeners()}"registerListeners"(){const e=this.hls;e.on(f.ERROR,this.onError,this),e.on(f.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.LEVEL_UPDATED,this.onLevelUpdated,this)}"unregisterListeners"(){const e=this.hls;e&&(e.off(f.ERROR,this.onError,this),e.off(f.ERROR,this.onErrorOut,this),e.off(f.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.LEVEL_UPDATED,this.onLevelUpdated,this))}"destroy"(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}"startLoad"(e){}"stopLoad"(){this.playlistError=0}"getVariantLevelIndex"(e){return(null==e?void 0:e.type)===te?e.level:this.hls.loadLevel}"onManifestLoading"(){this.playlistError=0,this.penalizedRenditions={}}"onLevelUpdated"(){this.playlistError=0}"onError"(e,t){var s,i;if(t.fatal)return;const r=this.hls,n=t.context;switch(t.details){case m.FRAG_LOAD_ERROR:case m.FRAG_LOAD_TIMEOUT:case m.KEY_LOAD_ERROR:case m.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case m.FRAG_PARSING_ERROR:if(null!=(s=t.frag)&&s.gap)return void(t.errorAction={"action":fe,"flags":ye});case m.FRAG_GAP:case m.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=ge);case m.LEVEL_EMPTY_ERROR:case m.LEVEL_PARSING_ERROR:{var a,o;const e=t.parent===te?t.level:r.loadLevel;t.details===m.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(o=a.levelDetails)&&o.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case m.LEVEL_LOAD_ERROR:case m.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==n?void 0:n.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.level)));case m.AUDIO_TRACK_LOAD_ERROR:case m.AUDIO_TRACK_LOAD_TIMEOUT:case m.SUBTITLE_LOAD_ERROR:case m.SUBTITLE_TRACK_LOAD_TIMEOUT:if(n){const e=r.levels[r.loadLevel];if(e&&(n.type===Z&&e.hasAudioGroup(n.groupId)||n.type===ee&&e.hasSubtitleGroup(n.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=ge,void(t.errorAction.flags=Te)}return;case m.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const e=r.levels[r.loadLevel],s=null==e?void 0:e.attrs["HDCP-LEVEL"];s?t.errorAction={"action":ge,"flags":ve,"hdcpLevel":s}:this.keySystemError(t)}return;case m.BUFFER_ADD_CODEC_ERROR:case m.REMUX_ALLOC_ERROR:case m.BUFFER_APPEND_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(i=t.level)?i:r.loadLevel));case m.INTERNAL_EXCEPTION:case m.BUFFER_APPENDING_ERROR:case m.BUFFER_FULL_ERROR:case m.LEVEL_SWITCH_ERROR:case m.BUFFER_STALLED_ERROR:case m.BUFFER_SEEK_OVER_HOLE:case m.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={"action":fe,"flags":ye})}t.type===g.KEY_SYSTEM_ERROR&&this.keySystemError(t)}"keySystemError"(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}"getPlaylistRetryOrSwitchAction"(e,t){const s=getRetryConfig(this.hls.config.playlistLoadPolicy,e),i=this.playlistError++;if(shouldRetry(s,i,isTimeoutError(e),e.response))return{"action":pe,"flags":ye,"retryConfig":s,"retryCount":i};const r=this.getLevelSwitchAction(e,t);return s&&(r.retryConfig=s,r.retryCount=i),r}"getFragRetryOrSwitchAction"(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),i=t.levels[s],{"fragLoadPolicy":r,"keyLoadPolicy":n}=t.config,a=getRetryConfig(e.details.startsWith("key")?n:r,e),o=t.levels.reduce(((e,t)=>e+t.fragmentError),0);if(i){e.details!==m.FRAG_GAP&&i.fragmentError++;if(shouldRetry(a,o,isTimeoutError(e),e.response))return{"action":pe,"flags":ye,"retryConfig":a,"retryCount":o}}const l=this.getLevelSwitchAction(e,s);return a&&(l.retryConfig=a,l.retryCount=o),l}"getLevelSwitchAction"(e,t){const s=this.hls;null==t&&(t=s.loadLevel);const i=this.hls.levels[t];if(i){var r,n;const t=e.details;i.loadError++,t===m.BUFFER_APPEND_ERROR&&i.fragmentError++;let l=-1;const{"levels":d,"loadLevel":h,"minAutoLevel":c,"maxAutoLevel":u}=s;s.autoLevelEnabled||(s.loadLevel=-1);const f=null==(r=e.frag)?void 0:r.type,g=(f===se&&t===m.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===m.BUFFER_ADD_CODEC_ERROR||t===m.BUFFER_APPEND_ERROR))&&d.some((({"audioCodec":e})=>i.audioCodec!==e)),p="video"===e.sourceBufferName&&(t===m.BUFFER_ADD_CODEC_ERROR||t===m.BUFFER_APPEND_ERROR)&&d.some((({"codecSet":e,"audioCodec":t})=>i.codecSet!==e&&i.audioCodec===t)),{"type":y,"groupId":T}=null!=(n=e.context)?n:{};for(let s=d.length;s--;){const r=(s+h)%d.length;if(r!==h&&r>=c&&r<=u&&0===d[r].loadError){var a,o;const s=d[r];if(t===m.FRAG_GAP&&f===te&&e.frag){const t=d[r].details;if(t){const s=findFragmentByPTS(e.frag,t.fragments,e.frag.start);if(null!=s&&s.gap)continue}}else{if(y===Z&&s.hasAudioGroup(T)||y===ee&&s.hasSubtitleGroup(T))continue;if(f===se&&null!=(a=i.audioGroups)&&a.some((e=>s.hasAudioGroup(e)))||f===ie&&null!=(o=i.subtitleGroups)&&o.some((e=>s.hasSubtitleGroup(e)))||g&&i.audioCodec===s.audioCodec||!g&&i.audioCodec!==s.audioCodec||p&&i.codecSet===s.codecSet)continue}l=r;break}}if(l>-1&&s.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{"action":ge,"flags":ye,"nextAutoLevel":l}}return{"action":ge,"flags":Te}}"onErrorOut"(e,t){var s;switch(null==(s=t.errorAction)?void 0:s.action){case fe:break;case ge:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===m.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}"sendAlternateToPenaltyBox"(e){const t=this.hls,s=e.errorAction;if(!s)return;const{"flags":i,"hdcpLevel":r,"nextAutoLevel":n}=s;switch(i){case ye:this.switchLevel(e,n);break;case ve:r&&(t.maxHdcpLevel=le[le.indexOf(r)-1],s.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`)}s.resolved||this.switchLevel(e,n)}"switchLevel"(e,t){void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}},"fpsController":class FPSController{"constructor"(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}"setStreamController"(e){this.streamController=e}"registerListeners"(){this.hls.on(f.MEDIA_ATTACHING,this.onMediaAttaching,this)}"unregisterListeners"(){this.hls.off(f.MEDIA_ATTACHING,this.onMediaAttaching,this)}"destroy"(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}"onMediaAttaching"(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}"checkFPS"(e,t,s){const i=performance.now();if(t){if(this.lastTime){const e=i-this.lastTime,r=s-this.lastDroppedFrames,n=t-this.lastDecodedFrames,a=1e3*r/e,o=this.hls;if(o.trigger(f.FPS_DROP,{"currentDropped":r,"currentDecoded":n,"totalDroppedFrames":s}),a>0&&r>o.config.fpsDroppedMonitoringThreshold*n){let e=o.currentLevel;v.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(f.FPS_DROP_LEVEL_CAPPING,{"level":e,"droppedLevel":o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}"checkFPSInterval"(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},"stretchShortVideoTrack":!1,"maxAudioFramesDrift":1,"forceKeyFrameOnDiscontinuity":!0,"abrEwmaFastLive":3,"abrEwmaSlowLive":9,"abrEwmaFastVoD":3,"abrEwmaSlowVoD":9,"abrEwmaDefaultEstimate":5e5,"abrEwmaDefaultEstimateMax":5e6,"abrBandWidthFactor":.95,"abrBandWidthUpFactor":.7,"abrMaxWithRealBitrate":!1,"maxStarvationDelay":4,"maxLoadingDelay":4,"minAutoBitrate":0,"emeEnabled":!1,"widevineLicenseUrl":void 0,"drmSystems":{},"drmSystemOptions":{},"requestMediaKeySystemAccessFunc":F,"testBandwidth":!0,"progressive":!1,"lowLatencyMode":!0,"cmcd":void 0,"enableDateRangeMetadataCues":!0,"enableEmsgMetadataCues":!0,"enableID3MetadataCues":!0,"useMediaCapabilities":!0,"certLoadPolicy":{"default":{"maxTimeToFirstByteMs":8e3,"maxLoadTimeMs":2e4,"timeoutRetry":null,"errorRetry":null}},"keyLoadPolicy":{"default":{"maxTimeToFirstByteMs":8e3,"maxLoadTimeMs":2e4,"timeoutRetry":{"maxNumRetry":1,"retryDelayMs":1e3,"maxRetryDelayMs":2e4,"backoff":"linear"},"errorRetry":{"maxNumRetry":8,"retryDelayMs":1e3,"maxRetryDelayMs":2e4,"backoff":"linear"}}},"manifestLoadPolicy":{"default":{"maxTimeToFirstByteMs":1/0,"maxLoadTimeMs":2e4,"timeoutRetry":{"maxNumRetry":2,"retryDelayMs":0,"maxRetryDelayMs":0},"errorRetry":{"maxNumRetry":1,"retryDelayMs":1e3,"maxRetryDelayMs":8e3}}},"playlistLoadPolicy":{"default":{"maxTimeToFirstByteMs":1e4,"maxLoadTimeMs":2e4,"timeoutRetry":{"maxNumRetry":2,"retryDelayMs":0,"maxRetryDelayMs":0},"errorRetry":{"maxNumRetry":2,"retryDelayMs":1e3,"maxRetryDelayMs":8e3}}},"fragLoadPolicy":{"default":{"maxTimeToFirstByteMs":1e4,"maxLoadTimeMs":12e4,"timeoutRetry":{"maxNumRetry":4,"retryDelayMs":0,"maxRetryDelayMs":0},"errorRetry":{"maxNumRetry":6,"retryDelayMs":1e3,"maxRetryDelayMs":8e3}}},"steeringManifestLoadPolicy":{"default":{"maxTimeToFirstByteMs":1e4,"maxLoadTimeMs":2e4,"timeoutRetry":{"maxNumRetry":2,"retryDelayMs":0,"maxRetryDelayMs":0},"errorRetry":{"maxNumRetry":1,"retryDelayMs":1e3,"maxRetryDelayMs":8e3}}},"manifestLoadingTimeOut":1e4,"manifestLoadingMaxRetry":1,"manifestLoadingRetryDelay":1e3,"manifestLoadingMaxRetryTimeout":64e3,"levelLoadingTimeOut":1e4,"levelLoadingMaxRetry":4,"levelLoadingRetryDelay":1e3,"levelLoadingMaxRetryTimeout":64e3,"fragLoadingTimeOut":2e4,"fragLoadingMaxRetry":6,"fragLoadingRetryDelay":1e3,"fragLoadingMaxRetryTimeout":64e3},function timelineConfig(){return{"cueHandler":xt,"enableWebVTT":!0,"enableIMSC1":!0,"enableCEA708Captions":!0,"captionsTextTrack1Label":"English","captionsTextTrack1LanguageCode":"en","captionsTextTrack2Label":"Spanish","captionsTextTrack2LanguageCode":"es","captionsTextTrack3Label":"Unknown CC","captionsTextTrack3LanguageCode":"","captionsTextTrack4Label":"Unknown CC","captionsTextTrack4LanguageCode":"","renderTextTracksNatively":!0}}()),{},{"subtitleStreamController":class SubtitleStreamController extends BaseStreamController{"constructor"(e,t,s){super(e,t,s,"[subtitle-stream-controller]",ie),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}"onHandlerDestroying"(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}"_registerListeners"(){const{"hls":e}=this;e.on(f.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(f.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.LEVEL_LOADED,this.onLevelLoaded,this),e.on(f.ERROR,this.onError,this),e.on(f.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(f.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(f.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(f.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(f.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(f.FRAG_BUFFERED,this.onFragBuffered,this)}"_unregisterListeners"(){const{"hls":e}=this;e.off(f.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(f.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.LEVEL_LOADED,this.onLevelLoaded,this),e.off(f.ERROR,this.onError,this),e.off(f.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(f.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(f.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(f.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(f.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(f.FRAG_BUFFERED,this.onFragBuffered,this)}"startLoad"(e){this.stopLoad(),this.state=Ie,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}"onManifestLoading"(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}"onMediaDetaching"(){this.tracksBuffered=[],super.onMediaDetaching()}"onLevelLoaded"(e,t){this.mainDetails=t.details}"onSubtitleFragProcessed"(e,t){const{"frag":s,"success":i}=t;if(this.fragPrevious=s,this.state=Ie,!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let n;const a=s.start;for(let e=0;e<r.length;e++)if(a>=r[e].start&&a<=r[e].end){n=r[e];break}const o=s.start+s.duration;n?n.end=o:(n={"start":a,"end":o},r.push(n)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null)}"onBufferFlushing"(e,t){const{"startOffset":s,"endOffset":i}=t;if(0===s&&i!==Number.POSITIVE_INFINITY){const e=i-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach((t=>{for(let s=0;s<t.length;)if(t[s].end<=e)t.shift();else{if(!(t[s].start<e))break;t[s].start=e,s++}})),this.fragmentTracker.removeFragmentsInRange(s,e,ie)}}"onFragBuffered"(e,t){var s;this.loadedmetadata||t.frag.type!==te||null!=(s=this.media)&&s.buffered.length&&(this.loadedmetadata=!0)}"onError"(e,t){const s=t.frag;(null==s?void 0:s.type)===ie&&(t.details===m.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Ce&&(this.state=Ie))}"onSubtitleTracksUpdated"(e,{"subtitleTracks":t}){this.levels&&subtitleOptionsIdentical(this.levels,t)?this.levels=t.map((e=>new Level(e))):(this.tracksBuffered=[],this.levels=t.map((e=>{const t=new Level(e);return this.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ie),this.fragPrevious=null,this.mediaBuffer=null)}"onSubtitleTrackSwitch"(e,t){var s;if(this.currentTrackId=t.id,null==(s=this.levels)||!s.length||-1===this.currentTrackId)return void this.clearInterval();const i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(500)}"onSubtitleTrackLoaded"(e,t){var s;const{"currentTrackId":i,"levels":r}=this,{"details":n,"id":a}=t;if(!r)return void this.warn(`Subtitle tracks were reset while loading level ${a}`);const o=r[a];if(a>=r.length||!o)return;this.log(`Subtitle track ${a} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(n.live||null!=(s=o.details)&&s.live){const e=this.mainDetails;if(n.deltaUpdateFailed||!e)return;const t=e.fragments[0];var d;if(o.details)l=this.alignPlaylists(n,o.details,null==(d=this.levelLastLoaded)?void 0:d.details),0===l&&t&&(l=t.start,addSliding(n,l));else n.hasProgramDateTime&&e.hasProgramDateTime?(alignMediaPlaylistByPDT(n,e),l=n.fragments[0].start):t&&(l=t.start,addSliding(n,l))}if(o.details=n,this.levelLastLoaded=o,a===i&&(this.startFragRequested||!this.mainDetails&&n.live||this.setStartPosition(this.mainDetails||n,l),this.tick(),n.live&&!this.fragCurrent&&this.media&&this.state===Ie)){findFragmentByPTS(null,n.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}"_handleFragmentLoadComplete"(e){const{"frag":t,"payload":s}=e,i=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&null!=i&&i.key&&i.iv&&"AES-128"===i.method){const e=performance.now();this.decrypter.decrypt(new Uint8Array(s),i.key.buffer,i.iv.buffer).catch((e=>{throw r.trigger(f.ERROR,{"type":g.MEDIA_ERROR,"details":m.FRAG_DECRYPT_ERROR,"fatal":!1,"error":e,"reason":e.message,"frag":t}),e})).then((s=>{const i=performance.now();r.trigger(f.FRAG_DECRYPTED,{"frag":t,"payload":s,"stats":{"tstart":e,"tdecrypt":i}})})).catch((e=>{this.warn(`${e.name}: ${e.message}`),this.state=Ie}))}}"doTick"(){if(this.media){if(this.state===Ie){const{"currentTrackId":e,"levels":t}=this,s=null==t?void 0:t[e];if(!s||!t.length||!s.details)return;const{"config":i}=this,r=this.getLoadPosition(),n=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{"end":a,"len":o}=n,l=this.getFwdBufferInfo(this.media,te),d=s.details;if(o>this.getMaxBufferLength(null==l?void 0:l.len)+d.levelTargetDuration)return;const h=d.fragments,c=h.length,u=d.edge;let f=null;const g=this.fragPrevious;if(a<u){const e=i.maxFragLookUpTolerance,t=a>u-e?0:e;f=findFragmentByPTS(g,h,Math.max(h[0].start,a),t),!f&&g&&g.start<h[0].start&&(f=h[0])}else f=h[c-1];if(!f)return;if(f=this.mapToInitFragWhenRequired(f),"initSegment"!==f.sn){const e=h[f.sn-d.startSN-1];e&&e.cc===f.cc&&this.fragmentTracker.getState(e)===Le&&(f=e)}this.fragmentTracker.getState(f)===Le&&this.loadFragment(f,s,a)}}else this.state=Ie}"getMaxBufferLength"(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}"loadFragment"(e,t,s){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,s))}get"mediaBufferTimeRanges"(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}},"subtitleTrackController":class SubtitleTrackController extends BasePlaylistController{"constructor"(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=filterSubtitleTracks(this.media.textTracks);for(let s=0;s<t.length;s++)if("hidden"===t[s].mode)e=t[s];else if("showing"===t[s].mode){e=t[s];break}const s=this.findTrackForTextTrack(e);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}"destroy"(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get"subtitleDisplay"(){return this._subtitleDisplay}set"subtitleDisplay"(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}"registerListeners"(){const{"hls":e}=this;e.on(f.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(f.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.MANIFEST_PARSED,this.onManifestParsed,this),e.on(f.LEVEL_LOADING,this.onLevelLoading,this),e.on(f.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(f.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(f.ERROR,this.onError,this)}"unregisterListeners"(){const{"hls":e}=this;e.off(f.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(f.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.MANIFEST_PARSED,this.onManifestParsed,this),e.off(f.LEVEL_LOADING,this.onLevelLoading,this),e.off(f.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(f.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(f.ERROR,this.onError,this)}"onMediaAttached"(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}"pollTrackChange"(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}"onMediaDetaching"(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);filterSubtitleTracks(this.media.textTracks).forEach((e=>{clearCurrentCues(e)})),this.subtitleTrack=-1,this.media=null}"onManifestLoading"(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}"onManifestParsed"(e,t){this.tracks=t.subtitleTracks}"onSubtitleTrackLoaded"(e,t){const{"id":s,"groupId":i,"details":r}=t,n=this.tracksInGroup[s];if(!n||n.groupId!==i)return void this.warn(`Subtitle track with id:${s} and group:${i} not found in active group ${null==n?void 0:n.groupId}`);const a=n.details;n.details=t.details,this.log(`Subtitle track ${s} "${n.name}" lang:${n.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}"onLevelLoading"(e,t){this.switchLevel(t.level)}"onLevelSwitching"(e,t){this.switchLevel(t.level)}"switchLevel"(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||(null==i?void 0:i.length)!==(null==s?void 0:s.length)||null!=s&&s.some((e=>-1===(null==i?void 0:i.indexOf(e))))){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!s||-1!==s.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!r&&t){this.selectDefaultTrack=!1;const s=findMatchingOption(t,e);if(s>-1)r=e[s];else{const e=findMatchingOption(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const n={"subtitleTracks":e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==s?void 0:s.join(",")}" group-id`),this.hls.trigger(f.SUBTITLE_TRACKS_UPDATED,n),-1!==i&&-1===this.trackId&&this.setSubtitleTrack(i)}else this.shouldReloadPlaylist(r)&&this.setSubtitleTrack(this.trackId)}"findTrackId"(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const r=t[i];if((!s||r.default)&&(s||e)&&(!e||matchesOption(r,e)))return i}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(mediaAttributesIdentical(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(mediaAttributesIdentical(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}"findTrackForTextTrack"(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){if(subtitleTrackMatchesTextTrack(t[s],e))return s}}return-1}"onError"(e,t){!t.fatal&&t.context&&(t.context.type!==ee||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get"allSubtitleTracks"(){return this.tracks}get"subtitleTracks"(){return this.tracksInGroup}get"subtitleTrack"(){return this.trackId}set"subtitleTrack"(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}"setSubtitleOption"(e){if(this.hls.config.subtitlePreference=e,e){const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&matchesOption(e,s))return s;const i=findMatchingOption(e,this.tracksInGroup);if(i>-1){const e=this.tracksInGroup[i];return this.setSubtitleTrack(i),e}if(s)return null;{const s=findMatchingOption(e,t);if(s>-1)return t[s]}}}return null}"loadPlaylist"(e){super.loadPlaylist();const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){const s=t.id,i=t.groupId;let r=t.url;if(e)try{r=e.addDirectives(r)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`Loading subtitle playlist for id ${s}`),this.hls.trigger(f.SUBTITLE_TRACK_LOADING,{"url":r,"id":s,"groupId":i,"deliveryDirectives":e||null})}}"toggleTrackModes"(){const{"media":e}=this;if(!e)return;const t=filterSubtitleTracks(e.textTracks),s=this.currentTrack;let i;if(s&&(i=t.filter((e=>subtitleTrackMatchesTextTrack(s,e)))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach((e=>{"disabled"!==e.mode&&e!==i&&(e.mode="disabled")})),i){const e=this.subtitleDisplay?"showing":"hidden";i.mode!==e&&(i.mode=e)}}"setSubtitleTrack"(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!h(e))return void this.warn(`Invalid subtitle track id: ${e}`);this.clearTimer(),this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i)return void this.hls.trigger(f.SUBTITLE_TRACK_SWITCH,{"id":e});const r=!!i.details&&!i.details.live;if(e===this.trackId&&i===s&&r)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{"id":n,"groupId":a="","name":o,"type":l,"url":d}=i;this.hls.trigger(f.SUBTITLE_TRACK_SWITCH,{"id":n,"groupId":a,"name":o,"type":l,"url":d});const c=this.switchParams(i.url,null==s?void 0:s.details,i.details);this.loadPlaylist(c)}},"timelineController":class TimelineController{"constructor"(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={"ccOffset":0,"presentationOffset":0,"0":{"start":0,"prevCC":-1,"new":!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={"textTrack1":{"label":this.config.captionsTextTrack1Label,"languageCode":this.config.captionsTextTrack1LanguageCode},"textTrack2":{"label":this.config.captionsTextTrack2Label,"languageCode":this.config.captionsTextTrack2LanguageCode},"textTrack3":{"label":this.config.captionsTextTrack3Label,"languageCode":this.config.captionsTextTrack3LanguageCode},"textTrack4":{"label":this.config.captionsTextTrack4Label,"languageCode":this.config.captionsTextTrack4LanguageCode}},e.on(f.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(f.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(f.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(f.FRAG_LOADING,this.onFragLoading,this),e.on(f.FRAG_LOADED,this.onFragLoaded,this),e.on(f.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(f.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(f.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(f.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(f.BUFFER_FLUSHING,this.onBufferFlushing,this)}"destroy"(){const{"hls":e}=this;e.off(f.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(f.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(f.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(f.FRAG_LOADING,this.onFragLoading,this),e.off(f.FRAG_LOADED,this.onFragLoaded,this),e.off(f.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(f.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(f.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(f.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(f.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}"initCea608Parsers"(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new OutputFilter(this,"textTrack1"),t=new OutputFilter(this,"textTrack2"),s=new OutputFilter(this,"textTrack3"),i=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,e,t),this.cea608Parser2=new Cea608Parser(3,s,i)}}"addCues"(e,t,s,i,r){let n=!1;for(let e=r.length;e--;){const i=r[e],h=(a=i[0],o=i[1],l=t,d=s,Math.min(o,d)-Math.max(a,l));if(h>=0&&(i[0]=Math.min(i[0],t),i[1]=Math.max(i[1],s),n=!0,h/(s-t)>.5))return}var a,o,l,d;if(n||r.push([t,s]),this.config.renderTextTracksNatively){const r=this.captionsTracks[e];this.Cues.newCue(r,t,s,i)}else{const r=this.Cues.newCue(null,t,s,i);this.hls.trigger(f.CUES_PARSED,{"type":"captions","cues":r,"track":e})}}"onInitPtsFound"(e,{"frag":t,"id":s,"initPTS":i,"timescale":r}){const{"unparsedVttFrags":n}=this;"main"===s&&(this.initPTS[t.cc]={"baseTime":i,"timescale":r}),n.length&&(this.unparsedVttFrags=[],n.forEach((e=>{this.onFragLoaded(f.FRAG_LOADED,e)})))}"getExistingTrack"(e,t){const{"media":s}=this;if(s)for(let i=0;i<s.textTracks.length;i++){const r=s.textTracks[i];if(canReuseVttTextTrack(r,{"name":e,"lang":t,"attrs":{}}))return r}return null}"createCaptionsTrack"(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}"createNativeTrack"(e){if(this.captionsTracks[e])return;const{"captionsProperties":t,"captionsTracks":s,"media":i}=this,{"label":r,"languageCode":n}=t[e],a=this.getExistingTrack(r,n);if(a)s[e]=a,clearCurrentCues(s[e]),sendAddTrackEvent(s[e],i);else{const t=this.createTextTrack("captions",r,n);t&&(t[e]=!0,s[e]=t)}}"createNonNativeTrack"(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s={"_id":e,"label":t.label,"kind":"captions","default":!!t.media&&!!t.media.default,"closedCaptions":t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(f.NON_NATIVE_TEXT_TRACKS_FOUND,{"tracks":[s]})}"createTextTrack"(e,t,s){const i=this.media;if(i)return i.addTextTrack(e,t,s)}"onMediaAttaching"(e,t){this.media=t.media,this._cleanTracks()}"onMediaDetaching"(){const{"captionsTracks":e}=this;Object.keys(e).forEach((t=>{clearCurrentCues(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}}"onManifestLoading"(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={"ccOffset":0,"presentationOffset":0,"0":{"start":0,"prevCC":-1,"new":!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}"_cleanTracks"(){const{"media":e}=this;if(!e)return;const t=e.textTracks;if(t)for(let e=0;e<t.length;e++)clearCurrentCues(t[e])}"onSubtitleTracksUpdated"(e,t){const s=t.subtitleTracks||[],i=s.some((e=>e.textCodec===pt));if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,s))return void(this.tracks=s);if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const e=this.media,t=e?filterSubtitleTracks(e.textTracks):null;if(this.tracks.forEach(((e,s)=>{let i;if(t){let s=null;for(let i=0;i<t.length;i++)if(t[i]&&canReuseVttTextTrack(t[i],e)){s=t[i],t[i]=null;break}s&&(i=s)}if(i)clearCurrentCues(i);else{const t=captionsOrSubtitlesFromCharacteristics(e);i=this.createTextTrack(t,e.name,e.lang),i&&(i.mode="disabled")}i&&this.textTracks.push(i)})),null!=t&&t.length){const e=t.filter((e=>null!==e)).map((e=>e.label));e.length&&v.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const e=this.tracks.map((e=>({"label":e.name,"kind":e.type.toLowerCase(),"default":e.default,"subtitleTrack":e})));this.hls.trigger(f.NON_NATIVE_TEXT_TRACKS_FOUND,{"tracks":e})}}}"onManifestLoaded"(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const s=`textTrack${t[1]}`,i=this.captionsProperties[s];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}))}"closedCaptionsForLevel"(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}"onFragLoading"(e,t){if(this.enabled&&t.frag.type===te){var s,i;const{"cea608Parser1":e,"cea608Parser2":r,"lastSn":n}=this,{"cc":a,"sn":o}=t.frag,l=null!=(s=null==(i=t.part)?void 0:i.index)?s:-1;e&&r&&(o!==n+1||o===n&&l!==this.lastPartIndex+1||a!==this.lastCc)&&(e.reset(),r.reset()),this.lastCc=a,this.lastSn=o,this.lastPartIndex=l}}"onFragLoaded"(e,t){const{"frag":s,"payload":i}=t;if(s.type===ie)if(i.byteLength){const e=s.decryptdata,r="stats"in t;if(null==e||!e.encrypted||r){const e=this.tracks[s.level],r=this.vttCCs;r[s.cc]||(r[s.cc]={"start":s.start,"prevCC":this.prevCC,"new":!0},this.prevCC=s.cc),e&&e.textCodec===pt?this._parseIMSC1(s,i):this._parseVTTs(t)}}else this.hls.trigger(f.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":s,"error":new Error("Empty subtitle payload")})}"_parseIMSC1"(e,t){const s=this.hls;parseIMSC1(t,this.initPTS[e.cc],(t=>{this._appendCues(t,e.level),s.trigger(f.SUBTITLE_FRAG_PROCESSED,{"success":!0,"frag":e})}),(t=>{v.log(`Failed to parse IMSC1: ${t}`),s.trigger(f.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":e,"error":t})}))}"_parseVTTs"(e){var t;const{"frag":s,"payload":i}=e,{"initPTS":r,"unparsedVttFrags":n}=this,a=r.length-1;if(!r[s.cc]&&-1===a)return void n.push(e);const o=this.hls;parseWebVTT(null!=(t=s.initSegment)&&t.data?appendUint8Array(s.initSegment.data,new Uint8Array(i)):i,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,(e=>{this._appendCues(e,s.level),o.trigger(f.SUBTITLE_FRAG_PROCESSED,{"success":!0,"frag":s})}),(t=>{const r="Missing initPTS for VTT MPEGTS"===t.message;r?n.push(e):this._fallbackToIMSC1(s,i),v.log(`Failed to parse VTT cue: ${t}`),r&&a>s.cc||o.trigger(f.SUBTITLE_FRAG_PROCESSED,{"success":!1,"frag":s,"error":t})}))}"_fallbackToIMSC1"(e,t){const s=this.tracks[e.level];s.textCodec||parseIMSC1(t,this.initPTS[e.cc],(()=>{s.textCodec=pt,this._parseIMSC1(e,t)}),(()=>{s.textCodec="wvtt"}))}"_appendCues"(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||"disabled"===s.mode)return;e.forEach((e=>addCueToTrack(s,e)))}else{const i=this.tracks[t];if(!i)return;const r=i.default?"default":"subtitles"+t;s.trigger(f.CUES_PARSED,{"type":"subtitles","cues":e,"track":r})}}"onFragDecrypted"(e,t){const{"frag":s}=t;s.type===ie&&this.onFragLoaded(f.FRAG_LOADED,t)}"onSubtitleTracksCleared"(){this.tracks=[],this.captionsTracks={}}"onFragParsingUserdata"(e,t){this.initCea608Parsers();const{"cea608Parser1":s,"cea608Parser2":i}=this;if(!this.enabled||!s||!i)return;const{"frag":r,"samples":n}=t;if(r.type!==te||"NONE"!==this.closedCaptionsForLevel(r))for(let e=0;e<n.length;e++){const t=n[e].bytes;if(t){const r=this.extractCea608Data(t);s.addData(n[e].pts,r[0]),i.addData(n[e].pts,r[1])}}}"onBufferFlushing"(e,{"startOffset":t,"endOffset":s,"endOffsetSubtitles":i,"type":r}){const{"media":n}=this;if(n&&!(n.currentTime<s)){if(!r||"video"===r){const{"captionsTracks":e}=this;Object.keys(e).forEach((i=>removeCuesInRange(e[i],t,s)))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==i){const{"textTracks":e}=this;Object.keys(e).forEach((s=>removeCuesInRange(e[s],t,i)))}}}"extractCea608Data"(e){const t=[[],[]],s=31&e[0];let i=2;for(let r=0;r<s;r++){const s=e[i++],r=127&e[i++],n=127&e[i++];if(0===r&&0===n)continue;if(!!(4&s)){const e=3&s;0!==e&&1!==e||(t[e].push(r),t[e].push(n))}}return t}},"audioStreamController":class AudioStreamController extends BaseStreamController{"constructor"(e,t,s){super(e,t,s,"[audio-stream-controller]",se),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}"onHandlerDestroying"(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}"_registerListeners"(){const{"hls":e}=this;e.on(f.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(f.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.LEVEL_LOADED,this.onLevelLoaded,this),e.on(f.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(f.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(f.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(f.ERROR,this.onError,this),e.on(f.BUFFER_RESET,this.onBufferReset,this),e.on(f.BUFFER_CREATED,this.onBufferCreated,this),e.on(f.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(f.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(f.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(f.FRAG_BUFFERED,this.onFragBuffered,this)}"_unregisterListeners"(){const{"hls":e}=this;e.off(f.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(f.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.LEVEL_LOADED,this.onLevelLoaded,this),e.off(f.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(f.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(f.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(f.ERROR,this.onError,this),e.off(f.BUFFER_RESET,this.onBufferReset,this),e.off(f.BUFFER_CREATED,this.onBufferCreated,this),e.off(f.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(f.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(f.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(f.FRAG_BUFFERED,this.onFragBuffered,this)}"onInitPtsFound"(e,{"frag":t,"id":s,"initPTS":i,"timescale":r}){if("main"===s){const e=t.cc;this.initPTS[t.cc]={"baseTime":i,"timescale":r},this.log(`InitPTS for cc: ${e} found from main: ${i}`),this.videoTrackCC=e,this.state===Ne&&this.tick()}}"startLoad"(e){if(!this.levels)return this.startPosition=e,void(this.state=Ce);const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=Ie):(this.loadedmetadata=!1,this.state=_e),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}"doTick"(){switch(this.state){case Ie:this.doTickIdle();break;case _e:{var e;const{"levels":t,"trackId":s}=this,i=null==t||null==(e=t[s])?void 0:e.details;if(i){if(this.waitForCdnTuneIn(i))break;this.state=Ne}break}case xe:{var t;const e=performance.now(),s=this.retryDate;if(!s||e>=s||null!=(t=this.media)&&t.seeking){const{"levels":e,"trackId":t}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==e?void 0:e[t])||null),this.state=Ie}break}case Ne:{const e=this.waitingData;if(e){const{"frag":t,"part":s,"cache":i,"complete":r}=e;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=we;const e={"frag":t,"part":s,"payload":i.flush(),"networkDetails":null};this._handleFragmentLoadProgress(e),r&&super._handleFragmentLoadComplete(e)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${t.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const e=this.getLoadPosition(),s=BufferHelper.bufferInfo(this.mediaBuffer,e,this.config.maxBufferHole);fragmentWithinToleranceTest(s.end,this.config.maxFragLookUpTolerance,t)<0&&(this.log(`Waiting fragment cc (${t.cc}) @ ${t.start} cancelled because another fragment at ${s.end} is needed`),this.clearWaitingFragment())}}else this.state=Ie}}this.onTickEnd()}"clearWaitingFragment"(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Ie)}"resetLoadingState"(){this.clearWaitingFragment(),super.resetLoadingState()}"onTickEnd"(){const{"media":e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}"doTickIdle"(){const{"hls":e,"levels":t,"media":s,"trackId":i}=this,r=e.config;if(!this.buffering||!s&&(this.startFragRequested||!r.startFragPrefetch)||null==t||!t[i])return;const n=t[i],a=n.details;if(!a||a.live&&this.levelLastLoaded!==n||this.waitForCdnTuneIn(a))return void(this.state=_e);const o=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,L,se));const l=this.getFwdBufferInfo(o,se);if(null===l)return;if(!this.switchingTrack&&this._streamEnded(l,a))return e.trigger(f.BUFFER_EOS,{"type":"audio"}),void(this.state=Oe);const d=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,te),h=l.len,c=this.getMaxBufferLength(null==d?void 0:d.len),u=a.fragments,g=u[0].start,m=this.getLoadPosition(),p=this.flushing?m:l.end;if(this.switchingTrack&&s){const e=m;a.PTSKnown&&e<g&&(l.end>g||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=g+.05)}if(h>=c&&!this.switchingTrack&&p<u[u.length-1].start)return;let y=this.getNextFragment(p,a),T=!1;if(y&&this.isLoopLoading(y,p)&&(T=!!y.gap,y=this.getNextFragmentLoopLoading(y,a,l,te,c)),!y)return void(this.bufferFlushed=!0);const v=d&&y.start>d.end+a.targetduration;if(v||(null==d||!d.len)&&l.len){const e=this.getAppendedFrag(y.start,te);if(null===e)return;if(T||(T=!!e.gap||!!v&&0===d.len),v&&!T||T&&l.nextStart&&l.nextStart<e.end)return}this.loadFragment(y,n,p)}"getMaxBufferLength"(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}"onMediaDetaching"(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}"onAudioTracksUpdated"(e,{"audioTracks":t}){this.resetTransmuxer(),this.levels=t.map((e=>new Level(e)))}"onAudioTrackSwitching"(e,t){const s=!!t.url;this.trackId=t.id;const{"fragCurrent":i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),s?this.setInterval(100):this.resetTransmuxer(),s?(this.switchingTrack=t,this.state=Ie,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=Ce),this.tick()}"onManifestLoading"(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}"onLevelLoaded"(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(f.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}"onAudioTrackLoaded"(e,t){var s;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=t);const{"levels":i}=this,{"details":r,"id":n}=t;if(!i)return void this.warn(`Audio tracks were reset while loading level ${n}`);this.log(`Audio track ${n} loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const a=i[n];let o=0;if(r.live||null!=(s=a.details)&&s.live){this.checkLiveUpdate(r);const e=this.mainDetails;if(r.deltaUpdateFailed||!e)return;var l;if(!a.details&&r.hasProgramDateTime&&e.hasProgramDateTime)alignMediaPlaylistByPDT(r,e),o=r.fragments[0].start;else o=this.alignPlaylists(r,a.details,null==(l=this.levelLastLoaded)?void 0:l.details)}a.details=r,this.levelLastLoaded=a,this.startFragRequested||!this.mainDetails&&r.live||this.setStartPosition(this.mainDetails||r,o),this.state!==_e||this.waitForCdnTuneIn(r)||(this.state=Ie),this.tick()}"_handleFragmentLoadProgress"(e){var t;const{"frag":s,"part":i,"payload":r}=e,{"config":n,"trackId":a,"levels":o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const d=l.details;if(!d)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(s.start);const h=n.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let c=this.transmuxer;c||(c=this.transmuxer=new TransmuxerInterface(this.hls,se,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const u=this.initPTS[s.cc],f=null==(t=s.initSegment)?void 0:t.data;if(void 0!==u){const e=!1,t=i?i.index:-1,n=-1!==t,a=new ChunkMetadata(s.level,s.sn,s.stats.chunkCount,r.byteLength,t,n);c.push(r,f,h,"",s,i,d.totalduration,e,a,u)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${d.startSN} ,${d.endSN}],track ${a}`);const{"cache":e}=this.waitingData=this.waitingData||{"frag":s,"part":i,"cache":new ChunkCache,"complete":!1};e.push(new Uint8Array(r)),this.waitingVideoCC=this.videoTrackCC,this.state=Ne}}"_handleFragmentLoadComplete"(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}"onBufferReset"(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}"onBufferCreated"(e,t){const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}"onFragBuffered"(e,t){const{"frag":s,"part":i}=t;if(s.type===se)if(this.fragContextChanged(s))this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==s.sn){this.fragPrevious=s;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(f.AUDIO_TRACK_SWITCHED,_objectSpread2({},e)))}this.fragBufferedComplete(s,i)}else if(!this.loadedmetadata&&s.type===te){const e=this.videoBuffer||this.media;if(e){BufferHelper.getBuffered(e).length&&(this.loadedmetadata=!0)}}}"onError"(e,t){var s;if(t.fatal)this.state=Ue;else switch(t.details){case m.FRAG_GAP:case m.FRAG_PARSING_ERROR:case m.FRAG_DECRYPT_ERROR:case m.FRAG_LOAD_ERROR:case m.FRAG_LOAD_TIMEOUT:case m.KEY_LOAD_ERROR:case m.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(se,t);break;case m.AUDIO_TRACK_LOAD_ERROR:case m.AUDIO_TRACK_LOAD_TIMEOUT:case m.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==_e||(null==(s=t.context)?void 0:s.type)!==Z||(this.state=Ie);break;case m.BUFFER_APPEND_ERROR:case m.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;if(t.details===m.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case m.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}"onBufferFlushing"(e,{"type":t}){t!==A&&(this.flushing=!0)}"onBufferFlushed"(e,{"type":t}){if(t!==A){this.flushing=!1,this.bufferFlushed=!0,this.state===Oe&&(this.state=Ie);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,se),this.tick())}}"_handleTransmuxComplete"(e){var t;const s="audio",{"hls":i}=this,{"remuxResult":r,"chunkMeta":n}=e,a=this.getCurrentContext(n);if(!a)return void this.resetWhenMissingContext(n);const{"frag":o,"part":l,"level":d}=a,{"details":h}=d,{"audio":c,"text":u,"id3":g,"initSegment":m}=r;if(!this.fragContextChanged(o)&&h){if(this.state=Me,this.switchingTrack&&c&&this.completeAudioSwitch(this.switchingTrack),null!=m&&m.tracks){const e=o.initSegment||o;this._bufferInitSegment(d,m.tracks,e,n),i.trigger(f.FRAG_PARSING_INIT_SEGMENT,{"frag":e,"id":s,"tracks":m.tracks})}if(c){const{"startPTS":e,"endPTS":t,"startDTS":s,"endDTS":i}=c;l&&(l.elementaryStreams[L]={"startPTS":e,"endPTS":t,"startDTS":s,"endDTS":i}),o.setElementaryStreamInfo(L,e,t,s,i),this.bufferFragmentData(c,o,l,n)}if(null!=g&&null!=(t=g.samples)&&t.length){const e=_extends({"id":s,"frag":o,"details":h},g);i.trigger(f.FRAG_PARSING_METADATA,e)}if(u){const e=_extends({"id":s,"frag":o,"details":h},u);i.trigger(f.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}"_bufferInitSegment"(e,t,s,i){if(this.state!==Me)return;t.video&&delete t.video;const r=t.audio;if(!r)return;r.id="audio";const n=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${n}/${r.codec}]`),n&&1===n.split(",").length&&(r.levelCodec=n),this.hls.trigger(f.BUFFER_CODECS,t);const a=r.initSegment;if(null!=a&&a.byteLength){const e={"type":"audio","frag":s,"part":null,"chunkMeta":i,"parent":s.type,"data":a};this.hls.trigger(f.BUFFER_APPENDING,e)}this.tickImmediate()}"loadFragment"(e,t,s){const i=this.fragmentTracker.getState(e);var r;if(this.fragCurrent=e,this.switchingTrack||i===Le||i===Re)if("initSegment"===e.sn)this._loadInitSegment(e,t);else if(null!=(r=t.details)&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Ne;const s=this.mainDetails;s&&s.fragments[0].start!==t.details.fragments[0].start&&alignMediaPlaylistByPDT(t.details,s)}else this.startFragRequested=!0,super.loadFragment(e,t,s);else this.clearTrackerIfNeeded(e)}"flushAudioIfNeeded"(e){if(this.media&&this.bufferedTrack){const{"name":t,"lang":s,"assocLang":i,"characteristics":r,"audioCodec":n,"channels":a}=this.bufferedTrack;matchesOption({"name":t,"lang":s,"assocLang":i,"characteristics":r,"audioCodec":n,"channels":a},e,audioMatchPredicate)||(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}}"completeAudioSwitch"(e){const{"hls":t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(f.AUDIO_TRACK_SWITCHED,_objectSpread2({},e))}},"audioTrackController":class AudioTrackController extends BasePlaylistController{"constructor"(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}"registerListeners"(){const{"hls":e}=this;e.on(f.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.MANIFEST_PARSED,this.onManifestParsed,this),e.on(f.LEVEL_LOADING,this.onLevelLoading,this),e.on(f.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(f.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(f.ERROR,this.onError,this)}"unregisterListeners"(){const{"hls":e}=this;e.off(f.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.MANIFEST_PARSED,this.onManifestParsed,this),e.off(f.LEVEL_LOADING,this.onLevelLoading,this),e.off(f.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(f.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(f.ERROR,this.onError,this)}"destroy"(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}"onManifestLoading"(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}"onManifestParsed"(e,t){this.tracks=t.audioTracks||[]}"onAudioTrackLoaded"(e,t){const{"id":s,"groupId":i,"details":r}=t,n=this.tracksInGroup[s];if(!n||n.groupId!==i)return void this.warn(`Audio track with id:${s} and group:${i} not found in active group ${null==n?void 0:n.groupId}`);const a=n.details;n.details=t.details,this.log(`Audio track ${s} "${n.name}" lang:${n.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,a)}"onLevelLoading"(e,t){this.switchLevel(t.level)}"onLevelSwitching"(e,t){this.switchLevel(t.level)}"switchLevel"(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||(null==i?void 0:i.length)!==(null==s?void 0:s.length)||null!=s&&s.some((e=>-1===(null==i?void 0:i.indexOf(e))))){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter((e=>!s||-1!==s.indexOf(e.groupId)));if(e.length)this.selectDefaultTrack&&!e.some((e=>e.default))&&(this.selectDefaultTrack=!1),e.forEach(((e,t)=>{e.id=t}));else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!r&&t){const s=findMatchingOption(t,e,audioMatchPredicate);if(s>-1)r=e[s];else{const e=findMatchingOption(t,this.tracks);r=this.tracks[e]}}let i=this.findTrackId(r);-1===i&&r&&(i=this.findTrackId(null));const a={"audioTracks":e};this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==s?void 0:s.join(",")}`),this.hls.trigger(f.AUDIO_TRACKS_UPDATED,a);const o=this.trackId;if(-1!==i&&-1===o)this.setAudioTrack(i);else if(e.length&&-1===o){var n;const t=new Error(`No audio track selected for current audio group-ID(s): ${null==(n=this.groupIds)?void 0:n.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(f.ERROR,{"type":g.MEDIA_ERROR,"details":m.AUDIO_TRACK_LOAD_ERROR,"fatal":!0,"error":t})}}else this.shouldReloadPlaylist(r)&&this.setAudioTrack(this.trackId)}"onError"(e,t){!t.fatal&&t.context&&(t.context.type!==Z||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||(this.requestScheduled=-1,this.checkRetry(t)))}get"allAudioTracks"(){return this.tracks}get"audioTracks"(){return this.tracksInGroup}get"audioTrack"(){return this.trackId}set"audioTrack"(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}"setAudioOption"(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const i=this.currentTrack;if(i&&matchesOption(e,i,audioMatchPredicate))return i;const r=findMatchingOption(e,this.tracksInGroup,audioMatchPredicate);if(r>-1){const e=this.tracksInGroup[r];return this.setAudioTrack(r),e}if(i){let i=t.loadLevel;-1===i&&(i=t.firstAutoLevel);const r=function findClosestLevelWithAudioGroup(e,t,s,i,r){const n=t[i],a=t.reduce(((e,t,s)=>{const i=t.uri;return(e[i]||(e[i]=[])).push(s),e}),{})[n.uri];a.length>1&&(i=Math.max.apply(Math,a));const o=n.videoRange,l=n.frameRate,d=n.codecSet.substring(0,4),h=searchDownAndUpList(t,i,(t=>{if(t.videoRange!==o||t.frameRate!==l||t.codecSet.substring(0,4)!==d)return!1;const i=t.audioGroups,n=s.filter((e=>!i||-1!==i.indexOf(e.groupId)));return findMatchingOption(e,n,r)>-1}));return h>-1?h:searchDownAndUpList(t,i,(t=>{const i=t.audioGroups,n=s.filter((e=>!i||-1!==i.indexOf(e.groupId)));return findMatchingOption(e,n,r)>-1}))}(e,t.levels,s,i,audioMatchPredicate);if(-1===r)return null;t.nextLoadLevel=r}if(e.channels||e.audioCodec){const t=findMatchingOption(e,s);if(t>-1)return s[t]}}}return null}"setAudioTrack"(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn(`Invalid audio track id: ${e}`);this.clearTimer(),this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if(e===this.trackId&&i===s&&r)return;if(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(f.AUDIO_TRACK_SWITCHING,_objectSpread2({},i)),r)return;const n=this.switchParams(i.url,null==s?void 0:s.details,i.details);this.loadPlaylist(n)}"findTrackId"(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const i=t[s];if((!this.selectDefaultTrack||i.default)&&(!e||matchesOption(e,i,audioMatchPredicate)))return s}if(e){const{"name":s,"lang":i,"assocLang":r,"characteristics":n,"audioCodec":a,"channels":o}=e;for(let e=0;e<t.length;e++){if(matchesOption({"name":s,"lang":i,"assocLang":r,"characteristics":n,"audioCodec":a,"channels":o},t[e],audioMatchPredicate))return e}for(let s=0;s<t.length;s++){const i=t[s];if(mediaAttributesIdentical(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(mediaAttributesIdentical(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}"loadPlaylist"(e){const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();const s=t.id,i=t.groupId;let r=t.url;if(e)try{r=e.addDirectives(r)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}this.log(`loading audio-track playlist ${s} "${t.name}" lang:${t.lang} group:${i}`),this.clearTimer(),this.hls.trigger(f.AUDIO_TRACK_LOADING,{"url":r,"id":s,"groupId":i,"deliveryDirectives":e||null})}}},"emeController":EMEController,"cmcdController":class CMCDController{"constructor"(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{"ot":St.MANIFEST,"su":!this.initialized})}catch(e){v.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=e=>{try{const t=e.frag,s=this.hls.levels[t.level],i=this.getObjectType(t),r={"d":1e3*t.duration,"ot":i};i!==St.VIDEO&&i!==St.AUDIO&&i!=St.MUXED||(r.br=s.bitrate/1e3,r.tb=this.getTopBandwidth(i)/1e3,r.bl=this.getBufferLength(i)),this.apply(e,r)}catch(e){v.warn("Could not generate segment CMCD data.",e)}},this.hls=e;const t=this.config=e.config,{"cmcd":s}=t;null!=s&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||function uuid(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const s=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?s:3&s|8).toString(16)}))}}}(),this.cid=s.contentId,this.useHeaders=!0===s.useHeaders,this.includeKeys=s.includeKeys,this.registerListeners())}"registerListeners"(){const e=this.hls;e.on(f.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(f.MEDIA_DETACHED,this.onMediaDetached,this),e.on(f.BUFFER_CREATED,this.onBufferCreated,this)}"unregisterListeners"(){const e=this.hls;e.off(f.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(f.MEDIA_DETACHED,this.onMediaDetached,this),e.off(f.BUFFER_CREATED,this.onBufferCreated,this)}"destroy"(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}"onMediaAttached"(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}"onMediaDetached"(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}"onBufferCreated"(e,t){var s,i;this.audioBuffer=null==(s=t.tracks.audio)?void 0:s.buffer,this.videoBuffer=null==(i=t.tracks.video)?void 0:i.buffer}"createData"(){var e;return{"v":1,"sf":Lt.HLS,"sid":this.sid,"cid":this.cid,"pr":null==(e=this.media)?void 0:e.playbackRate,"mtp":this.hls.bandwidthEstimate/1e3}}"apply"(e,t={}){_extends(t,this.createData());const s=t.ot===St.INIT||t.ot===St.VIDEO||t.ot===St.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{"includeKeys":i}=this;i&&(t=Object.keys(t).reduce(((e,s)=>(i.includes(s)&&(e[s]=t[s]),e)),{})),this.useHeaders?(e.headers||(e.headers={}),appendCmcdHeaders(e.headers,t)):e.url=appendCmcdQuery(e.url,t)}"getObjectType"(e){const{"type":t}=e;return"subtitle"===t?St.TIMED_TEXT:"initSegment"===e.sn?St.INIT:"audio"===t?St.AUDIO:"main"===t?this.hls.audioTracks.length?St.VIDEO:St.MUXED:void 0}"getTopBandwidth"(e){let t,s=0;const i=this.hls;if(e===St.AUDIO)t=i.audioTracks;else{const e=i.maxAutoLevel,s=e>-1?e+1:i.levels.length;t=i.levels.slice(0,s)}for(const e of t)e.bitrate>s&&(s=e.bitrate);return s>0?s:NaN}"getBufferLength"(e){const t=this.hls.media,s=e===St.AUDIO?this.audioBuffer:this.videoBuffer;if(!s||!t)return NaN;return 1e3*BufferHelper.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len}"createPlaylistLoader"(){const{"pLoader":e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class CmcdPlaylistLoader{"constructor"(e){this.loader=void 0,this.loader=new s(e)}get"stats"(){return this.loader.stats}get"context"(){return this.loader.context}"destroy"(){this.loader.destroy()}"abort"(){this.loader.abort()}"load"(e,s,i){t(e),this.loader.load(e,s,i)}}}"createFragmentLoader"(){const{"fLoader":e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class CmcdFragmentLoader{"constructor"(e){this.loader=void 0,this.loader=new s(e)}get"stats"(){return this.loader.stats}get"context"(){return this.loader.context}"destroy"(){this.loader.destroy()}"abort"(){this.loader.abort()}"load"(e,s,i){t(e),this.loader.load(e,s,i)}}}},"contentSteeringController":class ContentSteeringController{"constructor"(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=v.log.bind(v,"[content-steering]:"),this.registerListeners()}"registerListeners"(){const e=this.hls;e.on(f.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(f.MANIFEST_PARSED,this.onManifestParsed,this),e.on(f.ERROR,this.onError,this)}"unregisterListeners"(){const e=this.hls;e&&(e.off(f.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(f.MANIFEST_PARSED,this.onManifestParsed,this),e.off(f.ERROR,this.onError,this))}"startLoad"(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}"stopLoad"(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}"clearTimeout"(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}"destroy"(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}"removeLevel"(e){const t=this.levels;t&&(this.levels=t.filter((t=>t!==e)))}"onManifestLoading"(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}"onManifestLoaded"(e,t){const{"contentSteering":s}=t;null!==s&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}"onManifestParsed"(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}"onError"(e,t){const{"errorAction":s}=t;if((null==s?void 0:s.action)===ge&&s.flags===Te){const e=this.levels;let i=this.pathwayPriority,r=this.pathwayId;if(t.context){const{"groupId":s,"pathwayId":i,"type":n}=t.context;s&&e?r=this.getPathwayForGroupId(s,n,r):i&&(r=i)}r in this.penalizedPathways||(this.penalizedPathways[r]=performance.now()),!i&&e&&(i=e.reduce(((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e)),[])),i&&i.length>1&&(this.updatePathwayPriority(i),s.resolved=this.pathwayId!==r),s.resolved||v.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${r} levels: ${e?e.length:e} priorities: ${JSON.stringify(i)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}"filterParsedLevels"(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}"getLevelsForPathway"(e){return null===this.levels?[]:this.levels.filter((t=>e===t.pathwayId))}"updatePathwayPriority"(e){let t;this.pathwayPriority=e;const s=this.penalizedPathways,i=performance.now();Object.keys(s).forEach((e=>{i-s[e]>3e5&&delete s[e]}));for(let i=0;i<e.length;i++){const r=e[i];if(r in s)continue;if(r===this.pathwayId)return;const n=this.hls.nextLoadLevel,a=this.hls.levels[n];if(t=this.getLevelsForPathway(r),t.length>0){this.log(`Setting Pathway to "${r}"`),this.pathwayId=r,reassignFragmentLevelIndexes(t),this.hls.trigger(f.LEVELS_UPDATED,{"levels":t});const e=this.hls.levels[n];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log(`Unstable Pathways change from bitrate ${a.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=n);break}}}"getPathwayForGroupId"(e,t,s){const i=this.getLevelsForPathway(s).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===Z&&i[s].hasAudioGroup(e)||t===ee&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return s}"clonePathways"(e){const t=this.levels;if(!t)return;const s={},i={};e.forEach((e=>{const{"ID":r,"BASE-ID":n,"URI-REPLACEMENT":a}=e;if(t.some((e=>e.pathwayId===r)))return;const o=this.getLevelsForPathway(n).map((e=>{const t=new AttrList(e.attrs);t["PATHWAY-ID"]=r;const n=t.AUDIO&&`${t.AUDIO}_clone_${r}`,o=t.SUBTITLES&&`${t.SUBTITLES}_clone_${r}`;n&&(s[t.AUDIO]=n,t.AUDIO=n),o&&(i[t.SUBTITLES]=o,t.SUBTITLES=o);const l=performUriReplacement(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),d=new Level({"attrs":t,"audioCodec":e.audioCodec,"bitrate":e.bitrate,"height":e.height,"name":e.name,"url":l,"videoCodec":e.videoCodec,"width":e.width});if(e.audioGroups)for(let t=1;t<e.audioGroups.length;t++)d.addGroupId("audio",`${e.audioGroups[t]}_clone_${r}`);if(e.subtitleGroups)for(let t=1;t<e.subtitleGroups.length;t++)d.addGroupId("text",`${e.subtitleGroups[t]}_clone_${r}`);return d}));t.push(...o),cloneRenditionGroups(this.audioTracks,s,a,r),cloneRenditionGroups(this.subtitleTracks,i,a,r)}))}"loadSteeringManifest"(e){const t=this.hls.config,s=t.loader;let i;this.loader&&this.loader.destroy(),this.loader=new s(t);try{i=new self.URL(e)}catch(t){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==i.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+e)}const r={"responseType":"json","url":i.href},n=t.steeringManifestLoadPolicy.default,a=n.errorRetry||n.timeoutRetry||{},o={"loadPolicy":n,"timeout":n.maxLoadTimeMs,"maxRetry":a.maxNumRetry||0,"retryDelay":a.retryDelayMs||0,"maxRetryDelay":a.maxRetryDelayMs||0},l={"onSuccess":(e,t,s,r)=>{this.log(`Loaded steering manifest: "${i}"`);const n=e.data;if(1!==n.VERSION)return void this.log(`Steering VERSION ${n.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=n.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=n;if(a)try{this.uri=new self.URL(a,i).href}catch(e){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${a}`)}this.scheduleRefresh(this.uri||s.url),o&&this.clonePathways(o);const d={"steeringManifest":n,"url":i.toString()};this.hls.trigger(f.STEERING_MANIFEST_LOADED,d),l&&this.updatePathwayPriority(l)},"onError":(e,t,s,i)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let r=1e3*this.timeToLoad;if(429!==e.code)this.scheduleRefresh(this.uri||t.url,r);else{const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(r=1e3*parseFloat(t))}this.log(`Steering manifest ${t.url} rate limited`)}},"onTimeout":(e,t,s)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(r,o,l)}"scheduleRefresh"(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout((()=>{var t;const s=null==(t=this.hls)?void 0:t.media;!s||s.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)}),t)}}});function deepCpy(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(deepCpy):Object.keys(e).reduce(((t,s)=>(t[s]=deepCpy(e[s]),t)),{}):e}function enableStreamingMode(e){const t=e.loader;if(t!==FetchLoader&&t!==XhrLoader)v.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1})()&&(e.loader=FetchLoader,e.progressive=!0,e.enableSoftwareAES=!0,v.log("[config]: Progressive streaming enabled, using FetchLoader"))}}let Mt;class LevelController extends BasePlaylistController{"constructor"(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}"_registerListeners"(){const{"hls":e}=this;e.on(f.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(f.LEVEL_LOADED,this.onLevelLoaded,this),e.on(f.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(f.FRAG_BUFFERED,this.onFragBuffered,this),e.on(f.ERROR,this.onError,this)}"_unregisterListeners"(){const{"hls":e}=this;e.off(f.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(f.LEVEL_LOADED,this.onLevelLoaded,this),e.off(f.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(f.FRAG_BUFFERED,this.onFragBuffered,this),e.off(f.ERROR,this.onError,this)}"destroy"(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}"stopLoad"(){this._levels.forEach((e=>{e.loadError=0,e.fragmentError=0})),super.stopLoad()}"resetLevels"(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}"onManifestLoading"(e,t){this.resetLevels()}"onManifestLoaded"(e,t){const s=this.hls.config.preferManagedMediaSource,i=[],r={},n={};let a=!1,o=!1,l=!1;t.levels.forEach((e=>{var t,d;const h=e.attrs;let{"audioCodec":c,"videoCodec":u}=e;-1!==(null==(t=c)?void 0:t.indexOf("mp4a.40.34"))&&(Mt||(Mt=/chrome|firefox/i.test(navigator.userAgent)),Mt&&(e.audioCodec=c=void 0)),c&&(e.audioCodec=c=getCodecCompatibleName(c,s)),0===(null==(d=u)?void 0:d.indexOf("avc1"))&&(u=e.videoCodec=function convertAVC1ToAVCOTI(e){const t=e.split(",");for(let e=0;e<t.length;e++){const s=t[e].split(".");if(s.length>2){let i=s.shift()+".";i+=parseInt(s.shift()).toString(16),i+=("000"+parseInt(s.shift()).toString(16)).slice(-4),t[e]=i}}return t.join(",")}(u));const{"width":f,"height":g,"unknownCodecs":m}=e;if(a||(a=!(!f||!g)),o||(o=!!u),l||(l=!!c),null!=m&&m.length||c&&!areCodecsMediaSourceSupported(c,"audio",s)||u&&!areCodecsMediaSourceSupported(u,"video",s))return;const{"CODECS":p,"FRAME-RATE":y,"HDCP-LEVEL":T,"PATHWAY-ID":v,"RESOLUTION":E,"VIDEO-RANGE":S}=h,L=`${`${v||"."}-`}${e.bitrate}-${E}-${y}-${p}-${S}-${T}`;if(r[L])if(r[L].uri===e.url||e.attrs["PATHWAY-ID"])r[L].addGroupId("audio",h.AUDIO),r[L].addGroupId("text",h.SUBTITLES);else{const t=n[L]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const s=new Level(e);r[L]=s,i.push(s)}else{const t=new Level(e);r[L]=t,n[L]=1,i.push(t)}})),this.filterAndSortMediaOptions(i,t,a,o,l)}"filterAndSortMediaOptions"(e,t,s,i,r){let n=[],a=[],o=e;if((s||i)&&r&&(o=o.filter((({"videoCodec":e,"videoRange":t,"width":s,"height":i})=>(!!e||!(!s||!i))&&function isVideoRange(e){return!!e&&de.indexOf(e)>-1}(t)))),0===o.length)return void Promise.resolve().then((()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);const e=new Error("no level with compatible codecs found in manifest");this.hls.trigger(f.ERROR,{"type":g.MEDIA_ERROR,"details":m.MANIFEST_INCOMPATIBLE_CODECS_ERROR,"fatal":!0,"url":t.url,"error":e,"reason":e.message})}}));if(t.audioTracks){const{"preferManagedMediaSource":e}=this.hls.config;n=t.audioTracks.filter((t=>!t.audioCodec||areCodecsMediaSourceSupported(t.audioCodec,"audio",e))),assignTrackIdsByGroup(n)}t.subtitles&&(a=t.subtitles,assignTrackIdsByGroup(a));const l=o.slice(0);o.sort(((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return de.indexOf(e.videoRange)-de.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const s=videoCodecPreferenceValue(e.videoCodec),i=videoCodecPreferenceValue(t.videoCodec);if(s!==i)return i-s}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const s=codecsSetSelectionPreferenceValue(e.codecSet),i=codecsSetSelectionPreferenceValue(t.codecSet);if(s!==i)return i-s}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0}));let d=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o),o.length!==l.length))for(let e=0;e<l.length;e++)if(l[e].pathwayId===o[0].pathwayId){d=l[e];break}this._levels=o;for(let e=0;e<o.length;e++)if(o[e]===d){var h;this._firstLevel=e;const t=d.bitrate,s=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${t}`),void 0===(null==(h=this.hls.userConfig)?void 0:h.abrEwmaDefaultEstimate)){const e=Math.min(t,this.hls.config.abrEwmaDefaultEstimateMax);e>s&&s===_t.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=e)}break}const c=r&&!i,u={"levels":o,"audioTracks":n,"subtitleTracks":a,"sessionData":t.sessionData,"sessionKeys":t.sessionKeys,"firstLevel":this._firstLevel,"stats":t.stats,"audio":r,"video":i,"altAudio":!c&&n.some((e=>!!e.url))};this.hls.trigger(f.MANIFEST_PARSED,u),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get"levels"(){return 0===this._levels.length?null:this._levels}get"level"(){return this.currentLevelIndex}set"level"(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const s=new Error("invalid level idx"),i=e<0;if(this.hls.trigger(f.ERROR,{"type":g.OTHER_ERROR,"details":m.LEVEL_SWITCH_ERROR,"level":e,"fatal":i,"error":s,"reason":s.message}),i)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,n=t[e],a=n.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=n,s===e&&n.details&&i&&r===a)return;this.log(`Switching to level ${e} (${n.height?n.height+"p ":""}${n.videoRange?n.videoRange+" ":""}${n.codecSet?n.codecSet+" ":""}@${n.bitrate})${a?" with Pathway "+a:""} from level ${s}${r?" with Pathway "+r:""}`);const o={"level":e,"attrs":n.attrs,"details":n.details,"bitrate":n.bitrate,"averageBitrate":n.averageBitrate,"maxBitrate":n.maxBitrate,"realBitrate":n.realBitrate,"width":n.width,"height":n.height,"codecSet":n.codecSet,"audioCodec":n.audioCodec,"videoCodec":n.videoCodec,"audioGroups":n.audioGroups,"subtitleGroups":n.subtitleGroups,"loaded":n.loaded,"loadError":n.loadError,"fragmentError":n.fragmentError,"name":n.name,"id":n.id,"uri":n.uri,"url":n.url,"urlId":0,"audioGroupIds":n.audioGroupIds,"textGroupIds":n.textGroupIds};this.hls.trigger(f.LEVEL_SWITCHING,o);const l=n.details;if(!l||l.live){const e=this.switchParams(n.uri,null==i?void 0:i.details,l);this.loadPlaylist(e)}}get"manualLevel"(){return this.manualLevelIndex}set"manualLevel"(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get"firstLevel"(){return this._firstLevel}set"firstLevel"(e){this._firstLevel=e}get"startLevel"(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set"startLevel"(e){this._startLevel=e}"onError"(e,t){!t.fatal&&t.context&&t.context.type===J&&t.context.level===this.level&&this.checkRetry(t)}"onFragBuffered"(e,{"frag":t}){if(void 0!==t&&t.type===te){const e=t.elementaryStreams;if(!Object.keys(e).some((t=>!!e[t])))return;const s=this._levels[t.level];null!=s&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}"onLevelLoaded"(e,t){var s;const{"level":i,"details":r}=t,n=this._levels[i];var a;if(!n)return this.warn(`Invalid level index ${i}`),void(null!=(a=t.deliveryDirectives)&&a.skip&&(r.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===n.fragmentError&&(n.loadError=0),this.playlistLoaded(i,t,n.details)):null!=(s=t.deliveryDirectives)&&s.skip&&(r.deltaUpdateFailed=!0)}"loadPlaylist"(e){super.loadPlaylist();const t=this.currentLevelIndex,s=this.currentLevel;if(s&&this.shouldLoadPlaylist(s)){let i=s.uri;if(e)try{i=e.addDirectives(i)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}const r=s.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""} with${r?" Pathway "+r:""} ${i}`),this.clearTimer(),this.hls.trigger(f.LEVEL_LOADING,{"url":i,"level":t,"pathwayId":s.attrs["PATHWAY-ID"],"id":0,"deliveryDirectives":e||null})}}get"nextLoadLevel"(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set"nextLoadLevel"(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}"removeLevel"(e){var t;const s=this._levels.filter(((t,s)=>s!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach((e=>e.level=-1))),!1)));reassignFragmentLevelIndexes(s),this._levels=s,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(f.LEVELS_UPDATED,{"levels":s})}"onLevelsUpdated"(e,{"levels":t}){this._levels=t}"checkMaxAutoUpdated"(){const{"autoLevelCapping":e,"maxAutoLevel":t,"maxHdcpLevel":s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(f.MAX_AUTO_LEVEL_UPDATED,{"autoLevelCapping":e,"levels":this.levels,"maxAutoLevel":t,"minAutoLevel":this.hls.minAutoLevel,"maxHdcpLevel":s}))}}function assignTrackIdsByGroup(e){const t={};e.forEach((e=>{const s=e.groupId||"";e.id=t[s]=t[s]||0,t[s]++}))}class KeyLoader{"constructor"(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}"abort"(e){for(const s in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[s].loader;if(i){var t;if(e&&e!==(null==(t=i.context)?void 0:t.frag.type))return;i.abort()}}}"detach"(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}"destroy"(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}"createKeyLoadError"(e,t=m.KEY_LOAD_ERROR,s,i,r){return new LoadError({"type":g.NETWORK_ERROR,"details":t,"fatal":!1,"frag":e,"response":r,"error":s,"networkDetails":i})}"loadClear"(e,t){if(this.emeController&&this.config.emeEnabled){const{"sn":s,"cc":i}=e;for(let e=0;e<t.length;e++){const r=t[e];if(i<=r.cc&&("initSegment"===s||"initSegment"===r.sn||s<r.sn)){this.emeController.selectKeySystemFormat(r).then((e=>{r.setKeyFormat(e)}));break}}}}"load"(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then((t=>this.loadInternal(e,t))):this.loadInternal(e)}"loadInternal"(e,t){var s,i;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const s=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,m.KEY_LOAD_ERROR,s))}const n=r.uri;if(!n)return Promise.reject(this.createKeyLoadError(e,m.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${n}"`)));let a=this.keyUriToKeyInfo[n];if(null!=(s=a)&&s.decryptdata.key)return r.key=a.decryptdata.key,Promise.resolve({"frag":e,"keyInfo":a});var o;if(null!=(i=a)&&i.keyLoadPromise)switch(null==(o=a.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then((t=>(r.key=t.keyInfo.decryptdata.key,{"frag":e,"keyInfo":a})))}switch(a=this.keyUriToKeyInfo[n]={"decryptdata":r,"keyLoadPromise":null,"loader":null,"mediaKeySessionContext":null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,m.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}"loadKeyEME"(e,t){const s={"frag":t,"keyInfo":e};if(this.emeController&&this.config.emeEnabled){const t=this.emeController.loadKey(s);if(t)return(e.keyLoadPromise=t.then((t=>(e.mediaKeySessionContext=t,s)))).catch((t=>{throw e.keyLoadPromise=null,t}))}return Promise.resolve(s)}"loadKeyHTTP"(e,t){const s=this.config,i=new(0,s.loader)(s);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise(((r,n)=>{const a={"keyInfo":e,"frag":t,"responseType":"arraybuffer","url":e.decryptdata.uri},o=s.keyLoadPolicy.default,l={"loadPolicy":o,"timeout":o.maxLoadTimeMs,"maxRetry":0,"retryDelay":0,"maxRetryDelay":0},d={"onSuccess":(e,t,s,i)=>{const{"frag":a,"keyInfo":o,"url":l}=s;if(!a.decryptdata||o!==this.keyUriToKeyInfo[l])return n(this.createKeyLoadError(a,m.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i));o.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,o.loader=null,r({"frag":a,"keyInfo":o})},"onError":(e,s,i,r)=>{this.resetLoader(s),n(this.createKeyLoadError(t,m.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),i,_objectSpread2({"url":a.url,"data":void 0},e)))},"onTimeout":(e,s,i)=>{this.resetLoader(s),n(this.createKeyLoadError(t,m.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),i))},"onAbort":(e,s,i)=>{this.resetLoader(s),n(this.createKeyLoadError(t,m.INTERNAL_ABORTED,new Error("key loading aborted"),i))}};i.load(a,l,d)}))}"resetLoader"(e){const{"frag":t,"keyInfo":s,"url":i}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null),delete this.keyUriToKeyInfo[i],r&&r.destroy()}}function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isMSESupported(){if(!getMediaSource())return!1;const e=getSourceBuffer();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}class GapController{"constructor"(e,t,s,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=s,this.hls=i}"destroy"(){this.media=null,this.hls=this.fragmentTracker=null}"poll"(e,t){const{"config":s,"media":i,"stalled":r}=this;if(null===i)return;const{"currentTime":n,"seeking":a}=i,o=this.seeking&&!a,l=!this.seeking&&a;if(this.seeking=a,n!==e){if(this.moved=!0,a||(this.nudgeRetry=0),null!==r){if(this.stallReported){const e=self.performance.now()-r;v.warn(`playback not stuck anymore @${n}, after ${Math.round(e)}ms`),this.stallReported=!1}this.stalled=null}return}if(l||o)return void(this.stalled=null);if(i.paused&&!a||i.ended||0===i.playbackRate||!BufferHelper.getBuffered(i).length)return void(this.nudgeRetry=0);const d=BufferHelper.bufferInfo(i,n,0),h=d.nextStart||0;if(a){const e=d.len>2,s=!h||t&&t.start<=n||h-n>2&&!this.fragmentTracker.getPartialFragment(n);if(e||s)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var c;if(!(d.len>0)&&!h)return;const e=Math.max(h,d.start||0)-n,t=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,s=(null==t||null==(c=t.details)?void 0:c.live)?2*t.details.targetduration:2,r=this.fragmentTracker.getPartialFragment(n);if(e>0&&(e<=s||r))return void(i.paused||this._trySkipBufferHole(r))}const u=self.performance.now();if(null===r)return void(this.stalled=u);const f=u-r;if(!a&&f>=250&&(this._reportStall(d),!this.media))return;const g=BufferHelper.bufferInfo(i,n,s.maxBufferHole);this._tryFixBufferStall(g,f)}"_tryFixBufferStall"(e,t){const{"config":s,"fragmentTracker":i,"media":r}=this;if(null===r)return;const n=r.currentTime,a=i.getPartialFragment(n);if(a){if(this._trySkipBufferHole(a)||!this.media)return}(e.len>s.maxBufferHole||e.nextStart&&e.nextStart-n<s.maxBufferHole)&&t>1e3*s.highBufferWatchdogPeriod&&(v.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}"_reportStall"(e){const{"hls":t,"media":s,"stallReported":i}=this;if(!i&&s){this.stallReported=!0;const i=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${JSON.stringify(e)})`);v.warn(i.message),t.trigger(f.ERROR,{"type":g.MEDIA_ERROR,"details":m.BUFFER_STALLED_ERROR,"fatal":!1,"error":i,"buffer":e.len})}}"_trySkipBufferHole"(e){const{"config":t,"hls":s,"media":i}=this;if(null===i)return 0;const r=i.currentTime,n=BufferHelper.bufferInfo(i,r,0),a=r<n.start?n.start:n.nextStart;if(a){const o=n.len<=t.maxBufferHole,l=n.len>0&&n.len<1&&i.readyState<3,d=a-r;if(d>0&&(o||l)){if(d>t.maxBufferHole){const{"fragmentTracker":t}=this;let s=!1;if(0===r){const e=t.getAppendedFrag(0,te);e&&a<e.end&&(s=!0)}if(!s){const s=e||t.getAppendedFrag(r,te);if(s){let e=!1,i=s.end;for(;i<a;){const s=t.getPartialFragment(i);if(!s){e=!0;break}i+=s.duration}if(e)return 0}}}const n=Math.max(a+.05,r+.1);if(v.warn(`skipping hole, adjusting currentTime from ${r} to ${n}`),this.moved=!0,this.stalled=null,i.currentTime=n,e&&!e.gap){const t=new Error(`fragment loaded with buffer holes, seeking from ${r} to ${n}`);s.trigger(f.ERROR,{"type":g.MEDIA_ERROR,"details":m.BUFFER_SEEK_OVER_HOLE,"fatal":!1,"error":t,"reason":t.message,"frag":e})}return n}}return 0}"_tryNudgeBuffer"(){const{"config":e,"hls":t,"media":s,"nudgeRetry":i}=this;if(null===s)return;const r=s.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){const n=r+(i+1)*e.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${r} to ${n}`);v.warn(a.message),s.currentTime=n,t.trigger(f.ERROR,{"type":g.MEDIA_ERROR,"details":m.BUFFER_NUDGE_ON_STALL,"error":a,"fatal":!1})}else{const s=new Error(`Playhead still not moving while enough data buffered @${r} after ${e.nudgeMaxRetry} nudges`);v.error(s.message),t.trigger(f.ERROR,{"type":g.MEDIA_ERROR,"details":m.BUFFER_STALLED_ERROR,"error":s,"fatal":!0})}}}class StreamController extends BaseStreamController{"constructor"(e,t,s){super(e,t,s,"[stream-controller]",te),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}"_registerListeners"(){const{"hls":e}=this;e.on(f.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(f.MANIFEST_LOADING,this.onManifestLoading,this),e.on(f.MANIFEST_PARSED,this.onManifestParsed,this),e.on(f.LEVEL_LOADING,this.onLevelLoading,this),e.on(f.LEVEL_LOADED,this.onLevelLoaded,this),e.on(f.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(f.ERROR,this.onError,this),e.on(f.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(f.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(f.BUFFER_CREATED,this.onBufferCreated,this),e.on(f.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(f.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(f.FRAG_BUFFERED,this.onFragBuffered,this)}"_unregisterListeners"(){const{"hls":e}=this;e.off(f.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(f.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(f.MANIFEST_LOADING,this.onManifestLoading,this),e.off(f.MANIFEST_PARSED,this.onManifestParsed,this),e.off(f.LEVEL_LOADED,this.onLevelLoaded,this),e.off(f.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(f.ERROR,this.onError,this),e.off(f.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(f.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(f.BUFFER_CREATED,this.onBufferCreated,this),e.off(f.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(f.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(f.FRAG_BUFFERED,this.onFragBuffered,this)}"onHandlerDestroying"(){this._unregisterListeners(),super.onHandlerDestroying()}"startLoad"(e){if(this.levels){const{"lastCurrentTime":t,"hls":s}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=s.startLevel;-1===e&&(s.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=s.firstAutoLevel),s.nextLoadLevel=e,this.level=s.loadLevel,this.loadedmetadata=!1}t>0&&-1===e&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=Ie,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=Ce}"stopLoad"(){this._forceStartLoad=!1,super.stopLoad()}"doTick"(){switch(this.state){case Be:{const{"levels":e,"level":t}=this,s=null==e?void 0:e[t],i=null==s?void 0:s.details;if(i&&(!i.live||this.levelLastLoaded===s)){if(this.waitForCdnTuneIn(i))break;this.state=Ie;break}if(this.hls.nextLoadLevel!==this.level){this.state=Ie;break}break}case xe:{var e;const t=self.performance.now(),s=this.retryDate;if(!s||t>=s||null!=(e=this.media)&&e.seeking){const{"levels":e,"level":t}=this,s=null==e?void 0:e[t];this.resetStartWhenNotLoaded(s||null),this.state=Ie}}}this.state===Ie&&this.doTickIdle(),this.onTickEnd()}"onTickEnd"(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}"doTickIdle"(){const{"hls":e,"levelLastLoaded":t,"levels":s,"media":i}=this;if(null===t||!i&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==s||!s[r])return;const n=s[r],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const e={};return this.altAudio&&(e.type="video"),this.hls.trigger(f.BUFFER_EOS,e),void(this.state=Oe)}if(!this.buffering)return;e.loadLevel!==r&&-1===e.manualLevel&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const l=n.details;if(!l||this.state===Be||l.live&&this.levelLastLoaded!==n)return this.level=r,void(this.state=Be);const d=a.len,h=this.getMaxBufferLength(n.maxBitrate);if(d>=h)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const c=this.backtrackFragment?this.backtrackFragment.start:a.end;let u=this.getNextFragment(c,l);if(this.couldBacktrack&&!this.fragPrevious&&u&&"initSegment"!==u.sn&&this.fragmentTracker.getState(u)!==be){var g;const e=(null!=(g=this.backtrackFragment)?g:u).sn-l.startSN,t=l.fragments[e-1];t&&u.cc===t.cc&&(u=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(u&&this.isLoopLoading(u,c)){if(!u.gap){const e=this.audioOnly&&!this.altAudio?L:A,t=(e===A?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,te)}u=this.getNextFragmentLoopLoading(u,l,a,te,h)}u&&(!u.initSegment||u.initSegment.data||this.bitrateTest||(u=u.initSegment),this.loadFragment(u,n,c))}"loadFragment"(e,t,s){const i=this.fragmentTracker.getState(e);this.fragCurrent=e,i===Le||i===Re?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,s)):this.clearTrackerIfNeeded(e)}"getBufferedFrag"(e){return this.fragmentTracker.getBufferedFrag(e,te)}"followingBufferedFrag"(e){return e?this.getBufferedFrag(e.end+.5):null}"immediateLevelSwitch"(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}"nextLevelSwitch"(){const{"levels":e,"media":t}=this;if(null!=t&&t.readyState){let s;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(null!=r&&r.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*r.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],i=this.fragLastKbps;s=i&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*i)+1:0}else s=0;const n=this.getBufferedFrag(t.currentTime+s);if(n){const e=this.followingBufferedFrag(n);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,s=e.duration,i=Math.max(n.end,t+Math.min(Math.max(s-this.config.maxFragLookUpTolerance,s*(this.couldBacktrack?.5:.125)),s*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(i,Number.POSITIVE_INFINITY)}}}}"abortCurrentFrag"(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Pe:case we:case xe:case Me:case Fe:this.state=Ie}this.nextLoadPosition=this.getLoadPosition()}"flushMainBuffer"(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}"onMediaAttached"(e,t){super.onMediaAttached(e,t);const s=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),s.addEventListener("playing",this.onvplaying),s.addEventListener("seeked",this.onvseeked),this.gapController=new GapController(this.config,s,this.fragmentTracker,this.hls)}"onMediaDetaching"(){const{"media":e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}"onMediaPlaying"(){this.tick()}"onMediaSeeked"(){const e=this.media,t=e?e.currentTime:null;h(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const s=this.getMainFwdBufferInfo();null!==s&&0!==s.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${s?s.len:"empty"})`)}"onManifestLoading"(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(f.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}"onManifestParsed"(e,t){let s=!1,i=!1;t.levels.forEach((e=>{const t=e.audioCodec;t&&(s=s||-1!==t.indexOf("mp4a.40.2"),i=i||-1!==t.indexOf("mp4a.40.5"))})),this.audioCodecSwitch=s&&i&&!function changeTypeSupported(){var e;const t=getSourceBuffer();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}"onLevelLoading"(e,t){const{"levels":s}=this;if(!s||this.state!==Ie)return;const i=s[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(i.details))&&(this.state=Be)}"onLevelLoaded"(e,t){var s;const{"levels":i}=this,r=t.level,n=t.details,a=n.totalduration;if(!i)return void this.warn(`Levels were reset while loading level ${r}`);this.log(`Level ${r} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""}, cc [${n.startCC}, ${n.endCC}] duration:${a}`);const o=i[r],l=this.fragCurrent;!l||this.state!==we&&this.state!==xe||l.level!==t.level&&l.loader&&this.abortCurrentFrag();let d=0;if(n.live||null!=(s=o.details)&&s.live){var h;if(this.checkLiveUpdate(n),n.deltaUpdateFailed)return;d=this.alignPlaylists(n,o.details,null==(h=this.levelLastLoaded)?void 0:h.details)}if(o.details=n,this.levelLastLoaded=o,this.hls.trigger(f.LEVEL_UPDATED,{"details":n,"level":r}),this.state===Be){if(this.waitForCdnTuneIn(n))return;this.state=Ie}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,d),this.tick()}"_handleFragmentLoadProgress"(e){var t;const{"frag":s,"part":i,"payload":r}=e,{"levels":n}=this;if(!n)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);const a=n[s.level],o=a.details;if(!o)return this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),void this.fragmentTracker.removeFragment(s);const l=a.videoCodec,d=o.PTSKnown||!o.live,h=null==(t=s.initSegment)?void 0:t.data,c=this._getAudioCodec(a),u=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,te,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=i?i.index:-1,g=-1!==f,m=new ChunkMetadata(s.level,s.sn,s.stats.chunkCount,r.byteLength,f,g),p=this.initPTS[s.cc];u.push(r,h,c,l,s,i,o.totalduration,d,m,p)}"onAudioTrackSwitching"(e,t){const s=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const e=this.hls;s&&(e.trigger(f.BUFFER_FLUSHING,{"startOffset":0,"endOffset":Number.POSITIVE_INFINITY,"type":null}),this.fragmentTracker.removeAllFragments()),e.trigger(f.AUDIO_TRACK_SWITCHED,t)}}"onAudioTrackSwitched"(e,t){const s=t.id,i=!!this.hls.audioTracks[s].url;if(i){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=i,this.tick()}"onBufferCreated"(e,t){const s=t.tracks;let i,r,n=!1;for(const e in s){const t=s[e];if("main"===t.id){if(r=e,i=t,"video"===e){const t=s[e];t&&(this.videoBuffer=t.buffer)}}else n=!0}n&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}"onFragBuffered"(e,t){const{"frag":s,"part":i}=t;if(s&&s.type!==te)return;if(this.fragContextChanged(s))return this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===Fe&&(this.state=Ie));const r=i?i.stats:s.stats;this.fragLastKbps=Math.round(8*r.total/(r.buffering.end-r.loading.first)),"initSegment"!==s.sn&&(this.fragPrevious=s),this.fragBufferedComplete(s,i)}"onError"(e,t){var s;if(t.fatal)this.state=Ue;else switch(t.details){case m.FRAG_GAP:case m.FRAG_PARSING_ERROR:case m.FRAG_DECRYPT_ERROR:case m.FRAG_LOAD_ERROR:case m.FRAG_LOAD_TIMEOUT:case m.KEY_LOAD_ERROR:case m.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(te,t);break;case m.LEVEL_LOAD_ERROR:case m.LEVEL_LOAD_TIMEOUT:case m.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Be||(null==(s=t.context)?void 0:s.type)!==J||(this.state=Ie);break;case m.BUFFER_APPEND_ERROR:case m.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;if(t.details===m.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case m.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}"checkBuffer"(){const{"media":e,"gapController":t}=this;if(e&&t&&e.readyState){if(this.loadedmetadata||!BufferHelper.getBuffered(e).length){const e=this.state!==Ie?this.fragCurrent:null;t.poll(this.lastCurrentTime,e)}this.lastCurrentTime=e.currentTime}}"onFragLoadEmergencyAborted"(){this.state=Ie,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}"onBufferFlushed"(e,{"type":t}){if(t!==L||this.audioOnly&&!this.altAudio){const e=(t===A?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(e,t,te),this.tick()}}"onLevelsUpdated"(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}"swapAudioCodec"(){this.audioCodecSwap=!this.audioCodecSwap}"seekToStartPos"(){const{"media":e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking)return void this.log(`could not seek to ${s}, already seeking at ${t}`);const i=BufferHelper.getBuffered(e),r=(i.length?i.start(0):0)-s;r>0&&(r<this.config.maxBufferHole||r<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${r} to match buffer start`),s+=r,this.startPosition=s),this.log(`seek to target start position ${s} from current time ${t}`),e.currentTime=s}}"_getAudioCodec"(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}"_loadBitrateTestFrag"(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then((s=>{const{"hls":i}=this;if(!s||this.fragContextChanged(e))return;t.fragmentError=0,this.state=Ie,this.startFragRequested=!1,this.bitrateTest=!1;const r=e.stats;r.parsing.start=r.parsing.end=r.buffering.start=r.buffering.end=self.performance.now(),i.trigger(f.FRAG_LOADED,s),e.bitrateTest=!1}))}"_handleTransmuxComplete"(e){var t;const s="main",{"hls":i}=this,{"remuxResult":r,"chunkMeta":n}=e,a=this.getCurrentContext(n);if(!a)return void this.resetWhenMissingContext(n);const{"frag":o,"part":l,"level":d}=a,{"video":c,"text":u,"id3":g,"initSegment":m}=r,{"details":p}=d,y=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=Me,m){if(null!=m&&m.tracks){const e=o.initSegment||o;this._bufferInitSegment(d,m.tracks,e,n),i.trigger(f.FRAG_PARSING_INIT_SEGMENT,{"frag":e,"id":s,"tracks":m.tracks})}const e=m.initPTS,t=m.timescale;h(e)&&(this.initPTS[o.cc]={"baseTime":e,"timescale":t},i.trigger(f.INIT_PTS_FOUND,{"frag":o,"id":s,"initPTS":e,"timescale":t}))}if(c&&p&&"initSegment"!==o.sn){const e=p.fragments[o.sn-1-p.startSN],t=o.sn===p.startSN,s=!e||o.cc>e.cc;if(!1!==r.independent){const{"startPTS":e,"endPTS":i,"startDTS":r,"endDTS":a}=c;if(l)l.elementaryStreams[c.type]={"startPTS":e,"endPTS":i,"startDTS":r,"endDTS":a};else if(c.firstKeyFrame&&c.independent&&1===n.id&&!s&&(this.couldBacktrack=!0),c.dropped&&c.independent){const r=this.getMainFwdBufferInfo(),n=(r?r.end:this.getLoadPosition())+this.config.maxBufferHole,l=c.firstKeyFramePTS?c.firstKeyFramePTS:e;if(!t&&n<l-this.config.maxBufferHole&&!s)return void this.backtrack(o);s&&(o.gap=!0),o.setElementaryStreamInfo(c.type,o.start,i,o.start,a,!0)}else t&&e>2&&(o.gap=!0);o.setElementaryStreamInfo(c.type,e,i,r,a),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,n,t||s)}else{if(!t&&!s)return void this.backtrack(o);o.gap=!0}}if(y){const{"startPTS":e,"endPTS":t,"startDTS":s,"endDTS":i}=y;l&&(l.elementaryStreams[L]={"startPTS":e,"endPTS":t,"startDTS":s,"endDTS":i}),o.setElementaryStreamInfo(L,e,t,s,i),this.bufferFragmentData(y,o,l,n)}if(p&&null!=g&&null!=(t=g.samples)&&t.length){const e={"id":s,"frag":o,"details":p,"samples":g.samples};i.trigger(f.FRAG_PARSING_METADATA,e)}if(p&&u){const e={"id":s,"frag":o,"details":p,"samples":u.samples};i.trigger(f.FRAG_PARSING_USERDATA,e)}}}"_bufferInitSegment"(e,t,s,i){if(this.state!==Me)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{"audio":r,"video":n,"audiovideo":a}=t;if(r){let t=e.audioCodec;const s=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=r.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===s.indexOf("firefox")&&(t="mp4a.40.5")}t&&-1!==t.indexOf("mp4a.40.5")&&-1!==s.indexOf("android")&&"audio/mpeg"!==r.container&&(t="mp4a.40.2",this.log(`Android: force audio codec to ${t}`)),e.audioCodec&&e.audioCodec!==t&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${t}"`),r.levelCodec=t,r.id="main",this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${t||""}/${e.audioCodec||""}/${r.codec}]`)}n&&(n.levelCodec=e.videoCodec,n.id="main",this.log(`Init video buffer, container:${n.container}, codecs[level/parsed]=[${e.videoCodec||""}/${n.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),this.hls.trigger(f.BUFFER_CODECS,t),Object.keys(t).forEach((e=>{const r=t[e].initSegment;null!=r&&r.byteLength&&this.hls.trigger(f.BUFFER_APPENDING,{"type":e,"data":r,"frag":s,"part":null,"chunkMeta":i,"parent":s.type})})),this.tickImmediate()}"getMainFwdBufferInfo"(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,te)}"backtrack"(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Ie}"checkFragmentChanged"(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const s=e.currentTime;if(BufferHelper.isBuffered(e,s)?t=this.getAppendedFrag(s):BufferHelper.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,s=t.level;e&&t.sn===e.sn&&e.level===s||(this.fragPlaying=t,this.hls.trigger(f.FRAG_CHANGED,{"frag":t}),e&&e.level===s||this.hls.trigger(f.LEVEL_SWITCHED,{"level":s}))}}}get"nextLevel"(){const e=this.nextBufferedFrag;return e?e.level:-1}get"currentFrag"(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get"currentProgramDateTime"(){const e=this.media;if(e){const t=e.currentTime,s=this.currentFrag;if(s&&h(t)&&h(s.programDateTime)){const e=s.programDateTime+1e3*(t-s.start);return new Date(e)}}return null}get"currentLevel"(){const e=this.currentFrag;return e?e.level:-1}get"nextBufferedFrag"(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get"forceStartLoad"(){return this._forceStartLoad}}class Hls{static get"version"(){return"1.5.20"}static"isMSESupported"(){return isMSESupported()}static"isSupported"(){return function isSupported(){if(!isMSESupported())return!1;const e=getMediaSource();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((t=>e.isTypeSupported(mimeTypeForCodec(t,"video"))))||["mp4a.40.2","fLaC"].some((t=>e.isTypeSupported(mimeTypeForCodec(t,"audio")))))}()}static"getMediaSource"(){return getMediaSource()}static get"Events"(){return f}static get"ErrorTypes"(){return g}static get"ErrorDetails"(){return m}static get"DefaultConfig"(){return Hls.defaultConfig?Hls.defaultConfig:_t}static set"DefaultConfig"(e){Hls.defaultConfig=e}"constructor"(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new Ze,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,function enableLogs(e,t){if("object"==typeof console&&!0===e||"object"==typeof e){exportLoggerFunctions(e,"debug","log","info","warn","error");try{T.log(`Debug logs enabled for "${t}" in hls.js version 1.5.20`)}catch(e){T=y}}else T=y}(e.debug||!1,"Hls instance");const t=this.config=function mergeConfig(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=deepCpy(e),i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((e=>{const r=`${"level"===e?"playlist":e}LoadPolicy`,n=void 0===t[r],a=[];i.forEach((i=>{const o=`${e}Loading${i}`,l=t[o];if(void 0!==l&&n){a.push(o);const e=s[r].default;switch(t[r]={"default":e},i){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}})),a.length&&v.warn(`hls.js config: "${a.join('", "')}" setting(s) are deprecated, use "${r}": ${JSON.stringify(t[r])}`)})),_objectSpread2(_objectSpread2({},s),t)}(Hls.DefaultConfig,e);this.userConfig=e,t.progressive&&enableStreamingMode(t);const{"abrController":s,"bufferController":i,"capLevelController":r,"errorController":n,"fpsController":a}=t,o=new n(this),l=this.abrController=new s(this),d=this.bufferController=new i(this),h=this.capLevelController=new r(this),c=new a(this),u=new PlaylistLoader(this),g=new ID3TrackController(this),m=t.contentSteeringController,p=m?new m(this):null,E=this.levelController=new LevelController(this,p),S=new FragmentTracker(this),L=new KeyLoader(this.config),A=this.streamController=new StreamController(this,S,L);h.setStreamController(A),c.setStreamController(A);const R=[u,E,A];p&&R.splice(1,0,p),this.networkControllers=R;const b=[l,d,h,c,g,S];this.audioTrackController=this.createController(t.audioTrackController,R);const k=t.audioStreamController;k&&R.push(new k(this,S,L)),this.subtitleTrackController=this.createController(t.subtitleTrackController,R);const D=t.subtitleStreamController;D&&R.push(new D(this,S,L)),this.createController(t.timelineController,b),L.emeController=this.emeController=this.createController(t.emeController,b),this.cmcdController=this.createController(t.cmcdController,b),this.latencyController=this.createController(LatencyController,b),this.coreComponents=b,R.push(o);const C=o.onErrorOut;"function"==typeof C&&this.on(f.ERROR,C,o)}"createController"(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}"on"(e,t,s=this){this._emitter.on(e,t,s)}"once"(e,t,s=this){this._emitter.once(e,t,s)}"removeAllListeners"(e){this._emitter.removeAllListeners(e)}"off"(e,t,s=this,i){this._emitter.off(e,t,s,i)}"listeners"(e){return this._emitter.listeners(e)}"emit"(e,t,s){return this._emitter.emit(e,t,s)}"trigger"(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){if(v.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),!this.triggeringException){this.triggeringException=!0;const s=e===f.ERROR;this.trigger(f.ERROR,{"type":g.OTHER_ERROR,"details":m.INTERNAL_EXCEPTION,"fatal":s,"event":e,"error":t}),this.triggeringException=!1}}return!1}"listenerCount"(e){return this._emitter.listenerCount(e)}"destroy"(){v.log("destroy"),this.trigger(f.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((e=>e.destroy())),this.networkControllers.length=0,this.coreComponents.forEach((e=>e.destroy())),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}"attachMedia"(e){v.log("attachMedia"),this._media=e,this.trigger(f.MEDIA_ATTACHING,{"media":e})}"detachMedia"(){v.log("detachMedia"),this.trigger(f.MEDIA_DETACHING,void 0),this._media=null}"loadSource"(e){this.stopLoad();const t=this.media,s=this.url,i=this.url=d.buildAbsoluteURL(self.location.href,e,{"alwaysNormalize":!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,v.log(`loadSource:${i}`),t&&s&&(s!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(f.MANIFEST_LOADING,{"url":e})}"startLoad"(e=-1){v.log(`startLoad(${e})`),this.started=!0,this.resumeBuffering();for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].startLoad(e),this.started&&this.networkControllers);t++);}"stopLoad"(){v.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}"resumeBuffering"(){v.log("resume buffering"),this.networkControllers.forEach((e=>{e.resumeBuffering&&e.resumeBuffering()}))}"pauseBuffering"(){v.log("pause buffering"),this.networkControllers.forEach((e=>{e.pauseBuffering&&e.pauseBuffering()}))}"swapAudioCodec"(){v.log("swapAudioCodec"),this.streamController.swapAudioCodec()}"recoverMediaError"(){v.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}"removeLevel"(e){this.levelController.removeLevel(e)}get"levels"(){const e=this.levelController.levels;return e||[]}get"currentLevel"(){return this.streamController.currentLevel}set"currentLevel"(e){v.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get"nextLevel"(){return this.streamController.nextLevel}set"nextLevel"(e){v.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get"loadLevel"(){return this.levelController.level}set"loadLevel"(e){v.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get"nextLoadLevel"(){return this.levelController.nextLoadLevel}set"nextLoadLevel"(e){this.levelController.nextLoadLevel=e}get"firstLevel"(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set"firstLevel"(e){v.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get"startLevel"(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set"startLevel"(e){v.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get"capLevelToPlayerSize"(){return this.config.capLevelToPlayerSize}set"capLevelToPlayerSize"(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get"autoLevelCapping"(){return this._autoLevelCapping}get"bandwidthEstimate"(){const{"bwEstimator":e}=this.abrController;return e?e.getEstimate():NaN}set"bandwidthEstimate"(e){this.abrController.resetEstimator(e)}get"ttfbEstimate"(){const{"bwEstimator":e}=this.abrController;return e?e.getEstimateTTFB():NaN}set"autoLevelCapping"(e){this._autoLevelCapping!==e&&(v.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get"maxHdcpLevel"(){return this._maxHdcpLevel}set"maxHdcpLevel"(e){(function isHdcpLevel(e){return le.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get"autoLevelEnabled"(){return-1===this.levelController.manualLevel}get"manualLevel"(){return this.levelController.manualLevel}get"minAutoLevel"(){const{"levels":e,"config":{"minAutoBitrate":t}}=this;if(!e)return 0;const s=e.length;for(let i=0;i<s;i++)if(e[i].maxBitrate>=t)return i;return 0}get"maxAutoLevel"(){const{"levels":e,"autoLevelCapping":t,"maxHdcpLevel":s}=this;let i;if(i=-1===t&&null!=e&&e.length?e.length-1:t,s)for(let t=i;t--;){const i=e[t].attrs["HDCP-LEVEL"];if(i&&i<=s)return t}return i}get"firstAutoLevel"(){return this.abrController.firstAutoLevel}get"nextAutoLevel"(){return this.abrController.nextAutoLevel}set"nextAutoLevel"(e){this.abrController.nextAutoLevel=e}get"playingDate"(){return this.streamController.currentProgramDateTime}get"mainForwardBufferInfo"(){return this.streamController.getMainFwdBufferInfo()}"setAudioOption"(e){var t;return null==(t=this.audioTrackController)?void 0:t.setAudioOption(e)}"setSubtitleOption"(e){var t;return null==(t=this.subtitleTrackController)||t.setSubtitleOption(e),null}get"allAudioTracks"(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get"audioTracks"(){const e=this.audioTrackController;return e?e.audioTracks:[]}get"audioTrack"(){const e=this.audioTrackController;return e?e.audioTrack:-1}set"audioTrack"(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get"allSubtitleTracks"(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get"subtitleTracks"(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get"subtitleTrack"(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get"media"(){return this._media}set"subtitleTrack"(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get"subtitleDisplay"(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set"subtitleDisplay"(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get"lowLatencyMode"(){return this.config.lowLatencyMode}set"lowLatencyMode"(e){this.config.lowLatencyMode=e}get"liveSyncPosition"(){return this.latencyController.liveSyncPosition}get"latency"(){return this.latencyController.latency}get"maxLatency"(){return this.latencyController.maxLatency}get"targetLatency"(){return this.latencyController.targetLatency}get"drift"(){return this.latencyController.drift}get"forceStartLoad"(){return this.streamController.forceStartLoad}}Hls.defaultConfig=void 0}}]);